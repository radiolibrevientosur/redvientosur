import{r as s,s as u,a as m,j as e,q as C,S as k}from"./index-BSYyVXs5.js";import{E}from"./EventoCulturalCard-Bv--oRdI.js";import{C as D}from"./CumpleañosCard-oUgIzDlm.js";import{M as S}from"./more-horizontal-CXuOmTNl.js";import{C as M,a as T}from"./clock-DWyAyzWM.js";import{f as _}from"./format-6SnhDrvL.js";import"./postStore-CoxJlB11.js";import"./endOfMonth-CHJGNAHY.js";import"./en-US-D3c9jfE3.js";import"./send-Ch9fY7Oq.js";import"./es-B8gmi2Zg.js";import"./cake-D5np9u-n.js";const[w,h]=s.useState(null),L=[{id:"pendiente",title:"Pendientes",color:"bg-yellow-100"},{id:"en_progreso",title:"En Progreso",color:"bg-blue-100"},{id:"completada",title:"Completadas",color:"bg-green-100"}],q=()=>{const[x,d]=s.useState([]),[g,f]=s.useState(!0);s.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:r,error:a}=await u.from("tareas").select("*").order("fecha_limite",{ascending:!0});if(a)throw a;d(r||[])}catch(r){console.error("Error al cargar tareas:",r),m.error("Error al cargar las tareas")}finally{f(!1)}},b=(r,a)=>{r.dataTransfer.setData("taskId",a)},v=async(r,a)=>{r.preventDefault();const i=r.dataTransfer.getData("taskId");try{const{error:l}=await u.from("tareas").update({estado:a}).eq("id",i);if(l)throw l;d(x.map(c=>c.id===i?{...c,estado:a}:c)),m.success("Tarea actualizada")}catch(l){console.error("Error al actualizar tarea:",l),m.error("Error al actualizar la tarea")}},y=r=>{r.preventDefault()};return g?e.jsx("div",{children:"Cargando tareas..."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:L.map(r=>e.jsxs("div",{className:`${r.color} dark:bg-gray-800 p-4 rounded-lg shadow`,onDrop:a=>v(a,r.id),onDragOver:y,children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:r.title}),e.jsx("div",{className:"space-y-4",children:x.filter(a=>a.estado===r.id).map(a=>{var i;return e.jsxs("div",{draggable:!0,onDragStart:l=>b(l,a.id),className:"bg-white dark:bg-gray-700 p-4 rounded shadow-sm cursor-move hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:a.titulo}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>h(w===a.id?null:a.id),"aria-label":"Abrir menú",children:e.jsx(S,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),w===a.id&&e.jsx("div",{className:"absolute right-0 top-10 z-20 bg-white dark:bg-gray-900 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 min-w-[180px]",children:e.jsxs("ul",{className:"py-2",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{navigator.clipboard.writeText(a.titulo+" - "+a.descripcion),h(null),m.success("¡Tarea copiada!")},children:"Copiar tarea"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{h(null)},children:"Editar tarea"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-800",onClick:async()=>{await u.from("tareas").delete().eq("id",a.id),h(null),m.success("Tarea eliminada"),p()},children:"Eliminar tarea"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>h(null),children:"Cancelar"})})]})})]})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-300 mt-1",children:a.descripcion}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:a.asignado_a})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:new Date(a.fecha_limite).toLocaleDateString()})]})]}),((i=a.checklist)==null?void 0:i.length)>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[a.checklist.filter(l=>l.completado).length," / ",a.checklist.length]})]})})]},a.id)})})]},r.id))})},R=()=>{const[x,d]=s.useState([]),[g,f]=s.useState([]),[p,b]=s.useState(!0),[v,y]=s.useState(!0),[r,a]=s.useState(""),[i,l]=s.useState("");s.useEffect(()=>{(async()=>{b(!0);const{data:o}=await u.from("eventos").select("*").order("fecha_inicio",{ascending:!0});d(o||[]),b(!1)})()},[]),s.useEffect(()=>{(async()=>{y(!0);const o=new Date,n=o.getMonth()+1,j=o.getDate(),{data:N}=await u.from("cumpleanos").select("*").filter("extract(month from fecha_nacimiento)","eq",n).filter("extract(day from fecha_nacimiento)","eq",j);f(N||[]),y(!1)})()},[]);const c=x.filter(t=>{var j;const o=(j=t.titulo)==null?void 0:j.toLowerCase().includes(r.toLowerCase()),n=i?_(new Date(t.fecha_inicio),"yyyy-MM-dd")===i:!0;return o&&n});return e.jsxs("main",{className:"p-4 max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Agenda"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6 items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-1/2",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:e.jsx(k,{className:"h-5 w-5"})}),e.jsx("input",{type:"text",placeholder:"Buscar evento...",value:r,onChange:t=>a(t.target.value),className:"pl-10 pr-3 py-2 rounded-full border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500 w-full transition shadow-sm","aria-label":"Buscar evento"})]}),e.jsxs("div",{className:"relative w-full md:w-1/3",children:[e.jsx("input",{type:"date",value:i,onChange:t=>l(t.target.value),className:"px-3 py-2 rounded-full border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500 w-full transition shadow-sm","aria-label":"Filtrar por fecha"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",children:e.jsx("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{stroke:"currentColor",strokeWidth:"2",d:"M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2Z"})})})]})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsxs("button",{onClick:()=>window.location.href="/calendar",className:"inline-flex items-center gap-2 px-5 py-2 rounded-full bg-primary-600 text-white font-semibold shadow hover:bg-primary-700 transition focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Programar evento",children:[e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{stroke:"currentColor",strokeWidth:"2",d:"M12 5v14m7-7H5"})}),"Programar"]})})]}),e.jsxs("section",{"aria-labelledby":"eventos-culturales",className:"mb-8",children:[e.jsx("h2",{id:"eventos-culturales",className:"text-xl font-semibold mb-4",children:"Eventos culturales"}),p?e.jsx("div",{children:"Cargando eventos..."}):c.length===0?e.jsx("div",{children:"No hay eventos culturales."}):c.map(t=>e.jsx(E,{event:t,onDeleted:()=>{d(o=>o.filter(n=>n.id!==t.id))}},t.id))]}),e.jsxs("section",{"aria-labelledby":"cumpleanos",className:"mb-8",children:[e.jsx("h2",{id:"cumpleanos",className:"text-xl font-semibold mb-4",children:"Cumpleaños"}),v?e.jsx("div",{children:"Cargando cumpleaños..."}):g.length===0?e.jsx("div",{children:"No hay cumpleaños hoy."}):g.map(t=>e.jsx(D,{birthday:t,onDeleted:()=>{f(o=>o.filter(n=>n.id!==t.id))}},t.id))]}),e.jsxs("section",{"aria-labelledby":"tareas",className:"mb-8",children:[e.jsx("h2",{id:"tareas",className:"text-xl font-semibold mb-4",children:"Tareas"}),e.jsx(q,{})]})]})};export{R as default};
