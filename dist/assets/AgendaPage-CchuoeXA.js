import{r as o,s as h,a as g,j as e,t as N,S as k}from"./index-COvD-dsj.js";import{E as C}from"./EventoCulturalCard-Cpvz8UeX.js";import{C as E}from"./CumpleañosCard-BB1Mn-zQ.js";import{M as D}from"./more-horizontal-VhyU_bLn.js";import{C as S,a as _}from"./clock-DYkStsnM.js";import"./postStore-Dp1p3vYt.js";import"./endOfMonth-CHJGNAHY.js";import"./en-US-D3c9jfE3.js";import"./send-C9DKiU_-.js";import"./es-B8gmi2Zg.js";import"./format-6SnhDrvL.js";import"./CreateBirthdayForm-DAn8XwC-.js";const T=[{id:"pendiente",title:"Pendientes",color:"bg-yellow-100"},{id:"en_progreso",title:"En Progreso",color:"bg-blue-100"},{id:"completada",title:"Completadas",color:"bg-green-100"}],M=()=>{const[x,n]=o.useState(null),[u,c]=o.useState([]),[b,p]=o.useState(!0);o.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:t,error:a}=await h.from("tareas").select("*").order("fecha_limite",{ascending:!0});if(a)throw a;c(t||[])}catch(t){console.error("Error al cargar tareas:",t),g.error("Error al cargar las tareas")}finally{p(!1)}},y=(t,a)=>{t.dataTransfer.setData("taskId",a)},v=async(t,a)=>{t.preventDefault();const d=t.dataTransfer.getData("taskId");try{const{error:i}=await h.from("tareas").update({estado:a}).eq("id",d);if(i)throw i;c(u.map(m=>m.id===d?{...m,estado:a}:m)),g.success("Tarea actualizada")}catch(i){console.error("Error al actualizar tarea:",i),g.error("Error al actualizar la tarea")}},j=t=>{t.preventDefault()};return b?e.jsx("div",{children:"Cargando tareas..."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:T.map(t=>e.jsxs("div",{className:`${t.color} dark:bg-gray-800 p-4 rounded-lg shadow`,onDrop:a=>v(a,t.id),onDragOver:j,children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:t.title}),e.jsx("div",{className:"space-y-4",children:u.filter(a=>a.estado===t.id).map(a=>{var d;return e.jsxs("div",{draggable:!0,onDragStart:i=>y(i,a.id),className:"bg-white dark:bg-gray-700 p-4 rounded shadow-sm cursor-move hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:a.titulo}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>n(x===a.id?null:a.id),"aria-label":"Abrir menú",children:e.jsx(D,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),x===a.id&&e.jsx("div",{className:"absolute right-0 top-10 z-20 bg-white dark:bg-gray-900 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 min-w-[180px]",children:e.jsxs("ul",{className:"py-2",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{navigator.clipboard.writeText(a.titulo+" - "+a.descripcion),n(null),g.success("¡Tarea copiada!")},children:"Copiar tarea"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{n(null)},children:"Editar tarea"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-800",onClick:async()=>{await h.from("tareas").delete().eq("id",a.id),n(null),g.success("Tarea eliminada"),f()},children:"Eliminar tarea"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>n(null),children:"Cancelar"})})]})})]})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-300 mt-1",children:a.descripcion}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:a.asignado_a})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:new Date(a.fecha_limite).toLocaleDateString()})]})]}),((d=a.checklist)==null?void 0:d.length)>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[a.checklist.filter(i=>i.completado).length," / ",a.checklist.length]})]})})]},a.id)})})]},t.id))})},A=()=>{const[x,n]=o.useState([]),[u,c]=o.useState([]),[b,p]=o.useState(!0),[f,y]=o.useState(!0),[v,j]=o.useState(""),[t,a]=o.useState("");o.useEffect(()=>{(async()=>{p(!0);const{data:s}=await h.from("eventos").select("*").order("fecha_inicio",{ascending:!0});n(s||[]),p(!1)})()},[]),o.useEffect(()=>{(async()=>{y(!0);const s=new Date,l=new Date;l.setDate(s.getDate()+30);const{data:w}=await h.from("cumpleanos").select("*").gte("fecha_nacimiento",s.toISOString().slice(0,10)).lte("fecha_nacimiento",l.toISOString().slice(0,10)).order("fecha_nacimiento",{ascending:!0});c(w||[]),y(!1)})()},[]);const d=[...u.map(r=>({...r,__type:"cumple",fecha:r.fecha_nacimiento})),...x.map(r=>({...r,__type:"evento",fecha:r.fecha_inicio}))].sort((r,s)=>new Date(r.fecha).getTime()-new Date(s.fecha).getTime()),i=r=>{c(s=>s.map(l=>l.id===r.id?{...l,...r}:l))},m=r=>{n(s=>s.map(l=>l.id===r.id?{...l,...r}:l))};return e.jsxs("main",{className:"p-4 max-w-3xl mx-auto min-h-screen bg-gradient-to-b from-primary-50 via-white to-gray-100 dark:from-gray-900 dark:via-gray-950 dark:to-gray-900",children:[e.jsxs("header",{className:"py-8 text-center",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-primary-700 dark:text-primary-300 drop-shadow-sm mb-2",children:"Agenda cultural"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg",children:"Consulta y programa eventos, cumpleaños y tareas de la comunidad"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8 items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-1/2",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:e.jsx(k,{className:"h-5 w-5"})}),e.jsx("input",{type:"text",placeholder:"Buscar evento...",value:v,onChange:r=>j(r.target.value),className:"pl-10 pr-3 py-2 rounded-full border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500 w-full transition shadow-sm text-base","aria-label":"Buscar evento"})]}),e.jsxs("div",{className:"relative w-full md:w-1/3",children:[e.jsx("input",{type:"date",value:t,onChange:r=>a(r.target.value),className:"px-3 py-2 rounded-full border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500 w-full transition shadow-sm text-base","aria-label":"Filtrar por fecha"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",children:e.jsx("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{stroke:"currentColor",strokeWidth:"2",d:"M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2Z"})})})]})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsxs("button",{onClick:()=>window.location.href="/calendar",className:"inline-flex items-center gap-2 px-6 py-2 rounded-full bg-primary-600 text-white font-semibold shadow-lg hover:bg-primary-700 transition focus:outline-none focus:ring-2 focus:ring-primary-500 text-base","aria-label":"Programar evento",children:[e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{stroke:"currentColor",strokeWidth:"2",d:"M12 5v14m7-7H5"})}),"Programar"]})})]}),e.jsxs("section",{"aria-labelledby":"feed",className:"mb-12",children:[e.jsx("h2",{id:"feed",className:"text-2xl font-bold mb-6 text-primary-700 dark:text-primary-300",children:"Próximos eventos y cumpleaños"}),b||f?e.jsx("div",{className:"text-center text-lg text-gray-500 py-8",children:"Cargando..."}):d.length===0?e.jsx("div",{className:"text-center text-gray-400 py-8",children:"No hay eventos ni cumpleaños próximos."}):e.jsx("div",{className:"space-y-6",children:d.map(r=>r.__type==="cumple"?e.jsx("div",{className:"shadow-lg rounded-xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 p-0",children:e.jsx(E,{birthday:r,onDeleted:()=>c(s=>s.filter(l=>l.id!==r.id)),onEdit:i})},r.id):e.jsx("div",{className:"shadow-lg rounded-xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 p-0",children:e.jsx(C,{event:r,onDeleted:()=>n(s=>s.filter(l=>l.id!==r.id)),onEdit:()=>m(r)})},r.id))})]}),e.jsxs("section",{"aria-labelledby":"tareas",className:"mb-8",children:[e.jsx("h2",{id:"tareas",className:"text-2xl font-bold mb-6 text-primary-700 dark:text-primary-300",children:"Tareas"}),e.jsx("div",{className:"shadow-lg rounded-xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 p-4",children:e.jsx(M,{})})]})]})};export{A as default};
