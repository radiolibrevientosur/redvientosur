import{c as v,r as e,j as a,s as j,a as B}from"./index-CSAYQrjP.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=v("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=v("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=v("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),E=e.forwardRef(({onAudioReady:p,folder:U="media"},S)=>{const[n,f]=e.useState(!1),[D,o]=e.useState(null),[N,g]=e.useState(0),[h,i]=e.useState(!1),[P,l]=e.useState(0),[x,u]=e.useState(null);e.useState(!1);const[b,w]=e.useState(!1),t=e.useRef(null),m=e.useRef([]),d=e.useRef(null),I=async()=>{o(null),g(0),l(0),i(!1),u(null),window.navigator.vibrate&&window.navigator.vibrate([50,30,50]);const r=await navigator.mediaDevices.getUserMedia({audio:!0}),c=new window.MediaRecorder(r);t.current=c,m.current=[],c.ondataavailable=s=>{m.current.push(s.data)},c.onstop=async()=>{const s=new Blob(m.current,{type:"audio/webm"});u(s),o(URL.createObjectURL(s)),k()},c.start(),f(!0),d.current=setInterval(()=>g(s=>s+1),1e3)},R=()=>{t.current&&n&&(f(!1),d.current&&clearInterval(d.current),t.current.onstop=()=>{const r=new Blob(m.current,{type:"audio/webm"});u(r),o(URL.createObjectURL(r)),k()},t.current.stop())},k=async()=>{if(x){i(!0),l(0);try{const r=`${U}/audio_${Date.now()}_${Math.random().toString(36).substring(2,8)}.webm`;for(let y=1;y<=90;y+=10)await new Promise(L=>setTimeout(L,60)),l(y);const{error:c}=await j.storage.from("media").upload(r,x);if(l(100),i(!1),c)throw c;const{data:s}=j.storage.from("media").getPublicUrl(r);o(null),u(null),p(s.publicUrl)}catch{i(!1),l(0),o(null),u(null),p(null),B.error("Error al subir audio")}}},M=()=>{f(!1),o(null),g(0),l(0),i(!1),p(null),d.current&&clearInterval(d.current),t.current&&t.current.state!=="inactive"&&t.current.stop()},C=()=>{t.current&&n&&!b&&(t.current.pause(),w(!0))},H=()=>{t.current&&n&&b&&(t.current.resume(),w(!1))};return e.useImperativeHandle(S,()=>({startRecording:I,stopRecording:R,cancelRecording:M,isRecording:()=>n,isUploading:()=>h})),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex gap-2 items-center",children:[n&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",onClick:R,className:"btn btn-danger btn-sm animate-pulse",children:"Detener"}),a.jsx("button",{type:"button",onClick:C,disabled:b,className:"btn btn-warning btn-xs ml-2",children:"Pausar"}),a.jsx("button",{type:"button",onClick:H,disabled:!b,className:"btn btn-success btn-xs ml-2",children:"Reanudar"})]}),n&&a.jsxs("span",{className:"text-red-500 font-mono animate-pulse",children:[N,"s"]}),(n||h)&&a.jsx("button",{type:"button",onClick:M,className:"btn btn-secondary btn-sm",children:"Cancelar"})]}),h&&a.jsx("div",{className:"w-full bg-gray-200 rounded h-2",children:a.jsx("div",{className:"bg-primary-500 h-2 rounded",style:{width:`${P}%`}})})]})});export{E as A,T as F,$ as M,q as a};
