import{c as M,r as o,b as Y,R as Z,s as c,j as a,L as ee,m as T,i as y,C as ae,H as te,M as re,a as x}from"./index-COvD-dsj.js";import{$ as se,d as ie}from"./native-uLmOTjr_.js";import{S as oe}from"./share-2-D_DLkkIs.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=M("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=M("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),ce=[{label:"Para ti",value:"feed"},{label:"Lo Ãºltimo",value:"timeline"}],xe=()=>{const[R,p]=o.useState([]),[H,v]=o.useState(!0),[h,P]=o.useState("Todos"),[_,C]=o.useState(null),[u,S]=o.useState({}),[U,E]=o.useState(null),{user:n}=Y(),[g,L]=o.useState(""),[z,B]=o.useState(!1),[j,F]=o.useState("feed"),[k,D]=o.useState(""),[V,$]=o.useState(!1),b=Z.useRef(null),[q,I]=o.useState({}),[d,N]=o.useState([]),[G,A]=o.useState(null);o.useEffect(()=>{(async()=>{v(!0);const{data:t,error:s}=await c.from("publicaciones").select("id, titulo, excerpt, imagen_portada, categoria, publicado_en, autor_id").eq("tipo","blog").order("publicado_en",{ascending:!1});if(s){p([]),v(!1),x.error("Error al cargar los blogs");return}const r=await Promise.all((t||[]).map(async i=>{let l={nombre_completo:"Autor",avatar_url:"/default-avatar.png",id:"",nombre_usuario:""};if(i.autor_id){const{data:f}=await c.from("usuarios").select("id, nombre_completo, avatar_url, nombre_usuario").eq("id",i.autor_id).single();f&&(l=f)}const{count:m}=await c.from("comentarios_blog").select("*",{count:"exact",head:!0}).eq("publicacion_id",i.id),{count:w}=await c.from("reacciones_blog").select("*",{count:"exact",head:!0}).eq("publicacion_id",i.id).eq("tipo","like");return{id:i.id,title:i.titulo,excerpt:i.excerpt,coverImage:i.imagen_portada,authorId:l.id,authorUsername:l.nombre_usuario,authorName:l.nombre_completo,authorAvatar:l.avatar_url,published:i.publicado_en,category:i.categoria||"General",commentsCount:m||0,likesCount:w||0}}));p(r),v(!1)})()},[]),o.useEffect(()=>{n&&(async()=>{const{data:e}=await c.from("reacciones_blog").select("publicacion_id").eq("usuario_id",n.id).eq("tipo","like");N(e?e.map(t=>t.publicacion_id):[])})()},[n]);const O=["Todos","Arte","MÃºsica","Cine","Danza","Literatura"],Q=async e=>{if(u[e]){C(_===e?null:e);return}E(e);const{data:t,error:s}=await c.from("comentarios_blog").select("id, contenido, creado_en, autor:usuarios(id, nombre_completo, avatar_url)").eq("publicacion_id",e).order("creado_en",{ascending:!0});S(r=>({...r,[e]:t||[]})),C(e),E(null)},W=async e=>{if(!(!n||!g.trim())){B(!0);try{const{data:t,error:s}=await c.from("comentarios_blog").insert({publicacion_id:e,autor_id:n.id,contenido:g.trim()}).select("id, contenido, creado_en, autor:usuarios(id, nombre_completo, avatar_url)").single();if(s)throw s;S(r=>({...r,[e]:r[e]?[...r[e],t]:[t]})),L(""),x.success("Comentario agregado")}catch{x.error("Error al agregar comentario")}finally{B(!1)}}},J=e=>{var t,s,r,i;if(b.current){const l=b.current,m=l.selectionStart||0,w=l.selectionEnd||0,f=k.slice(0,m)+(e.native||((s=(t=e.skins)==null?void 0:t[0])==null?void 0:s.native)||"")+k.slice(w);D(f),setTimeout(()=>{l.focus(),l.setSelectionRange(m+2,m+2)},0)}else D(k+(e.native||((i=(r=e.skins)==null?void 0:r[0])==null?void 0:i.native)||""));$(!1)},K=e=>{const t=window.location.origin+"/blogs/"+e.id;navigator.share?navigator.share({title:e.title,text:e.excerpt,url:t}).catch(()=>{}):(navigator.clipboard.writeText(t),x.success("Â¡Enlace copiado!"))},X=async e=>{if(!n){x.error("Debes iniciar sesiÃ³n para dar like");return}A(e),d.includes(e)?(await c.from("reacciones_blog").delete().eq("publicacion_id",e).eq("usuario_id",n.id).eq("tipo","like"),N(d.filter(s=>s!==e)),p(s=>s.map(r=>r.id===e?{...r,likesCount:(r.likesCount||1)-1}:r))):(await c.from("reacciones_blog").insert({publicacion_id:e,usuario_id:n.id,tipo:"like"}),N([...d,e]),p(s=>s.map(r=>r.id===e?{...r,likesCount:(r.likesCount||0)+1}:r))),A(null)};return H?a.jsx("div",{className:"py-8 flex justify-center",children:a.jsx(ee,{message:"Cargando artÃ­culos..."})}):a.jsxs("div",{className:"space-y-6 min-h-screen bg-gradient-to-b from-primary-50 via-white to-gray-100 dark:from-gray-900 dark:via-gray-950 dark:to-gray-900",role:"main","aria-label":"Listado de blogs",children:[a.jsxs("header",{className:"py-8 text-center",children:[a.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-primary-700 dark:text-primary-300 drop-shadow-sm mb-2",children:"Blogs culturales"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg",children:"Descubre artÃ­culos, historias y novedades de la comunidad"})]}),a.jsx("div",{className:"flex justify-center gap-4 my-4",children:ce.map(e=>a.jsx("button",{className:`px-5 py-2 rounded-full font-semibold transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary-500 text-base ${j===e.value?"bg-primary-600 text-white shadow-md":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"}`,onClick:()=>F(e.value),"aria-pressed":j===e.value,tabIndex:0,children:e.label},e.value))}),a.jsx("nav",{className:"flex overflow-x-auto pb-2 hide-scrollbar","aria-label":"CategorÃ­as de blogs",children:a.jsx("div",{className:"flex space-x-2",children:O.map(e=>a.jsx(T.button,{onClick:()=>P(e),className:`px-4 py-2 rounded-full text-sm whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-primary-500 ${h===e?"bg-primary-600 text-white shadow":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300"}`,whileTap:{scale:.95},"aria-pressed":h===e,tabIndex:0,children:e},e))})}),a.jsx("div",{className:"space-y-8",children:R.filter(e=>h==="Todos"||e.category===h).slice().sort((e,t)=>j==="feed"?(t.likesCount||0)-(e.likesCount||0):new Date(t.published).getTime()-new Date(e.published).getTime()).map(e=>a.jsx("article",{className:"card p-0 overflow-hidden shadow-lg hover:shadow-2xl transition-shadow duration-200 bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 group",tabIndex:0,"aria-label":`Blog: ${e.title}`,children:a.jsxs("div",{className:"flex flex-col md:flex-row",children:[a.jsx("div",{className:"md:w-1/3 aspect-video md:aspect-square",children:a.jsx("img",{src:e.coverImage,alt:e.title,className:"w-full h-full object-cover rounded-none md:rounded-l-lg border-0 group-hover:scale-105 transition-transform duration-200"})}),a.jsxs("div",{className:"p-6 md:w-2/3 flex flex-col justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-2",children:[a.jsx("span",{className:"bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full",children:e.category}),a.jsx("span",{className:"mx-2",children:"â€¢"}),a.jsxs(y,{to:`/blogs/${e.id}`,className:"flex items-center group hover:underline",children:[a.jsx(ae,{className:"h-3 w-3 mr-1"}),a.jsx("span",{children:new Date(e.published).toLocaleDateString("es-ES")})]})]}),a.jsx("h3",{className:"text-2xl font-bold mb-1 text-gray-900 dark:text-white group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors duration-200",children:e.title}),a.jsx("p",{className:"text-base text-gray-600 dark:text-gray-300 mb-3 line-clamp-3",children:e.excerpt})]}),a.jsxs("div",{className:"flex items-center justify-between mt-4",children:[a.jsxs(y,{to:e.authorUsername?`/profile/${e.authorUsername}`:"#",className:"flex items-center group focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":`Ver perfil de ${e.authorName}`,children:[a.jsx("div",{className:"avatar h-8 w-8 mr-2",children:a.jsx("img",{src:e.authorAvatar,alt:e.authorName,className:"avatar-img rounded-full border border-gray-300 dark:border-gray-700"})}),a.jsx("span",{className:"text-sm font-medium group-hover:underline",children:e.authorName})]}),a.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 gap-4",children:[a.jsxs("button",{className:`flex items-center space-x-1 group ${G===e.id?"opacity-60 pointer-events-none":""}`,onClick:()=>X(e.id),"aria-pressed":d.includes(e.id),title:d.includes(e.id)?"Quitar like":"Dar like",children:[a.jsx(te,{className:`h-5 w-5 transition-colors duration-150 ${d.includes(e.id)?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),a.jsx("span",{className:`text-sm transition-colors duration-150 ${d.includes(e.id)?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:e.likesCount||0})]}),a.jsxs("button",{className:"flex items-center space-x-1 group",onClick:()=>Q(e.id),children:[a.jsx(re,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:e.commentsCount||0})]}),a.jsx("button",{onClick:()=>K(e),className:"ml-2 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500",title:"Compartir blog","aria-label":"Compartir blog",tabIndex:0,children:a.jsx(oe,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]})]}),_===e.id&&a.jsx("div",{className:"px-0 py-3 bg-gray-50 dark:bg-gray-800/50 rounded-b-xl mt-4",children:U===e.id?a.jsx("div",{className:"text-center py-4 text-gray-400",children:"Cargando comentarios..."}):a.jsxs(a.Fragment,{children:[u[e.id]&&u[e.id].length>0&&a.jsxs("div",{className:"mb-3 space-y-3",children:[u[e.id].slice(0,q[e.id]?void 0:2).map(t=>{var s,r,i;return a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"avatar w-8 h-8",children:a.jsx("img",{src:((s=t.autor)==null?void 0:s.avatar_url)||"/default-avatar.png",alt:((r=t.autor)==null?void 0:r.nombre_completo)||"Usuario",className:"avatar-img"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[a.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-white",children:((i=t.autor)==null?void 0:i.nombre_completo)||"Usuario"}),a.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.contenido})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.creado_en).toLocaleDateString("es-ES")})]})]},t.id)}),u[e.id].length>2&&!q[e.id]&&a.jsxs("button",{onClick:()=>I(t=>({...t,[e.id]:!0})),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:["Ver los ",u[e.id].length," comentarios"]})]}),n&&a.jsxs("form",{onSubmit:t=>{t.preventDefault(),W(e.id)},className:"flex items-center space-x-2 relative",children:[a.jsx("div",{className:"avatar w-8 h-8",children:a.jsx("img",{src:n.avatar,alt:n.displayName,className:"avatar-img"})}),a.jsx("input",{ref:b,type:"text",placeholder:"AÃ±ade un comentario...",className:"flex-1 bg-white dark:bg-gray-900 rounded-full px-4 py-2 text-sm border border-gray-200 dark:border-gray-700 focus:ring-1 focus:ring-primary-500 focus:border-primary-500",value:g,onChange:t=>L(t.target.value)}),a.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>$(t=>!t),"aria-label":"Insertar emoji",tabIndex:-1,children:a.jsx("span",{role:"img","aria-label":"emoji",children:"ðŸ˜Š"})}),a.jsx("button",{type:"submit",disabled:!g.trim()||z,className:"text-sm font-medium text-primary-600 dark:text-primary-400 disabled:opacity-50",children:"Publicar"}),V&&a.jsx("div",{className:"absolute z-50 bottom-12 right-0",children:a.jsx(se,{data:ie,onEmojiSelect:J,theme:"auto"})})]})]})}),a.jsx("div",{className:"flex items-center gap-4 mt-4",children:a.jsxs(y,{to:`/blogs/${e.id}`,className:"btn btn-primary px-4 py-2 rounded-full text-white font-semibold shadow hover:scale-105 transition-transform duration-150",tabIndex:0,children:["Leer artÃ­culo ",a.jsx(ne,{className:"inline ml-2 h-4 w-4"})]})})]})]})},e.id))}),a.jsx("div",{className:"fixed bottom-20 right-4 z-40",children:a.jsx(y,{to:"/blogs/new",children:a.jsx(T.button,{className:"btn btn-primary rounded-full p-4 shadow-lg text-lg focus:outline-none focus:ring-2 focus:ring-primary-500",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Crear nuevo blog",tabIndex:0,children:a.jsx(le,{className:"h-6 w-6"})})})})]})};export{xe as default};
