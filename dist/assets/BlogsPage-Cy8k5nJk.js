import{c as I,r as o,b as U,j as a,L as V,m as _,g as y,s as l,a as p}from"./index-BrRfBUNT.js";import{C as P}from"./calendar-0MwshDPY.js";import{S as W}from"./share-2-2ppTR6CC.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=I("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),F=[{label:"Para ti",value:"feed"},{label:"Lo último",value:"timeline"}],J=()=>{const[S,v]=o.useState([]),[L,h]=o.useState(!0),[m,E]=o.useState("Todos"),[u,b]=o.useState(null),[g,j]=o.useState({}),[B,N]=o.useState(null),{user:c}=U(),[d,w]=o.useState(""),[x,k]=o.useState(!1),[f,A]=o.useState("feed");o.useEffect(()=>{(async()=>{h(!0);const{data:r,error:t}=await l.from("publicaciones").select("id, titulo, excerpt, imagen_portada, categoria, publicado_en, autor_id").eq("tipo","blog").order("publicado_en",{ascending:!1});if(t){v([]),h(!1),p.error("Error al cargar los blogs");return}const i=await Promise.all((r||[]).map(async s=>{let n={nombre_completo:"Autor",avatar_url:"/default-avatar.png",id:"",nombre_usuario:""};if(s.autor_id){const{data:C}=await l.from("usuarios").select("id, nombre_completo, avatar_url, nombre_usuario").eq("id",s.autor_id).single();C&&(n=C)}const{count:q}=await l.from("comentarios_blog").select("*",{count:"exact",head:!0}).eq("publicacion_id",s.id),{count:H}=await l.from("reacciones_blog").select("*",{count:"exact",head:!0}).eq("publicacion_id",s.id).eq("tipo","like");return{id:s.id,title:s.titulo,excerpt:s.excerpt,coverImage:s.imagen_portada,authorId:n.id,authorUsername:n.nombre_usuario,authorName:n.nombre_completo,authorAvatar:n.avatar_url,published:s.publicado_en,category:s.categoria||"General",commentsCount:q||0,likesCount:H||0}}));v(i),h(!1)})()},[]);const D=["Todos","Arte","Música","Cine","Danza","Literatura"],$=async e=>{if(g[e]){b(u===e?null:e);return}N(e);const{data:r,error:t}=await l.from("comentarios_blog").select("id, contenido, creado_en, autor:usuarios(id, nombre_completo, avatar_url)").eq("publicacion_id",e).order("creado_en",{ascending:!0});j(i=>({...i,[e]:r||[]})),b(e),N(null)},M=async e=>{if(!(!c||!d.trim())){k(!0);try{const{data:r,error:t}=await l.from("comentarios_blog").insert({publicacion_id:e,autor_id:c.id,contenido:d.trim()}).select("id, contenido, creado_en, autor:usuarios(id, nombre_completo, avatar_url)").single();if(t)throw t;j(i=>({...i,[e]:i[e]?[...i[e],r]:[r]})),w(""),p.success("Comentario agregado")}catch{p.error("Error al agregar comentario")}finally{k(!1)}}},T=e=>{const r=window.location.origin+"/blogs/"+e.id;navigator.share?navigator.share({title:e.title,text:e.excerpt,url:r}).catch(()=>{}):(navigator.clipboard.writeText(r),p.success("¡Enlace copiado!"))};return L?a.jsx("div",{className:"py-8 flex justify-center",children:a.jsx(V,{message:"Cargando artículos..."})}):a.jsxs("div",{className:"space-y-6",role:"main","aria-label":"Listado de blogs",children:[a.jsx("div",{className:"flex justify-center gap-4 my-4",children:F.map(e=>a.jsx("button",{className:`px-5 py-2 rounded-full font-semibold transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary-500 text-base ${f===e.value?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"}`,onClick:()=>A(e.value),"aria-pressed":f===e.value,tabIndex:0,children:e.label},e.value))}),a.jsx("nav",{className:"flex overflow-x-auto pb-2 hide-scrollbar","aria-label":"Categorías de blogs",children:a.jsx("div",{className:"flex space-x-2",children:D.map(e=>a.jsx(_.button,{onClick:()=>E(e),className:`px-4 py-2 rounded-full text-sm whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-primary-500 ${m===e?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300"}`,whileTap:{scale:.95},"aria-pressed":m===e,tabIndex:0,children:e},e))})}),a.jsx("div",{className:"space-y-4",children:S.filter(e=>m==="Todos"||e.category===m).slice().sort((e,r)=>f==="feed"?(r.likesCount||0)-(e.likesCount||0):new Date(r.published).getTime()-new Date(e.published).getTime()).map(e=>{var r;return a.jsx("article",{className:"card p-4",tabIndex:0,"aria-label":`Blog: ${e.title}`,children:a.jsxs("div",{className:"flex flex-col md:flex-row",children:[a.jsx("div",{className:"md:w-1/3 aspect-video md:aspect-square",children:a.jsx("img",{src:e.coverImage,alt:e.title,className:"w-full h-full object-cover rounded-lg border border-gray-200 dark:border-gray-700"})}),a.jsxs("div",{className:"p-4 md:w-2/3",children:[a.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-2",children:[a.jsx("span",{className:"bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full",children:e.category}),a.jsx("span",{className:"mx-2",children:"•"}),a.jsxs(y,{to:`/blogs/${e.id}`,className:"flex items-center group hover:underline",children:[a.jsx(P,{className:"h-3 w-3 mr-1"}),a.jsx("span",{children:new Date(e.published).toLocaleDateString("es-ES")})]})]}),a.jsx("h3",{className:"text-lg font-bold mb-1 text-gray-900 dark:text-white",children:e.title}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3",children:e.excerpt}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(y,{to:e.authorUsername?`/profile/${e.authorUsername}`:"#",className:"flex items-center group focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":`Ver perfil de ${e.authorName}`,children:[a.jsx("div",{className:"avatar h-6 w-6 mr-2",children:a.jsx("img",{src:e.authorAvatar,alt:e.authorName,className:"avatar-img rounded-full border border-gray-300 dark:border-gray-700"})}),a.jsx("span",{className:"text-xs font-medium group-hover:underline",children:e.authorName})]}),a.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[a.jsxs("span",{className:"flex items-center mr-4","aria-label":"Comentarios",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-8 18v-4m8 4v-4m-8 0H3m18 0h-3"})}),e.commentsCount||0]}),a.jsxs("span",{className:"flex items-center","aria-label":"Me gusta",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v8m4-4H8"})}),e.likesCount||0]})]})]}),a.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[a.jsx("button",{className:"text-primary-600 underline text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",onClick:()=>$(e.id),"aria-expanded":u===e.id,"aria-controls":`comentarios-blog-${e.id}`,tabIndex:0,children:u===e.id?"Ocultar comentarios":`Ver comentarios (${e.commentsCount})`}),a.jsxs("span",{className:"text-gray-500 text-xs",children:["❤️ ",e.likesCount]}),a.jsx("button",{onClick:()=>T(e),className:"ml-2 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500",title:"Compartir blog","aria-label":"Compartir blog",tabIndex:0,children:a.jsx(W,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),u===e.id&&a.jsxs("div",{className:"mt-3 border-t pt-3",id:`comentarios-blog-${e.id}`,role:"region","aria-label":`Comentarios de ${e.title}`,children:[B===e.id?a.jsx("div",{className:"text-sm text-gray-500",children:"Cargando comentarios..."}):((r=g[e.id])==null?void 0:r.length)===0?a.jsx("div",{className:"text-sm text-gray-400",children:"Sin comentarios aún."}):a.jsx("ul",{className:"space-y-2",children:g[e.id].map(t=>{var i,s,n;return a.jsxs("li",{className:"flex gap-2 items-start",children:[a.jsx("img",{src:((i=t.autor)==null?void 0:i.avatar_url)||"/default-avatar.png",alt:((s=t.autor)==null?void 0:s.nombre_completo)||"Usuario",className:"w-8 h-8 rounded-full border border-gray-300 dark:border-gray-700"}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm",children:((n=t.autor)==null?void 0:n.nombre_completo)||"Usuario"}),a.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:t.contenido}),a.jsx("span",{className:"text-xs text-gray-400",children:new Date(t.creado_en).toLocaleString("es-ES")})]})]},t.id)})}),c&&a.jsxs("form",{className:"flex gap-2 items-center mt-4",onSubmit:t=>{t.preventDefault(),M(e.id)},role:"form","aria-label":"Agregar comentario",children:[a.jsx("img",{src:c.avatar,alt:c.displayName,className:"w-8 h-8 rounded-full border border-gray-300 dark:border-gray-700"}),a.jsx("input",{type:"text",className:"flex-1 input",placeholder:"Escribe un comentario...",value:d,onChange:t=>w(t.target.value),disabled:x,maxLength:300,"aria-label":"Escribe un comentario"}),a.jsx("button",{type:"submit",className:"btn btn-primary px-4 py-2 text-base focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:x||!d.trim(),"aria-disabled":x||!d.trim(),children:x?"Enviando...":"Comentar"})]})]})]})]})},e.id)})}),a.jsx("div",{className:"fixed bottom-20 right-4 z-40",children:a.jsx(y,{to:"/blogs/new",children:a.jsx(_.button,{className:"btn btn-primary rounded-full p-4 shadow-lg text-lg focus:outline-none focus:ring-2 focus:ring-primary-500",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Crear nuevo blog",tabIndex:0,children:a.jsx(z,{className:"h-6 w-6"})})})})]})};export{J as default};
