import{c as V,r as n,u as W,j as a,L as $,m as S,b as z,s as l,a as f}from"./index-CbDr9Sw3.js";import{C as F}from"./calendar-BycWQP9m.js";import{S as O}from"./share-2-CVriX9b-.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=V("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),G=[{label:"Para ti",value:"feed"},{label:"Lo último",value:"timeline"}],Q=()=>{const[L,v]=n.useState([]),[E,m]=n.useState(!0),[u,B]=n.useState("Todos"),[x,j]=n.useState(null),[p,y]=n.useState({}),[D,N]=n.useState(null),{user:o}=W(),[c,w]=n.useState(""),[h,k]=n.useState(!1),[g,A]=n.useState("feed");n.useEffect(()=>{(async()=>{m(!0);const{data:t,error:s}=await l.from("publicaciones").select("id, titulo, excerpt, imagen_portada, categoria, publicado_en, autor:usuarios(id, nombre_completo, avatar_url)").eq("tipo","blog").order("publicado_en",{ascending:!1});if(s){v([]),m(!1);return}const i=await Promise.all((t||[]).map(async r=>{var C,b,_;const{count:d}=await l.from("comentarios_blog").select("*",{count:"exact",head:!0}).eq("publicacion_id",r.id),{count:P}=await l.from("reacciones_blog").select("*",{count:"exact",head:!0}).eq("publicacion_id",r.id).eq("tipo","like");return{id:r.id,title:r.titulo,excerpt:r.excerpt,coverImage:r.imagen_portada,authorId:((C=r.autor)==null?void 0:C.id)||"",authorName:((b=r.autor)==null?void 0:b.nombre_completo)||"Autor",authorAvatar:((_=r.autor)==null?void 0:_.avatar_url)||"",published:r.publicado_en,category:r.categoria||"General",commentsCount:d||0,likesCount:P||0}}));v(i),m(!1)})()},[]);const T=["Todos","Arte","Música","Cine","Danza","Literatura"],M=async e=>{if(p[e]){j(x===e?null:e);return}N(e);const{data:t,error:s}=await l.from("comentarios_blog").select("id, contenido, creado_en, autor:usuarios(id, nombre_completo, avatar_url)").eq("publicacion_id",e).order("creado_en",{ascending:!0});y(i=>({...i,[e]:t||[]})),j(e),N(null)},q=async e=>{if(!(!o||!c.trim())){k(!0);try{const{data:t,error:s}=await l.from("comentarios_blog").insert({publicacion_id:e,autor_id:o.id,contenido:c.trim()}).select("id, contenido, creado_en, autor:usuarios(id, nombre_completo, avatar_url)").single();if(s)throw s;y(i=>({...i,[e]:i[e]?[...i[e],t]:[t]})),w(""),f.success("Comentario agregado")}catch{f.error("Error al agregar comentario")}finally{k(!1)}}},H=e=>{const t=window.location.origin+"/blogs/"+e.id;navigator.share?navigator.share({title:e.title,text:e.excerpt,url:t}).catch(()=>{}):(navigator.clipboard.writeText(t),f.success("¡Enlace copiado!"))};return E?a.jsx("div",{className:"py-8 flex justify-center",children:a.jsx($,{message:"Cargando artículos..."})}):a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex justify-center gap-4 my-4",children:G.map(e=>a.jsx("button",{className:`px-4 py-2 rounded-full font-semibold transition-colors duration-150 ${g===e.value?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"}`,onClick:()=>A(e.value),"aria-pressed":g===e.value,children:e.label},e.value))}),a.jsx("div",{className:"flex overflow-x-auto pb-2 hide-scrollbar",children:a.jsx("div",{className:"flex space-x-2",children:T.map(e=>a.jsx(S.button,{onClick:()=>B(e),className:`px-4 py-1.5 rounded-full text-sm whitespace-nowrap ${u===e?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300"}`,whileTap:{scale:.95},children:e},e))})}),a.jsx("div",{className:"space-y-4",children:L.filter(e=>u==="Todos"||e.category===u).slice().sort((e,t)=>g==="feed"?(t.likesCount||0)-(e.likesCount||0):new Date(t.published).getTime()-new Date(e.published).getTime()).map(e=>{var t;return a.jsx("div",{className:"card p-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row",children:[a.jsx("div",{className:"md:w-1/3 aspect-video md:aspect-square",children:a.jsx("img",{src:e.coverImage,alt:e.title,className:"w-full h-full object-cover"})}),a.jsxs("div",{className:"p-4 md:w-2/3",children:[a.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-2",children:[a.jsx("span",{className:"bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full",children:e.category}),a.jsx("span",{className:"mx-2",children:"•"}),a.jsx(F,{className:"h-3 w-3 mr-1"}),a.jsx("span",{children:new Date(e.published).toLocaleDateString("es-ES")})]}),a.jsx("h3",{className:"text-lg font-bold mb-1 text-gray-900 dark:text-white",children:e.title}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3",children:e.excerpt}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"avatar h-6 w-6 mr-2",children:a.jsx("img",{src:e.authorAvatar,alt:e.authorName,className:"avatar-img"})}),a.jsx("span",{className:"text-xs font-medium",children:e.authorName})]}),a.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[a.jsxs("span",{className:"flex items-center mr-4",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-8 18v-4m8 4v-4m-8 0H3m18 0h-3"})}),e.commentsCount||0]}),a.jsxs("span",{className:"flex items-center",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v8m4-4H8"})}),e.likesCount||0]})]})]}),a.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[a.jsx("button",{className:"text-primary-600 underline text-sm",onClick:()=>M(e.id),children:x===e.id?"Ocultar comentarios":`Ver comentarios (${e.commentsCount})`}),a.jsxs("span",{className:"text-gray-500 text-xs",children:["❤️ ",e.likesCount]}),a.jsx("button",{onClick:()=>H(e),className:"ml-2 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",title:"Compartir blog","aria-label":"Compartir blog",children:a.jsx(O,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),x===e.id&&a.jsxs("div",{className:"mt-3 border-t pt-3",children:[D===e.id?a.jsx("div",{className:"text-sm text-gray-500",children:"Cargando comentarios..."}):((t=p[e.id])==null?void 0:t.length)===0?a.jsx("div",{className:"text-sm text-gray-400",children:"Sin comentarios aún."}):a.jsx("ul",{className:"space-y-2",children:p[e.id].map(s=>{var i,r,d;return a.jsxs("li",{className:"flex gap-2 items-start",children:[a.jsx("img",{src:((i=s.autor)==null?void 0:i.avatar_url)||"/default-avatar.png",alt:((r=s.autor)==null?void 0:r.nombre_completo)||"Usuario",className:"w-8 h-8 rounded-full"}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm",children:((d=s.autor)==null?void 0:d.nombre_completo)||"Usuario"}),a.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:s.contenido}),a.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.creado_en).toLocaleString("es-ES")})]})]},s.id)})}),o&&a.jsxs("form",{className:"flex gap-2 items-center mt-4",onSubmit:s=>{s.preventDefault(),q(e.id)},children:[a.jsx("img",{src:o.avatar,alt:o.displayName,className:"w-8 h-8 rounded-full"}),a.jsx("input",{type:"text",className:"flex-1 input",placeholder:"Escribe un comentario...",value:c,onChange:s=>w(s.target.value),disabled:h,maxLength:300}),a.jsx("button",{type:"submit",className:"btn btn-primary px-4 py-2",disabled:h||!c.trim(),children:h?"Enviando...":"Comentar"})]})]})]})]})},e.id)})}),a.jsx("div",{className:"fixed bottom-20 right-4 z-40",children:a.jsx(z,{to:"/blogs/new",children:a.jsx(S.button,{className:"btn btn-primary rounded-full p-3 shadow-lg",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Crear nuevo blog",children:a.jsx(U,{className:"h-5 w-5"})})})})]})};export{Q as default};
