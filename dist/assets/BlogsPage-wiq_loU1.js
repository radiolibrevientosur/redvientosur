import{c as A,r as i,e as Y,R as Z,s as l,j as a,L as ee,S as ae,m as T,q as g,C as te,H as se,M as re,d as f}from"./index-CkCNI7dU.js";import{$ as ie,d as oe}from"./native-DGJ9haqb.js";import{S as ne}from"./share-2-D6YOoNpV.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],ce=A("arrow-right",le);/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],ue=A("book",de),me=[{label:"Para ti",value:"feed"},{label:"Lo último",value:"timeline"}],ge=()=>{const[M,y]=i.useState([]),[R,N]=i.useState(!0),[x,H]=i.useState("Todos"),[w,_]=i.useState(null),[d,C]=i.useState({}),[P,S]=i.useState(null),{user:o}=Y(),[p,E]=i.useState(""),[z,L]=i.useState(!1),[v,U]=i.useState("feed"),[j,$]=i.useState(""),[F,q]=i.useState(!1),k=Z.useRef(null),[B,V]=i.useState({}),[c,b]=i.useState([]),[I,D]=i.useState(null);i.useEffect(()=>{(async()=>{N(!0);const{data:t}=await l.from("publicaciones").select("id, titulo, excerpt, imagen_portada, categoria, publicado_en, autor_id").eq("tipo","blog").order("publicado_en",{ascending:!1}),r=await Promise.all((t||[]).map(async s=>{let n={nombre_completo:"Autor",avatar_url:"/default-avatar.png",id:"",nombre_usuario:""};if(s.autor_id){const{data:h}=await l.from("usuarios").select("id, nombre_completo, avatar_url, nombre_usuario").eq("id",s.autor_id).single();h&&(n=h)}const{count:u}=await l.from("comentarios_blog").select("*",{count:"exact",head:!0}).eq("publicacion_id",s.id),{count:m}=await l.from("reacciones_blog").select("*",{count:"exact",head:!0}).eq("publicacion_id",s.id).eq("tipo","like");return{id:s.id,title:s.titulo,excerpt:s.excerpt,coverImage:s.imagen_portada,authorId:n.id,authorUsername:n.nombre_usuario,authorName:n.nombre_completo,authorAvatar:n.avatar_url,published:s.publicado_en,category:s.categoria||"General",commentsCount:u||0,likesCount:m||0}}));y(r),N(!1)})()},[]),i.useEffect(()=>{o&&(async()=>{const{data:e}=await l.from("reacciones_blog").select("publicacion_id").eq("usuario_id",o.id).eq("tipo","like");b(e?e.map(t=>t.publicacion_id):[])})()},[o]);const G=["Todos","Arte","Música","Cine","Danza","Literatura"],O=async e=>{if(d[e]){_(w===e?null:e);return}S(e);const{data:t}=await l.from("comentarios_blog").select("id, contenido, creado_en, autor:usuarios(id, nombre_completo, avatar_url)").eq("publicacion_id",e).order("creado_en",{ascending:!0});C(r=>({...r,[e]:t||[]})),_(e),S(null)},Q=async e=>{if(!(!o||!p.trim())){L(!0);try{const{data:t,error:r}=await l.from("comentarios_blog").insert({publicacion_id:e,autor_id:o.id,contenido:p.trim()}).select("id, contenido, creado_en, autor:usuarios(id, nombre_completo, avatar_url)").single();if(r)throw r;C(s=>({...s,[e]:s[e]?[...s[e],t]:[t]})),E(""),f.success("Comentario agregado")}catch{f.error("Error al agregar comentario")}finally{L(!1)}}},W=e=>{var t,r,s,n;if(k.current){const u=k.current,m=u.selectionStart||0,h=u.selectionEnd||0,X=j.slice(0,m)+(e.native||((r=(t=e.skins)==null?void 0:t[0])==null?void 0:r.native)||"")+j.slice(h);$(X),setTimeout(()=>{u.focus(),u.setSelectionRange(m+2,m+2)},0)}else $(j+(e.native||((n=(s=e.skins)==null?void 0:s[0])==null?void 0:n.native)||""));q(!1)},J=e=>{const t=window.location.origin+"/blogs/"+e.id;navigator.share?navigator.share({title:e.title,text:e.excerpt,url:t}).catch(()=>{}):(navigator.clipboard.writeText(t),f.success("¡Enlace copiado!"))},K=async e=>{if(!o){f.error("Debes iniciar sesión para dar like");return}D(e),c.includes(e)?(await l.from("reacciones_blog").delete().eq("publicacion_id",e).eq("usuario_id",o.id).eq("tipo","like"),b(c.filter(r=>r!==e)),y(r=>r.map(s=>s.id===e?{...s,likesCount:(s.likesCount||1)-1}:s))):(await l.from("reacciones_blog").insert({publicacion_id:e,usuario_id:o.id,tipo:"like"}),b([...c,e]),y(r=>r.map(s=>s.id===e?{...s,likesCount:(s.likesCount||0)+1}:s))),D(null)};return R?a.jsx("div",{className:"py-8 flex justify-center",children:a.jsx(ee,{message:"Cargando artículos..."})}):a.jsxs("div",{className:"max-w-full sm:max-w-2xl mx-auto p-2 sm:p-4 pb-24",children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-4 text-primary-700 dark:text-primary-300 text-center",children:"Blogs"}),a.jsx("div",{className:"flex justify-center gap-4 my-4",children:me.map(e=>a.jsx("button",{className:`px-5 py-2 rounded-full font-semibold transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-primary-500 text-base ${v===e.value?"bg-primary-600 text-white shadow-md":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"}`,onClick:()=>U(e.value),"aria-pressed":v===e.value,tabIndex:0,children:e.label},e.value))}),a.jsx("div",{className:"block sm:hidden mb-4",children:a.jsx(ae,{})}),a.jsx("nav",{className:"flex overflow-x-auto pb-2 hide-scrollbar","aria-label":"Categorías de blogs",children:a.jsx("div",{className:"flex space-x-2",children:G.map(e=>a.jsx(T.button,{onClick:()=>H(e),className:`px-4 py-2 rounded-full text-sm whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-primary-500 ${x===e?"bg-primary-600 text-white shadow":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300"}`,whileTap:{scale:.95},"aria-pressed":x===e,tabIndex:0,children:e},e))})}),a.jsx("div",{className:"space-y-8",children:M.filter(e=>x==="Todos"||e.category===x).slice().sort((e,t)=>v==="feed"?(t.likesCount||0)-(e.likesCount||0):new Date(t.published).getTime()-new Date(e.published).getTime()).map(e=>a.jsx("article",{className:"card p-0 overflow-hidden shadow-lg hover:shadow-2xl transition-shadow duration-200 bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 group",tabIndex:0,"aria-label":`Blog: ${e.title}`,children:a.jsxs("div",{className:"flex flex-col md:flex-row",children:[a.jsx("div",{className:"md:w-1/3 aspect-video md:aspect-square",children:a.jsx("img",{src:e.coverImage,alt:e.title,className:"w-full h-full object-cover rounded-none md:rounded-l-lg border-0 group-hover:scale-105 transition-transform duration-200"})}),a.jsxs("div",{className:"p-6 md:w-2/3 flex flex-col justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-2",children:[a.jsx("span",{className:"bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full",children:e.category}),a.jsx("span",{className:"mx-2",children:"•"}),a.jsxs(g,{to:`/blogs/${e.id}`,className:"flex items-center group hover:underline",children:[a.jsx(te,{className:"h-3 w-3 mr-1"}),a.jsx("span",{children:new Date(e.published).toLocaleDateString("es-ES")})]})]}),a.jsx("h3",{className:"text-2xl font-bold mb-1 text-gray-900 dark:text-white group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors duration-200",children:e.title}),a.jsx("p",{className:"text-base text-gray-600 dark:text-gray-300 mb-3 line-clamp-3",children:e.excerpt})]}),a.jsxs("div",{className:"flex items-center justify-between mt-4",children:[a.jsxs(g,{to:e.authorUsername?`/profile/${e.authorUsername}`:"#",className:"flex items-center group focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":`Ver perfil de ${e.authorName}`,children:[a.jsx("div",{className:"avatar h-8 w-8 mr-2",children:a.jsx("img",{src:e.authorAvatar,alt:e.authorName,className:"avatar-img rounded-full border border-gray-300 dark:border-gray-700"})}),a.jsx("span",{className:"text-sm font-medium group-hover:underline",children:e.authorName})]}),a.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 gap-4",children:[a.jsxs("button",{className:`flex items-center space-x-1 group ${I===e.id?"opacity-60 pointer-events-none":""}`,onClick:()=>K(e.id),"aria-pressed":c.includes(e.id),title:c.includes(e.id)?"Quitar like":"Dar like",children:[a.jsx(se,{className:`h-5 w-5 transition-colors duration-150 ${c.includes(e.id)?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),a.jsx("span",{className:`text-sm transition-colors duration-150 ${c.includes(e.id)?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:e.likesCount||0})]}),a.jsxs("button",{className:"flex items-center space-x-1 group",onClick:()=>O(e.id),children:[a.jsx(re,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:e.commentsCount||0})]}),a.jsx("button",{onClick:()=>J(e),className:"ml-2 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500",title:"Compartir blog","aria-label":"Compartir blog",tabIndex:0,children:a.jsx(ne,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]})]}),w===e.id&&a.jsx("div",{className:"px-0 py-3 bg-gray-50 dark:bg-gray-800/50 rounded-b-xl mt-4",children:P===e.id?a.jsx("div",{className:"text-center py-4 text-gray-400",children:"Cargando comentarios..."}):a.jsxs(a.Fragment,{children:[d[e.id]&&d[e.id].length>0&&a.jsxs("div",{className:"mb-3 space-y-3",children:[d[e.id].slice(0,B[e.id]?void 0:2).map(t=>{var r,s,n;return a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"avatar w-8 h-8",children:a.jsx("img",{src:((r=t.autor)==null?void 0:r.avatar_url)||"/default-avatar.png",alt:((s=t.autor)==null?void 0:s.nombre_completo)||"Usuario",className:"avatar-img"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[a.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-white",children:((n=t.autor)==null?void 0:n.nombre_completo)||"Usuario"}),a.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.contenido})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.creado_en).toLocaleDateString("es-ES")})]})]},t.id)}),d[e.id].length>2&&!B[e.id]&&a.jsxs("button",{onClick:()=>V(t=>({...t,[e.id]:!0})),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:["Ver los ",d[e.id].length," comentarios"]})]}),o&&a.jsxs("form",{onSubmit:t=>{t.preventDefault(),Q(e.id)},className:"flex items-center space-x-2 relative",children:[a.jsx("div",{className:"avatar w-8 h-8",children:a.jsx("img",{src:o.avatar,alt:o.displayName,className:"avatar-img"})}),a.jsx("input",{ref:k,type:"text",placeholder:"Añade un comentario...",className:"flex-1 bg-white dark:bg-gray-900 rounded-full px-4 py-2 text-sm border border-gray-200 dark:border-gray-700 focus:ring-1 focus:ring-primary-500 focus:border-primary-500",value:p,onChange:t=>E(t.target.value)}),a.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>q(t=>!t),"aria-label":"Insertar emoji",tabIndex:-1,children:a.jsx("span",{role:"img","aria-label":"emoji",children:"😊"})}),a.jsx("button",{type:"submit",disabled:!p.trim()||z,className:"text-sm font-medium text-primary-600 dark:text-primary-400 disabled:opacity-50",children:"Publicar"}),F&&a.jsx("div",{className:"absolute z-50 bottom-12 right-0",children:a.jsx(ie,{data:oe,onEmojiSelect:W,theme:"auto"})})]})]})}),a.jsx("div",{className:"flex items-center gap-4 mt-4",children:a.jsxs(g,{to:`/blogs/${e.id}`,className:"btn btn-primary px-4 py-2 rounded-full text-white font-semibold shadow hover:scale-105 transition-transform duration-150",tabIndex:0,children:["Leer artículo ",a.jsx(ce,{className:"inline ml-2 h-4 w-4"})]})})]})]})},e.id))}),a.jsx("div",{className:"fixed bottom-20 right-4 z-40",children:a.jsx(g,{to:"/blogs/new",children:a.jsx(T.button,{className:"btn btn-primary rounded-full p-4 shadow-lg text-lg focus:outline-none focus:ring-2 focus:ring-primary-500",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Crear nuevo blog",tabIndex:0,children:a.jsx(ue,{className:"h-6 w-6"})})})})]})};export{ge as default};
