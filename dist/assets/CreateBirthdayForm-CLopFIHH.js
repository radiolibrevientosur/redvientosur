import{c as E,j as e,r as n,R as q,s as d,d as f}from"./index-CkCNI7dU.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8",key:"1w3rig"}],["path",{d:"M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1",key:"n2jgmb"}],["path",{d:"M2 21h20",key:"1nyx9w"}],["path",{d:"M7 8v3",key:"1qtyvj"}],["path",{d:"M12 8v3",key:"hwp4zt"}],["path",{d:"M17 8v3",key:"1i6e5u"}],["path",{d:"M7 4h.01",key:"1bh4kh"}],["path",{d:"M12 4h.01",key:"1ujb9j"}],["path",{d:"M17 4h.01",key:"1upcoc"}]],F=E("cake",z),U=["üéâ","üéÇ","ü•≥","üéà","üéÅ","üòä","ü•∞","üíñ","üç∞","üçæ","‚ú®","üåü","üéä","üòÉ","üòé","ü§©","üôå","üëè","üíê","üßÅ","üç¨","üç≠","üç¶","üç®","üçß","üç°","üç™","üç´","üç©","üçÆ","üçØ","üçµ","‚òï","üßÉ","ü•§","üçπ","üç∏","üç∑","ü•Ç","üçª","üç∫","ü•É","üßâ","üßä","üçæ","ü•Ñ","üçΩÔ∏è","ü•¢","üç¥","ü•Ñ","üçΩÔ∏è","ü•¢","üç¥"],I=Array.from(new Set(U)),L=({onSelect:g})=>e.jsx("div",{className:"flex flex-wrap gap-2 p-2 bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 max-w-xs",children:I.map((c,t)=>e.jsx("button",{type:"button",className:"text-2xl hover:scale-125 transition-transform focus:outline-none",onClick:()=>g(c),children:c},c+"-"+t))}),$=({onSuccess:g,onCancel:c,initialData:t})=>{const[p,j]=n.useState(""),[r,x]=n.useState(null),[b,k]=n.useState(""),[m,h]=n.useState(""),[u,N]=n.useState(null),[y,w]=n.useState(!1),[_,v]=n.useState(!1);q.useEffect(()=>{async function a(){var l,i;const{data:{user:s}}=await d.auth.getUser();if(s){const{data:o}=await d.from("usuarios").select("*").eq("id",s.id).single();x(o||{id:s.id,nombre_completo:((l=s.user_metadata)==null?void 0:l.nombre_completo)||"",nombre_usuario:((i=s.user_metadata)==null?void 0:i.nombre_usuario)||""})}}t?(j(t.nombre||""),x(t.usuario||null),k(t.fecha_nacimiento||""),h(t.mensaje||"")):a()},[t]);const C=a=>{a.target.files&&a.target.files[0]&&N(a.target.files[0])},S=async a=>{if(a.preventDefault(),!(r!=null&&r.id)){f.error("No se detect√≥ el usuario autenticado. Por favor, inicia sesi√≥n nuevamente.");return}w(!0);let s="";try{if(u){const i=`cumpleanos/${Date.now()}_${u.name}`,{error:o}=await d.storage.from("cumpleanos-media").upload(i,u,{upsert:!0});if(o)throw o;const{data:M}=d.storage.from("cumpleanos-media").getPublicUrl(i);s=M.publicUrl}let l;if(t&&t.id){const{data:i,error:o}=await d.from("cumpleanos").update({nombre:p,usuario_id:(r==null?void 0:r.id)||null,fecha_nacimiento:b,mensaje:m,imagen_url:s||t.imagen_url}).eq("id",t.id).select().single();if(o)throw o;l=i}else{const{data:i,error:o}=await d.from("cumpleanos").insert({nombre:p,usuario_id:(r==null?void 0:r.id)||null,fecha_nacimiento:b,mensaje:m,imagen_url:s}).select().single();if(o)throw o;l=i,await d.from("eventos").insert({titulo:`Cumplea√±os de ${p}`,descripcion:m,tipo:"birthday",fecha_inicio:b,creador_id:(r==null?void 0:r.id)||null,imagen_url:s||null})}f.success(t&&t.id?"Cumplea√±os actualizado":"Cumplea√±os creado exitosamente"),g(l)}catch(l){f.error("Error al crear/actualizar cumplea√±os: "+l.message)}finally{w(!1)}};return e.jsxs("form",{onSubmit:S,className:"space-y-8 bg-white dark:bg-gray-900 p-8 rounded-2xl shadow-xl max-w-lg mx-auto border border-gray-100 dark:border-gray-800",children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-primary-700 dark:text-primary-300 mb-6 flex items-center justify-center gap-2",children:"üéâ Crear Cumplea√±os"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-200",children:"Imagen"}),e.jsxs("div",{className:"relative w-28 h-28 mb-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:C,className:"absolute inset-0 opacity-0 cursor-pointer z-10 w-full h-full"}),e.jsx("div",{className:"w-28 h-28 rounded-full border-4 border-primary-300 dark:border-primary-700 bg-gray-100 dark:bg-gray-800 flex items-center justify-center overflow-hidden shadow",children:u?e.jsx("img",{src:URL.createObjectURL(u),alt:"preview",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-gray-400 text-4xl",children:"+"})})]}),e.jsx("span",{className:"text-xs text-gray-400",children:"Haz clic para subir una imagen"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-200",children:"Nombre de usuario"}),e.jsx("input",{type:"text",className:"input w-full rounded-lg border-2 border-primary-200 dark:border-primary-700 focus:ring-2 focus:ring-primary-400 focus:border-primary-400 dark:bg-gray-800 dark:text-white transition",value:(r==null?void 0:r.nombre_usuario)||"",onChange:a=>x(r?{...r,nombre_usuario:a.target.value}:{id:"",nombre_completo:"",nombre_usuario:a.target.value}),placeholder:"usuario123",required:!0}),(r==null?void 0:r.nombre_usuario)&&e.jsxs("a",{href:`/profile/${r.nombre_usuario}`,className:"block mt-1 text-primary-600 dark:text-primary-400 hover:underline text-sm",target:"_blank",rel:"noopener noreferrer",children:["Ver perfil de @",r.nombre_usuario]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-200",children:"Nombre"}),e.jsx("input",{type:"text",className:"input w-full rounded-lg border-2 border-primary-200 dark:border-primary-700 focus:ring-2 focus:ring-primary-400 focus:border-primary-400 dark:bg-gray-800 dark:text-white transition",value:p,onChange:a=>j(a.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-200",children:"Fecha de nacimiento"}),e.jsx("input",{type:"date",className:"input w-full rounded-lg border-2 border-primary-200 dark:border-primary-700 focus:ring-2 focus:ring-primary-400 focus:border-primary-400 dark:bg-gray-800 dark:text-white transition",value:b,onChange:a=>k(a.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1 text-gray-700 dark:text-gray-200",children:"Mensaje de felicitaci√≥n"}),e.jsxs("div",{className:"relative bg-primary-50 dark:bg-primary-900/30 rounded-xl p-3 border border-primary-100 dark:border-primary-800 flex flex-col gap-2",children:[e.jsx("textarea",{className:"input w-full rounded-lg border-2 border-primary-200 dark:border-primary-700 focus:ring-2 focus:ring-primary-400 focus:border-primary-400 dark:bg-gray-800 dark:text-white transition resize-none min-h-[80px]",value:m,onChange:a=>h(a.target.value),rows:3,placeholder:"¬°Feliz cumplea√±os! Que tengas un d√≠a incre√≠ble.",required:!0}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{type:"button",className:"bg-primary-100 dark:bg-primary-800 text-primary-600 dark:text-primary-300 rounded-full p-2 shadow hover:bg-primary-200 dark:hover:bg-primary-700 transition",onClick:()=>v(a=>!a),"aria-label":"Insertar emoji",children:e.jsx("span",{role:"img","aria-label":"emoji",children:"üòä"})}),e.jsxs("label",{className:"bg-primary-100 dark:bg-primary-800 text-primary-600 dark:text-primary-300 rounded-full p-2 shadow hover:bg-primary-200 dark:hover:bg-primary-700 transition cursor-pointer flex items-center","aria-label":"Adjuntar archivo",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l7.07-7.07a4 4 0 00-5.656-5.657l-7.07 7.07a6 6 0 108.485 8.485l6.364-6.364"})}),e.jsx("input",{type:"file",className:"hidden",onChange:()=>{}})]})]}),_&&e.jsx("div",{className:"absolute right-0 top-14 z-20",children:e.jsx(L,{onSelect:a=>{h(m+a),v(!1)}})})]})]}),e.jsxs("div",{className:"flex gap-4 justify-end mt-6",children:[e.jsx("button",{type:"button",className:"btn btn-ghost px-6 py-2 rounded-full",onClick:c,disabled:y,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary px-6 py-2 rounded-full shadow-lg",disabled:y,children:y?"Creando...":"Crear cumplea√±os"})]})]})};export{$ as C,F as a};
