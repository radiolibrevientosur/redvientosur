import{b as _,r,j as e,s as p,a as o}from"./index-COvD-dsj.js";const O=["General","Arte","Música","Cine","Danza","Literatura"],z=({onSuccess:x})=>{const{user:h}=_(),[d,f]=r.useState(""),[v,j]=r.useState(""),[i,y]=r.useState(""),[D,c]=r.useState(""),[N,P]=r.useState("General"),[a,w]=r.useState(!1),[m,b]=r.useState(0),[C,u]=r.useState(null),[S,l]=r.useState(""),k=async t=>{var I;const s=(I=t.target.files)==null?void 0:I[0];if(l(""),!s)return;u(URL.createObjectURL(s)),b(0);const n=`event-images/${Date.now()}_${s.name}`,E=setInterval(()=>{b(g=>g>=90?(clearInterval(E),g):g+10)},100),{error:L}=await p.storage.from("event-images").upload(n,s,{upsert:!0});if(clearInterval(E),b(100),L){l("Error al subir la imagen. Intenta con otro archivo."),o.error("Error al subir la imagen"),u(null),c("");return}const{data:R}=p.storage.from("event-images").getPublicUrl(n);c(R.publicUrl),o.success("Imagen subida correctamente")},U=async t=>{if(t.preventDefault(),l(""),!h){l("Debes iniciar sesión para publicar un blog"),o.error("Debes iniciar sesión para publicar un blog");return}if(!d.trim()||!i.trim()){l("El título y el contenido son obligatorios"),o.error("El título y el contenido son obligatorios");return}w(!0);try{const s={titulo:d.trim(),contenido:i.trim(),excerpt:v.trim()||i.substring(0,120),imagen_portada:D||null,categoria:N||null,publicado_en:new Date().toISOString(),actualizado_en:new Date().toISOString(),tipo:"blog",autor_id:h.id},{error:n}=await p.from("publicaciones").insert([s]);if(n)throw n;o.success("¡Blog publicado exitosamente!"),f(""),j(""),y(""),c(""),u(null),x&&x()}catch{l("Error al publicar el blog"),o.error("Error al publicar el blog")}finally{w(!1)}};return e.jsxs("form",{onSubmit:U,className:"space-y-4",autoComplete:"off",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Título *"}),e.jsx("input",{type:"text",value:d,onChange:t=>f(t.target.value),className:"input w-full",required:!0,maxLength:80,placeholder:"Título atractivo para tu blog",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Resumen"}),e.jsx("textarea",{value:v,onChange:t=>j(t.target.value),className:"input w-full",rows:2,maxLength:120,placeholder:"Breve resumen (máx. 120 caracteres)",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Contenido *"}),e.jsx("textarea",{value:i,onChange:t=>y(t.target.value),className:"input w-full",rows:8,required:!0,placeholder:"Comparte tu historia, experiencia o reflexión...",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Imagen de portada"}),e.jsx("input",{type:"file",accept:"image/*",onChange:k,disabled:a}),C&&e.jsxs("div",{className:"mt-2 relative rounded-lg overflow-hidden",children:[e.jsx("img",{src:C,alt:"Previsualización",className:"w-full max-h-48 object-cover rounded-lg border"}),m>0&&m<100&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 bg-primary-100",children:e.jsx("div",{className:"h-2 bg-primary-600",style:{width:`${m}%`}})}),e.jsx("button",{type:"button",onClick:()=>{u(null),c("")},className:"absolute top-2 right-2 bg-gray-900/70 text-white p-1 rounded-full",children:"✕"})]}),S&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Categoría"}),e.jsx("select",{value:N,onChange:t=>P(t.target.value),className:"input w-full",disabled:a,children:O.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("button",{type:"submit",disabled:a,className:"btn btn-primary flex items-center","aria-busy":a,children:[a?e.jsx("span",{className:"loader mr-2"}):null,a?"Publicando...":"Publicar blog"]})]})};export{z as C};
