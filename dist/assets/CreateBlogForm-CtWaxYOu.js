import{b as _,r,j as e,s as g,a as i}from"./index-BrRfBUNT.js";const O=["General","Arte","Música","Cine","Danza","Literatura"],z=({onSuccess:p})=>{const{user:x}=_(),[u,h]=r.useState(""),[f,v]=r.useState(""),[o,j]=r.useState(""),[D,n]=r.useState(""),[y,P]=r.useState("General"),[a,N]=r.useState(!1),[d,m]=r.useState(0),[w,c]=r.useState(null),[C,l]=r.useState(""),k=async t=>{var I;const s=(I=t.target.files)==null?void 0:I[0];if(l(""),!s)return;c(URL.createObjectURL(s)),m(0);const S=`event-images/${Date.now()}_${s.name}`,E=setInterval(()=>{m(b=>b>=90?(clearInterval(E),b):b+10)},100),{error:L}=await g.storage.from("event-images").upload(S,s,{upsert:!0});if(clearInterval(E),m(100),L){l("Error al subir la imagen. Intenta con otro archivo."),i.error("Error al subir la imagen"),c(null),n("");return}const{data:R}=g.storage.from("event-images").getPublicUrl(S);n(R.publicUrl),i.success("Imagen subida correctamente")},U=async t=>{if(t.preventDefault(),l(""),!x){l("Debes iniciar sesión para publicar un blog"),i.error("Debes iniciar sesión para publicar un blog");return}if(!u.trim()||!o.trim()){l("El título y el contenido son obligatorios"),i.error("El título y el contenido son obligatorios");return}N(!0);try{const{error:s}=await g.from("publicaciones").insert({autor_id:x.id,titulo:u.trim(),contenido:o.trim(),excerpt:f.trim()||o.substring(0,120),imagen_portada:D,categoria:y,publicado_en:new Date().toISOString(),actualizado_en:new Date().toISOString(),tipo:"blog"});if(s)throw s;i.success("¡Blog publicado exitosamente!"),h(""),v(""),j(""),n(""),c(null),p&&p()}catch{l("Error al publicar el blog"),i.error("Error al publicar el blog")}finally{N(!1)}};return e.jsxs("form",{onSubmit:U,className:"space-y-4",autoComplete:"off",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Título *"}),e.jsx("input",{type:"text",value:u,onChange:t=>h(t.target.value),className:"input w-full",required:!0,maxLength:80,placeholder:"Título atractivo para tu blog",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Resumen"}),e.jsx("textarea",{value:f,onChange:t=>v(t.target.value),className:"input w-full",rows:2,maxLength:120,placeholder:"Breve resumen (máx. 120 caracteres)",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Contenido *"}),e.jsx("textarea",{value:o,onChange:t=>j(t.target.value),className:"input w-full",rows:8,required:!0,placeholder:"Comparte tu historia, experiencia o reflexión...",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Imagen de portada"}),e.jsx("input",{type:"file",accept:"image/*",onChange:k,disabled:a}),w&&e.jsxs("div",{className:"mt-2 relative rounded-lg overflow-hidden",children:[e.jsx("img",{src:w,alt:"Previsualización",className:"w-full max-h-48 object-cover rounded-lg border"}),d>0&&d<100&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 bg-primary-100",children:e.jsx("div",{className:"h-2 bg-primary-600",style:{width:`${d}%`}})}),e.jsx("button",{type:"button",onClick:()=>{c(null),n("")},className:"absolute top-2 right-2 bg-gray-900/70 text-white p-1 rounded-full",children:"✕"})]}),C&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:C})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Categoría"}),e.jsx("select",{value:y,onChange:t=>P(t.target.value),className:"input w-full",disabled:a,children:O.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("button",{type:"submit",disabled:a,className:"btn btn-primary flex items-center","aria-busy":a,children:[a?e.jsx("span",{className:"loader mr-2"}):null,a?"Publicando...":"Publicar blog"]})]})};export{z as C};
