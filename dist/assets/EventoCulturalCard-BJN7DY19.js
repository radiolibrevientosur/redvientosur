import{r as l,b as P,R as A,j as e,a as m,H as D,s as n}from"./index-DZQ_1XEG.js";import{g as F}from"./postStore-WmoqTb66.js";import{M as H}from"./more-horizontal-GKAtJbWV.js";import{e as u}from"./es-B8gmi2Zg.js";import{f as g}from"./format-6SnhDrvL.js";const B=({event:a,onEdit:y,disableCardNavigation:v,onDeleted:f,onShowDetail:j})=>{const[N,o]=l.useState(!1),[k,C]=l.useState([]),[_,M]=l.useState({}),[c,h]=l.useState([]),[b,E]=l.useState(!1),{user:r}=P(),S=r&&a.userId&&r.id===a.userId,p=r?c.includes(r.id):!1;A.useEffect(()=>{const s=async()=>{const{data:i}=await n.from("comentarios_evento").select("*").eq("evento_id",a.id).order("creado_en",{ascending:!0});if(C(i||[]),i&&i.length>0){const d={};await Promise.all(Array.from(new Set(i.map(x=>x.autor_id))).map(async x=>{const w=await F(x);w&&(d[x]=w)})),M(d)}},t=async()=>{const{data:i}=await n.from("reacciones_evento").select("usuario_id").eq("evento_id",a.id);h(i?i.map(d=>d.usuario_id):[])};s(),t()},[a.id]);const q=async()=>{r&&(p?(await n.from("reacciones_evento").delete().eq("evento_id",a.id).eq("usuario_id",r.id),h(c.filter(s=>s!==r.id))):(await n.from("reacciones_evento").insert({evento_id:a.id,usuario_id:r.id}),h([...c,r.id])))},U=async()=>{if(window.confirm("¿Estás seguro de eliminar este evento?"))try{const{error:s}=await n.from("eventos").delete().eq("id",a.id);if(s)throw s;m.success("Evento eliminado exitosamente"),typeof f=="function"&&f()}catch{m.error("Error al eliminar el evento")}},L=()=>{navigator.share?navigator.share({title:a.titulo,text:a.descripcion,url:window.location.origin+"/eventos/"+a.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/eventos/"+a.id),m.success("¡Enlace copiado!"))};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6",children:[e.jsx("div",{className:"relative h-48 w-full",children:e.jsx("img",{src:a.imagen_url||"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80",alt:a.titulo,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.titulo}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:a.descripcion})]}),e.jsxs("div",{className:"flex space-x-2 relative",children:[e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:s=>{s.stopPropagation(),o(t=>!t)},"aria-label":"Abrir menú","data-menu":"evento-menu",children:e.jsx(H,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),N&&e.jsx("div",{className:"absolute right-0 top-10 z-50 bg-white dark:bg-gray-900 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 min-w-[180px] animate-fade-in",children:e.jsxs("ul",{className:"py-2",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{navigator.clipboard.writeText(window.location.origin+"/eventos/"+a.id),o(!1),m.success("¡Enlace copiado!")},children:"Guardar enlace"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:L,children:"Compartir evento"})}),S&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{o(!1),y&&y()},children:"Editar evento"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-800",onClick:async()=>{await U(),o(!1)},children:"Eliminar evento"})})]}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:s=>{s.stopPropagation(),o(!1)},children:"Cancelar"})})]})})]})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx("span",{className:"bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full",children:a.categoria||a.categoria}),e.jsx("span",{className:"mx-2",children:"•"}),typeof j=="function"&&!v?e.jsxs("span",{className:"group hover:underline cursor-pointer text-primary-600 dark:text-primary-400 font-semibold",onClick:s=>{s.stopPropagation(),j()},title:"Ver detalle del evento",children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",g(new Date(a.fecha_inicio),"dd MMM yyyy",{locale:u})]}):e.jsxs("span",{children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",g(new Date(a.fecha_inicio),"dd MMM yyyy",{locale:u})]})]}),e.jsxs("div",{className:"flex items-center space-x-6 mb-4",children:[e.jsxs("button",{onClick:q,className:"flex items-center space-x-1 group",children:[e.jsx(D,{className:`h-5 w-5 ${p?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${p?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:c.length})]}),e.jsxs("button",{onClick:()=>E(!b),className:"flex items-center space-x-1 group",children:[e.jsx("span",{className:"sr-only",children:"Comentarios"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-600",children:"Comentarios"})]})]}),b&&e.jsx("div",{className:"mt-4",children:k.map(s=>{const t=_[s.autor_id];return e.jsxs("div",{className:"flex items-start space-x-3 py-2",children:[e.jsx("img",{src:(t==null?void 0:t.avatar)||"/default-avatar.png",alt:(t==null?void 0:t.displayName)||"Usuario",className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:(t==null?void 0:t.displayName)||"Usuario"}),e.jsx("span",{className:"text-xs text-gray-400",children:g(new Date(s.creado_en),"dd MMM yyyy",{locale:u})})]}),e.jsx("div",{className:"text-gray-700 dark:text-gray-200 text-sm",children:s.contenido})]})]},s.id)})})]})]})};export{B as E};
