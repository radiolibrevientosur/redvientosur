import{r as n,u as I,R as P,j as e,d as x,k as f,p as b,H as R,M as T,s as d}from"./index-BGdIQiaM.js";import{g as S}from"./postStore-CwMn21os.js";import{E as z}from"./ellipsis-B-xpudre.js";import{S as B}from"./send-BLMdmDM8.js";import{e as j}from"./es-CSKTTB5m.js";const Q=({event:s,onEdit:v,disableCardNavigation:q,onDeleted:w})=>{const[D,c]=n.useState(!1),[h,N]=n.useState(""),[m,k]=n.useState([]),[C,_]=n.useState({}),[u,p]=n.useState([]),[g,E]=n.useState(!1),{user:t}=I(),L=t&&s.userId&&t.id===s.userId,y=t?u.includes(t.id):!1;P.useEffect(()=>{const r=async()=>{const{data:i}=await d.from("comentarios_evento").select("*").eq("evento_id",s.id).order("creado_en",{ascending:!0});if(k(i||[]),i&&i.length>0){const l={};await Promise.all(Array.from(new Set(i.map(o=>o.autor_id))).map(async o=>{const M=await S(o);M&&(l[o]=M)})),_(l)}},a=async()=>{const{data:i}=await d.from("reacciones_evento").select("usuario_id").eq("evento_id",s.id);p(i?i.map(l=>l.usuario_id):[])};r(),a()},[s.id]);const $=async()=>{t&&(y?(await d.from("reacciones_evento").delete().eq("evento_id",s.id).eq("usuario_id",t.id),p(u.filter(r=>r!==t.id))):(await d.from("reacciones_evento").insert({evento_id:s.id,usuario_id:t.id}),p([...u,t.id])))},A=async r=>{if(r.preventDefault(),!(!h.trim()||!t))try{const{data:a,error:i}=await d.from("comentarios_evento").insert({evento_id:s.id,autor_id:t.id,contenido:h.trim()}).select().single();if(i)throw i;let l=C[t.id];l||(l=await S(t.id),_(o=>({...o,[t.id]:l}))),k([...m,a]),N("")}catch{x.error("Error al agregar el comentario")}},H=async()=>{if(window.confirm("¿Estás seguro de eliminar este evento?"))try{const{error:r}=await d.from("eventos").delete().eq("id",s.id);if(r)throw r;x.success("Evento eliminado exitosamente"),typeof w=="function"&&w()}catch{x.error("Error al eliminar el evento")}},F=()=>{navigator.share?navigator.share({title:s.titulo,text:s.descripcion,url:window.location.origin+"/eventos/"+s.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/eventos/"+s.id),x.success("¡Enlace copiado!"))};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6",children:[e.jsx("div",{className:"relative h-48 w-full",children:e.jsx("img",{src:s.imagen_url||"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80",alt:s.titulo,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:s.titulo}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:s.descripcion})]}),e.jsxs("div",{className:"flex space-x-2 relative",children:[e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:r=>{r.stopPropagation(),c(a=>!a)},"aria-label":"Abrir menú","data-menu":"evento-menu",children:e.jsx(z,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),D&&e.jsx("div",{className:"absolute right-0 top-10 z-50 bg-white dark:bg-gray-900 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 min-w-[180px] animate-fade-in",children:e.jsxs("ul",{className:"py-2",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{navigator.clipboard.writeText(window.location.origin+"/eventos/"+s.id),c(!1),x.success("¡Enlace copiado!")},children:"Guardar enlace"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:F,children:"Compartir evento"})}),L&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{c(!1),v&&v()},children:"Editar evento"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-800",onClick:async()=>{await H(),c(!1)},children:"Eliminar evento"})})]}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:r=>{r.stopPropagation(),c(!1)},children:"Cancelar"})})]})})]})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx("span",{className:"bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full",children:s.categoria||s.categoria}),e.jsx("span",{className:"mx-2",children:"•"}),q?e.jsxs("span",{children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",f(new Date(s.fecha_inicio),"dd MMM yyyy",{locale:j})]}):e.jsx(b,{to:`/eventos/${s.id}`,className:"group hover:underline",children:e.jsxs("span",{children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",f(new Date(s.fecha_inicio),"dd MMM yyyy",{locale:j})]})})]}),e.jsxs("div",{className:"flex items-center space-x-6 mb-4",children:[e.jsxs("button",{onClick:$,className:"flex items-center space-x-1 group",children:[e.jsx(R,{className:`h-5 w-5 ${y?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${y?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:u.length})]}),e.jsxs("button",{onClick:()=>E(!g),className:"flex items-center space-x-1 group",children:[e.jsx(T,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:m.length})]})]}),(m.length>0||g)&&e.jsxs("div",{className:"mb-4 space-y-3",children:[m.slice(0,g?void 0:2).map(r=>{const a=C[r.autor_id];return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{to:a!=null&&a.username?`/profile/${a.username}`:"#",className:"avatar w-8 h-8 block",children:e.jsx("img",{src:(a==null?void 0:a.avatar)||"/default-avatar.png",alt:(a==null?void 0:a.displayName)||"Usuario",className:"avatar-img"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[e.jsx(b,{to:a!=null&&a.username?`/profile/${a.username}`:"#",className:"font-medium text-sm text-gray-900 dark:text-white hover:underline",children:(a==null?void 0:a.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:r.contenido})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r.creado_en?f(new Date(r.creado_en),"d MMM HH:mm",{locale:j}):""})]})]},r.id)}),m.length>2&&!g&&e.jsx("button",{onClick:()=>E(!0),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:"Ver todos los comentarios"})]}),e.jsx("div",{className:"border-t dark:border-gray-700 pt-4",children:t&&e.jsxs("form",{onSubmit:A,className:"flex gap-2 items-center",children:[e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:t.avatar,alt:t.displayName,className:"avatar-img"})}),e.jsx("input",{type:"text",placeholder:"Escribe un comentario...",value:h,onChange:r=>N(r.target.value),className:"flex-1 px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 text-sm"}),e.jsx("button",{type:"submit",disabled:!h.trim(),className:"p-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:e.jsx(B,{className:"h-5 w-5"})})]})})]})]})};export{Q as E};
