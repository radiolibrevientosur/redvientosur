import{r as n,b as I,R as P,j as e,a as x,i as f,H as R,M as z,s as d}from"./index-COvD-dsj.js";import{g as S}from"./postStore-Dp1p3vYt.js";import{M as T}from"./more-horizontal-VhyU_bLn.js";import{S as B}from"./send-C9DKiU_-.js";import{e as b}from"./es-B8gmi2Zg.js";import{f as j}from"./format-6SnhDrvL.js";const W=({event:r,onEdit:v,disableCardNavigation:q,onDeleted:w})=>{const[D,c]=n.useState(!1),[h,N]=n.useState(""),[m,k]=n.useState([]),[C,_]=n.useState({}),[u,p]=n.useState([]),[g,M]=n.useState(!1),{user:t}=I(),H=t&&r.userId&&t.id===r.userId,y=t?u.includes(t.id):!1;P.useEffect(()=>{const s=async()=>{const{data:i}=await d.from("comentarios_evento").select("*").eq("evento_id",r.id).order("creado_en",{ascending:!0});if(k(i||[]),i&&i.length>0){const o={};await Promise.all(Array.from(new Set(i.map(l=>l.autor_id))).map(async l=>{const E=await S(l);E&&(o[l]=E)})),_(o)}},a=async()=>{const{data:i}=await d.from("reacciones_evento").select("usuario_id").eq("evento_id",r.id);p(i?i.map(o=>o.usuario_id):[])};s(),a()},[r.id]);const L=async()=>{t&&(y?(await d.from("reacciones_evento").delete().eq("evento_id",r.id).eq("usuario_id",t.id),p(u.filter(s=>s!==t.id))):(await d.from("reacciones_evento").insert({evento_id:r.id,usuario_id:t.id}),p([...u,t.id])))},$=async s=>{if(s.preventDefault(),!(!h.trim()||!t))try{const{data:a,error:i}=await d.from("comentarios_evento").insert({evento_id:r.id,autor_id:t.id,contenido:h.trim()}).select().single();if(i)throw i;let o=C[t.id];o||(o=await S(t.id),_(l=>({...l,[t.id]:o}))),k([...m,a]),N("")}catch{x.error("Error al agregar el comentario")}},A=async()=>{if(window.confirm("¿Estás seguro de eliminar este evento?"))try{const{error:s}=await d.from("eventos").delete().eq("id",r.id);if(s)throw s;x.success("Evento eliminado exitosamente"),typeof w=="function"&&w()}catch{x.error("Error al eliminar el evento")}},F=()=>{navigator.share?navigator.share({title:r.titulo,text:r.descripcion,url:window.location.origin+"/eventos/"+r.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/eventos/"+r.id),x.success("¡Enlace copiado!"))};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6",children:[e.jsx("div",{className:"relative h-48 w-full",children:e.jsx("img",{src:r.imagen_url||"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80",alt:r.titulo,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.titulo}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:r.descripcion})]}),e.jsxs("div",{className:"flex space-x-2 relative",children:[e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:s=>{s.stopPropagation(),c(a=>!a)},"aria-label":"Abrir menú","data-menu":"evento-menu",children:e.jsx(T,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),D&&e.jsx("div",{className:"absolute right-0 top-10 z-50 bg-white dark:bg-gray-900 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 min-w-[180px] animate-fade-in",children:e.jsxs("ul",{className:"py-2",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{navigator.clipboard.writeText(window.location.origin+"/eventos/"+r.id),c(!1),x.success("¡Enlace copiado!")},children:"Guardar enlace"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:F,children:"Compartir evento"})}),H&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{c(!1),v&&v()},children:"Editar evento"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-800",onClick:async()=>{await A(),c(!1)},children:"Eliminar evento"})})]}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:s=>{s.stopPropagation(),c(!1)},children:"Cancelar"})})]})})]})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx("span",{className:"bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full",children:r.categoria||r.categoria}),e.jsx("span",{className:"mx-2",children:"•"}),q?e.jsxs("span",{children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",j(new Date(r.fecha_inicio),"dd MMM yyyy",{locale:b})]}):e.jsx(f,{to:`/eventos/${r.id}`,className:"group hover:underline",children:e.jsxs("span",{children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",j(new Date(r.fecha_inicio),"dd MMM yyyy",{locale:b})]})})]}),e.jsxs("div",{className:"flex items-center space-x-6 mb-4",children:[e.jsxs("button",{onClick:L,className:"flex items-center space-x-1 group",children:[e.jsx(R,{className:`h-5 w-5 ${y?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${y?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:u.length})]}),e.jsxs("button",{onClick:()=>M(!g),className:"flex items-center space-x-1 group",children:[e.jsx(z,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:m.length})]})]}),(m.length>0||g)&&e.jsxs("div",{className:"mb-4 space-y-3",children:[m.slice(0,g?void 0:2).map(s=>{const a=C[s.autor_id];return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(f,{to:a!=null&&a.username?`/profile/${a.username}`:"#",className:"avatar w-8 h-8 block",children:e.jsx("img",{src:(a==null?void 0:a.avatar)||"/default-avatar.png",alt:(a==null?void 0:a.displayName)||"Usuario",className:"avatar-img"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[e.jsx(f,{to:a!=null&&a.username?`/profile/${a.username}`:"#",className:"font-medium text-sm text-gray-900 dark:text-white hover:underline",children:(a==null?void 0:a.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.contenido})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.creado_en?j(new Date(s.creado_en),"d MMM HH:mm",{locale:b}):""})]})]},s.id)}),m.length>2&&!g&&e.jsx("button",{onClick:()=>M(!0),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:"Ver todos los comentarios"})]}),e.jsx("div",{className:"border-t dark:border-gray-700 pt-4",children:t&&e.jsxs("form",{onSubmit:$,className:"flex gap-2 items-center",children:[e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:t.avatar,alt:t.displayName,className:"avatar-img"})}),e.jsx("input",{type:"text",placeholder:"Escribe un comentario...",value:h,onChange:s=>N(s.target.value),className:"flex-1 px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 text-sm"}),e.jsx("button",{type:"submit",disabled:!h.trim(),className:"p-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:e.jsx(B,{className:"h-5 w-5"})})]})})]})]})};export{W as E};
