import{r as c,e as I,R as P,j as e,d as g,l as y,q as b,H as R,M as T,s as d}from"./index-CkCNI7dU.js";import{g as S}from"./postStore-f2sBwH6p.js";import{E as V}from"./ellipsis-BNycaEhj.js";import{e as v}from"./es-bYVKIrjc.js";import{S as z}from"./send-DtTyteps.js";const K=({event:r,onEdit:j,disableCardNavigation:A,onDeleted:w})=>{const[q,m]=c.useState(!1),[h,N]=c.useState(""),[x,k]=c.useState([]),[C,_]=c.useState({}),[p,f]=c.useState([]),[l,E]=c.useState(!1),{user:t}=I(),D=t&&r.userId&&t.id===r.userId,u=t?p.includes(t.id):!1;P.useEffect(()=>{const s=async()=>{const{data:i}=await d.from("comentarios_evento").select("*").eq("evento_id",r.id).order("creado_en",{ascending:!0});if(k(i||[]),i&&i.length>0){const o={};await Promise.all(Array.from(new Set(i.map(n=>n.autor_id))).map(async n=>{const M=await S(n);M&&(o[n]=M)})),_(o)}},a=async()=>{const{data:i}=await d.from("reacciones_evento").select("usuario_id").eq("evento_id",r.id);f(i?i.map(o=>o.usuario_id):[])};s(),a()},[r.id]);const $=async()=>{t&&(u?(await d.from("reacciones_evento").delete().eq("evento_id",r.id).eq("usuario_id",t.id),f(p.filter(s=>s!==t.id))):(await d.from("reacciones_evento").insert({evento_id:r.id,usuario_id:t.id}),f([...p,t.id])))},L=async s=>{if(s.preventDefault(),!(!h.trim()||!t))try{const{data:a,error:i}=await d.from("comentarios_evento").insert({evento_id:r.id,autor_id:t.id,contenido:h.trim()}).select().single();if(i)throw i;let o=C[t.id];o||(o=await S(t.id),_(n=>({...n,[t.id]:o}))),k([...x,a]),N("")}catch{g.error("Error al agregar el comentario")}},H=async()=>{if(window.confirm("¿Estás seguro de eliminar este evento?"))try{const{error:s}=await d.from("eventos").delete().eq("id",r.id);if(s)throw s;g.success("Evento eliminado exitosamente"),typeof w=="function"&&w()}catch{g.error("Error al eliminar el evento")}},F=()=>{navigator.share?navigator.share({title:r.titulo,text:r.descripcion,url:window.location.origin+"/eventos/"+r.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/eventos/"+r.id),g.success("¡Enlace copiado!"))};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6",children:[e.jsx("div",{className:"relative h-48 w-full",children:e.jsx("img",{src:r.imagen_url||"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80",alt:r.titulo,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.titulo}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:r.descripcion})]}),e.jsxs("div",{className:"flex space-x-2 relative",children:[e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline focus:ring-2 focus:ring-primary-500",onClick:s=>{s.stopPropagation(),m(a=>!a)},"aria-label":"Abrir menú de opciones del evento","data-menu":"evento-menu",children:e.jsx(V,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),q&&e.jsx("div",{className:"absolute right-0 top-10 z-50 bg-white dark:bg-gray-900 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 min-w-[180px] animate-fade-in",children:e.jsxs("ul",{className:"py-2",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{navigator.clipboard.writeText(window.location.origin+"/eventos/"+r.id),m(!1),g.success("¡Enlace copiado!")},"aria-label":"Copiar enlace del evento",children:"Guardar enlace"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:F,"aria-label":"Compartir evento",children:"Compartir evento"})}),D&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{m(!1),j&&j()},"aria-label":"Editar evento",children:"Editar evento"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-800",onClick:async()=>{await H(),m(!1)},"aria-label":"Eliminar evento",children:"Eliminar evento"})})]}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:s=>{s.stopPropagation(),m(!1)},"aria-label":"Cerrar menú de opciones",children:"Cancelar"})})]})})]})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx("span",{className:"bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full",children:r.categoria||r.categoria}),e.jsx("span",{className:"mx-2",children:"•"}),A?e.jsxs("span",{children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",y(new Date(r.fecha_inicio),"dd MMM yyyy",{locale:v})]}):e.jsx(b,{to:`/eventos/${r.id}`,className:"group hover:underline",children:e.jsxs("span",{children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",y(new Date(r.fecha_inicio),"dd MMM yyyy",{locale:v})]})})]}),e.jsxs("div",{className:"flex items-center space-x-6 mb-4",children:[e.jsxs("button",{onClick:$,className:"flex items-center space-x-1 group focus:outline focus:ring-2 focus:ring-primary-500","aria-pressed":u,"aria-label":u?"Quitar me gusta":"Dar me gusta",type:"button",children:[e.jsx(R,{className:`h-5 w-5 ${u?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${u?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:p.length})]}),e.jsxs("button",{onClick:()=>E(!l),className:"flex items-center space-x-1 group focus:outline focus:ring-2 focus:ring-primary-500","aria-expanded":l,"aria-label":l?"Ocultar comentarios":"Mostrar comentarios",type:"button",children:[e.jsx(T,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:x.length})]})]}),(x.length>0||l)&&e.jsxs("div",{className:"mb-4 space-y-3",children:[x.slice(0,l?void 0:2).map(s=>{const a=C[s.autor_id];return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{to:a!=null&&a.username?`/profile/${a.username}`:"#",className:"avatar w-8 h-8 block",children:e.jsx("img",{src:(a==null?void 0:a.avatar)||"/default-avatar.png",alt:a!=null&&a.displayName?`Avatar de ${a.displayName}`:"Avatar de usuario",className:"avatar-img"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[e.jsx(b,{to:a!=null&&a.username?`/profile/${a.username}`:"#",className:"font-medium text-sm text-gray-900 dark:text-white hover:underline",children:(a==null?void 0:a.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.contenido})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.creado_en?y(new Date(s.creado_en),"d MMM HH:mm",{locale:v}):""})]})]},s.id)}),x.length>2&&!l&&e.jsx("button",{onClick:()=>E(!0),className:"text-sm text-primary-600 dark:text-primary-400 font-medium focus:outline focus:ring-2 focus:ring-primary-500","aria-label":"Ver todos los comentarios",type:"button",children:"Ver todos los comentarios"})]}),e.jsx("div",{className:"border-t dark:border-gray-700 pt-4",children:t&&e.jsxs("form",{onSubmit:L,className:"flex gap-2 items-center",children:[e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:t.avatar,alt:t.displayName?`Avatar de ${t.displayName}`:"Avatar de usuario",className:"avatar-img"})}),e.jsx("input",{type:"text",placeholder:"Escribe un comentario...",value:h,onChange:s=>N(s.target.value),className:"flex-1 px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 text-sm"}),e.jsx("button",{type:"submit",disabled:!h.trim(),className:"p-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 focus:outline focus:ring-2 focus:ring-primary-500","aria-label":"Enviar comentario",children:e.jsx(z,{className:"h-5 w-5"})})]})})]})]})};export{K as E};
