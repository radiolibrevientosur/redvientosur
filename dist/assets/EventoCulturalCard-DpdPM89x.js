import{c as S,r as n,b as $,R as I,j as e,g as y,H as A,o as P,s as l,a as u}from"./index-BrRfBUNT.js";import{g as b}from"./postStore-CI7NDm86.js";import{S as R}from"./share-2-2ppTR6CC.js";import{S as T}from"./send-C65sD64D.js";import{e as _}from"./es-B8gmi2Zg.js";import{f as C}from"./format-6SnhDrvL.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=S("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=S("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),O=({event:t,onEdit:E})=>{const[m,f]=n.useState(""),[c,j]=n.useState([]),[v,N]=n.useState({}),[x,p]=n.useState([]),[h,w]=n.useState(!1),{user:s}=$(),M=s&&t.userId&&s.id===t.userId,g=s?x.includes(s.id):!1;I.useEffect(()=>{const r=async()=>{const{data:i}=await l.from("comentarios_evento").select("*").eq("evento_id",t.id).order("creado_en",{ascending:!0});if(j(i||[]),i&&i.length>0){const o={};await Promise.all(Array.from(new Set(i.map(d=>d.autor_id))).map(async d=>{const k=await b(d);k&&(o[d]=k)})),N(o)}},a=async()=>{const{data:i}=await l.from("reacciones_evento").select("usuario_id").eq("evento_id",t.id);p(i?i.map(o=>o.usuario_id):[])};r(),a()},[t.id]);const q=async()=>{s&&(g?(await l.from("reacciones_evento").delete().eq("evento_id",t.id).eq("usuario_id",s.id),p(x.filter(r=>r!==s.id))):(await l.from("reacciones_evento").insert({evento_id:t.id,usuario_id:s.id}),p([...x,s.id])))},L=async r=>{if(r.preventDefault(),!(!m.trim()||!s))try{const{data:a,error:i}=await l.from("comentarios_evento").insert({evento_id:t.id,autor_id:s.id,contenido:m.trim()}).select().single();if(i)throw i;let o=v[s.id];o||(o=await b(s.id),N(d=>({...d,[s.id]:o}))),j([...c,a]),f("")}catch{u.error("Error al agregar el comentario")}},D=async()=>{if(window.confirm("¿Estás seguro de eliminar este evento?"))try{const{error:r}=await l.from("eventos").delete().eq("id",t.id);if(r)throw r;u.success("Evento eliminado exitosamente")}catch{u.error("Error al eliminar el evento")}},H=()=>{navigator.share?navigator.share({title:t.titulo,text:t.descripcion,url:window.location.origin+"/eventos/"+t.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/eventos/"+t.id),u.success("¡Enlace copiado!"))};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6",children:[e.jsx("div",{className:"relative h-48 w-full",children:e.jsx("img",{src:t.imagen_url||"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80",alt:t.titulo,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.titulo}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:t.descripcion})]}),e.jsxs("div",{className:"flex space-x-2",children:[M&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:E,className:"p-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:e.jsx(V,{className:"h-5 w-5"})}),e.jsx("button",{onClick:D,className:"p-2 text-red-400 hover:text-red-600 dark:text-red-500 dark:hover:text-red-300",title:"Eliminar evento",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsx("button",{onClick:H,className:"p-2 text-gray-400 hover:text-primary-600 dark:hover:text-primary-400",title:"Compartir evento",children:e.jsx(R,{className:"h-5 w-5"})})]})]}),e.jsx("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mb-2",children:e.jsxs(y,{to:`/eventos/${t.id}`,className:"flex items-center group hover:underline",children:[e.jsx("span",{className:"bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full",children:t.categoria||t.categoria}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{children:[e.jsx("span",{className:"sr-only",children:"Fecha:"})," ",C(new Date(t.fecha_inicio),"dd MMM yyyy",{locale:_})]})]})}),e.jsxs("div",{className:"flex items-center space-x-6 mb-4",children:[e.jsxs("button",{onClick:q,className:"flex items-center space-x-1 group",children:[e.jsx(A,{className:`h-5 w-5 ${g?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${g?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:x.length})]}),e.jsxs("button",{onClick:()=>w(!h),className:"flex items-center space-x-1 group",children:[e.jsx(P,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:c.length})]})]}),(c.length>0||h)&&e.jsxs("div",{className:"mb-4 space-y-3",children:[c.slice(0,h?void 0:2).map(r=>{const a=v[r.autor_id];return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(y,{to:a!=null&&a.username?`/profile/${a.username}`:"#",className:"avatar w-8 h-8 block",children:e.jsx("img",{src:(a==null?void 0:a.avatar)||"/default-avatar.png",alt:(a==null?void 0:a.displayName)||"Usuario",className:"avatar-img"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[e.jsx(y,{to:a!=null&&a.username?`/profile/${a.username}`:"#",className:"font-medium text-sm text-gray-900 dark:text-white hover:underline",children:(a==null?void 0:a.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:r.contenido})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r.creado_en?C(new Date(r.creado_en),"d MMM HH:mm",{locale:_}):""})]})]},r.id)}),c.length>2&&!h&&e.jsx("button",{onClick:()=>w(!0),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:"Ver todos los comentarios"})]}),e.jsx("div",{className:"border-t dark:border-gray-700 pt-4",children:s&&e.jsxs("form",{onSubmit:L,className:"flex gap-2 items-center",children:[e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:s.avatar,alt:s.displayName,className:"avatar-img"})}),e.jsx("input",{type:"text",placeholder:"Escribe un comentario...",value:m,onChange:r=>f(r.target.value),className:"flex-1 px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 text-sm"}),e.jsx("button",{type:"submit",disabled:!m.trim(),className:"p-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:e.jsx(T,{className:"h-5 w-5"})})]})})]})]})};export{O as E};
