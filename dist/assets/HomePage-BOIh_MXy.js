import{c as q,r as x,u as F,R as T,j as e,s as v,a as E,L as D}from"./index-C9n17DBE.js";import{C as z}from"./CreatePostForm-INvTxbsi.js";import{T as V,P as A}from"./PostCard-4YDUW6Eo.js";import{g as L,u as X}from"./postStore-DAKw4xRk.js";import{u as H,f as I}from"./eventStore-gD_OLe0p.js";import{H as R}from"./heart-D0MZu-wX.js";import{M as Y}from"./message-circle-B6nwRzj5.js";import{S as O}from"./video-DQbQh26z.js";import{b as W,a as j,c as Q,d as w}from"./en-US-EYaBdrUG.js";import{C as $}from"./CreateEventForm-Dzw4K9gZ.js";import"./share-2-DWrwP33u.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=q("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),Z={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 día",other:"{{count}} días"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 año",other:"alrededor de {{count}} años"},xYears:{one:"1 año",other:"{{count}} años"},overXYears:{one:"más de 1 año",other:"más de {{count}} años"},almostXYears:{one:"casi 1 año",other:"casi {{count}} años"}},G=(a,c,o)=>{let d;const m=Z[a];return typeof m=="string"?d=m:c===1?d=m.one:d=m.other.replace("{{count}}",c.toString()),o!=null&&o.addSuffix?o.comparison&&o.comparison>0?"en "+d:"hace "+d:d},J={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},K={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},U={full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ee={date:W({formats:J,defaultWidth:"full"}),time:W({formats:K,defaultWidth:"full"}),dateTime:W({formats:U,defaultWidth:"full"})},ae={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'mañana a la' p",nextWeek:"eeee 'a la' p",other:"P"},te={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'mañana a las' p",nextWeek:"eeee 'a las' p",other:"P"},re=(a,c,o,d)=>c.getHours()!==1?te[a]:ae[a],se={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","después de cristo"]},ie={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1º trimestre","2º trimestre","3º trimestre","4º trimestre"]},oe={narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},ne={narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","sá"],abbreviated:["dom","lun","mar","mié","jue","vie","sáb"],wide:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"]},de={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"}},me={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},le=(a,c)=>Number(a)+"º",ce={ordinalNumber:le,era:j({values:se,defaultWidth:"wide"}),quarter:j({values:ie,defaultWidth:"wide",argumentCallback:a=>Number(a)-1}),month:j({values:oe,defaultWidth:"wide"}),day:j({values:ne,defaultWidth:"wide"}),dayPeriod:j({values:de,defaultWidth:"wide",formattingValues:me,defaultFormattingWidth:"wide"})},ue=/^(\d+)(º)?/i,he=/\d+/i,ge={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[uú]n|despu[eé]s de cristo|era com[uú]n)/i},xe={any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[uú]n)/i,/^(despu[eé]s de cristo|era com[uú]n)/i]},pe={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},fe={any:[/1/i,/2/i,/3/i,/4/i]},ye={narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},be={narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},ve={narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[áa])/i,abbreviated:/^(dom|lun|mar|mi[ée]|jue|vie|s[áa]b)/i,wide:/^(domingo|lunes|martes|mi[ée]rcoles|jueves|viernes|s[áa]bado)/i},je={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},we={narrow:/^(a|p|mn|md|(de la|a las) (mañana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (mañana|tarde|noche))/i},Ne={any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/mañana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},ke={ordinalNumber:Q({matchPattern:ue,parsePattern:he,valueCallback:function(a){return parseInt(a,10)}}),era:w({matchPatterns:ge,defaultMatchWidth:"wide",parsePatterns:xe,defaultParseWidth:"any"}),quarter:w({matchPatterns:pe,defaultMatchWidth:"wide",parsePatterns:fe,defaultParseWidth:"any",valueCallback:a=>a+1}),month:w({matchPatterns:ye,defaultMatchWidth:"wide",parsePatterns:be,defaultParseWidth:"any"}),day:w({matchPatterns:ve,defaultMatchWidth:"wide",parsePatterns:je,defaultParseWidth:"any"}),dayPeriod:w({matchPatterns:we,defaultMatchWidth:"any",parsePatterns:Ne,defaultParseWidth:"any"})},Pe={code:"es",formatDistance:G,formatLong:ee,formatRelative:re,localize:ce,match:ke,options:{weekStartsOn:1,firstWeekContainsDate:1}},Me=({event:a,onEdit:c})=>{const[o,d]=x.useState(""),[m,p]=x.useState([]),[i,u]=x.useState({}),[h,f]=x.useState([]),[g,b]=x.useState(!1),{user:r}=F(),N=r&&a.userId&&r.id===a.userId,t=r?h.includes(r.id):!1,k=H(s=>s.addComment);T.useEffect(()=>{const s=async()=>{const{data:l}=await v.from("comentarios").select("*").eq("evento_id",a.id).order("creado_en",{ascending:!0});if(p(l||[]),l&&l.length>0){const y={};await Promise.all(Array.from(new Set(l.map(C=>C.autor_id))).map(async C=>{const S=await L(C);S&&(y[C]=S)})),u(y)}},n=async()=>{const{data:l}=await v.from("reacciones_evento").select("usuario_id").eq("evento_id",a.id);f(l?l.map(y=>y.usuario_id):[])};s(),n()},[a.id]);const P=async()=>{r&&(t?(await v.from("reacciones_evento").delete().eq("evento_id",a.id).eq("usuario_id",r.id),f(h.filter(s=>s!==r.id))):(await v.from("reacciones_evento").insert({evento_id:a.id,usuario_id:r.id}),f([...h,r.id])))},M=async s=>{if(s.preventDefault(),!(!o.trim()||!r))try{const n=await k(a.id,r.id,o.trim());if(!n)return;let l=i[r.id];l||(l=await L(r.id),u(y=>({...y,[r.id]:l}))),p([...m,n]),d("")}catch{E.error("Error al agregar el comentario")}},_=async()=>{if(window.confirm("¿Estás seguro de eliminar este evento?"))try{const{error:s}=await v.from("eventos").delete().eq("id",a.id);if(s)throw s;E.success("Evento eliminado exitosamente")}catch{E.error("Error al eliminar el evento")}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6",children:[e.jsx("div",{className:"relative h-48 w-full",children:e.jsx("img",{src:a.imagen_url||"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80",alt:a.titulo,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.titulo}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:a.descripcion})]}),e.jsx("div",{className:"flex space-x-2",children:N&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:e.jsx(B,{className:"h-5 w-5"})}),e.jsx("button",{onClick:_,className:"p-2 text-red-400 hover:text-red-600 dark:text-red-500 dark:hover:text-red-300",title:"Eliminar evento",children:e.jsx(V,{className:"h-5 w-5"})})]})})]}),e.jsxs("div",{className:"flex items-center space-x-6 mb-4",children:[e.jsxs("button",{onClick:P,className:"flex items-center space-x-1 group",children:[e.jsx(R,{className:`h-5 w-5 ${t?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${t?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:h.length})]}),e.jsxs("button",{onClick:()=>b(!g),className:"flex items-center space-x-1 group",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:m.length})]})]}),(m.length>0||g)&&e.jsxs("div",{className:"mb-4 space-y-3",children:[m.slice(0,g?void 0:2).map(s=>{const n=i[s.autor_id];return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:(n==null?void 0:n.avatar)||"/default-avatar.png",alt:(n==null?void 0:n.displayName)||"Usuario",className:"avatar-img"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-white",children:(n==null?void 0:n.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.contenido})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.creado_en?I(new Date(s.creado_en),"d MMM HH:mm",{locale:Pe}):""})]})]},s.id)}),m.length>2&&!g&&e.jsx("button",{onClick:()=>b(!0),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:"Ver todos los comentarios"})]}),e.jsx("div",{className:"border-t dark:border-gray-700 pt-4",children:r&&e.jsxs("form",{onSubmit:M,className:"flex gap-2 items-center",children:[e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:r.avatar,alt:r.displayName,className:"avatar-img"})}),e.jsx("input",{type:"text",placeholder:"Escribe un comentario...",value:o,onChange:s=>d(s.target.value),className:"flex-1 px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 text-sm"}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"p-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:e.jsx(O,{className:"h-5 w-5"})})]})})]})]})},ze=()=>{var h,f,g,b,r,N;const{posts:a,isLoading:c,fetchPosts:o}=X(),{events:d,isLoading:m,fetchEvents:p}=H(),[i,u]=x.useState(null);return x.useEffect(()=>{o(),p()},[o,p]),e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-lg relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",onClick:()=>u(null),children:"✕"}),e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Editar evento"}),e.jsx($,{date:new Date(i.date),onSuccess:()=>{u(null),p()},onCancel:()=>u(null),initialData:{id:i.id,title:i.title,description:i.description,category:((h=i.metadata)==null?void 0:h.category)||"",event_type:i.type,date:i.date.split("T")[0],location:i.location,target_audience:((f=i.metadata)==null?void 0:f.target_audience)||"",cost:{type:"free"},responsible_person:((g=i.metadata)==null?void 0:g.responsible_person)||{name:"",phone:""},technical_requirements:((b=i.metadata)==null?void 0:b.technical_requirements)||[],image_url:i.imagen_url,tags:((r=i.metadata)==null?void 0:r.tags)||[],recurrence:((N=i.metadata)==null?void 0:N.recurrence)||{type:"none"}}})]})}),e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mt-4",children:"Eventos culturales"}),m?e.jsx("div",{className:"py-8 flex justify-center",children:e.jsx(D,{message:"Cargando eventos..."})}):d.length===0?e.jsx("div",{className:"card py-8 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No hay eventos culturales aún"})}):e.jsx("div",{className:"space-y-4",children:d.map(t=>{var k,P,M,_;return e.jsx(Me,{event:{id:t.id,titulo:t.title,descripcion:t.description,fecha_inicio:t.date,ubicacion:t.location||"",imagen_url:t.imagen_url,categoria:"",tipo:t.type,userId:t.userId,metadata:{target_audience:((k=t.metadata)==null?void 0:k.target_audience)||"",responsible_person:((P=t.metadata)==null?void 0:P.responsible_person)||{name:"",phone:""},technical_requirements:((M=t.metadata)==null?void 0:M.technical_requirements)||[],tags:((_=t.metadata)==null?void 0:_.tags)||[]}},onEdit:()=>u(t)},t.id)})}),e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mt-8",children:"Publicaciones"}),c?e.jsx("div",{className:"py-8 flex justify-center",children:e.jsx(D,{message:"Loading posts..."})}):a.length===0?e.jsxs("div",{className:"card py-8 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No posts yet"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Create your first post to get started!"})]}):e.jsx("div",{className:"space-y-4",children:a.map(t=>e.jsx(A,{post:t},t.id))})]})};export{ze as default};
