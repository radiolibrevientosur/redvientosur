import{j as t,r}from"./index-COvD-dsj.js";import{C as A}from"./CreatePostForm-Dlniylqv.js";import{P as M}from"./PostCard-CmRI7BPE.js";import{u as z}from"./postStore-Dp1p3vYt.js";import{u as B}from"./eventStore-NiOIRdO5.js";import{E as H}from"./EventoCulturalCard-Cpvz8UeX.js";import{C as O}from"./CreateEventForm-Ddz9XPjT.js";import R from"./StoriesPage-Clx8HvUf.js";import"./native-uLmOTjr_.js";import"./send-C9DKiU_-.js";import"./more-horizontal-VhyU_bLn.js";import"./share-2-D_DLkkIs.js";import"./endOfMonth-CHJGNAHY.js";import"./en-US-D3c9jfE3.js";import"./format-6SnhDrvL.js";import"./es-B8gmi2Zg.js";import"./chevron-right-B_Zn_Zh5.js";const V=({type:n="post"})=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-4 animate-pulse",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-full"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/4"})]})]}),t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-3"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-3"}),n==="event"&&t.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded mb-3"}),t.jsxs("div",{className:"flex space-x-4 mt-2",children:[t.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"}),t.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),$=[{label:"Para ti",value:"feed"},{label:"Lo último",value:"timeline"}],de=()=>{var x,h,b,f,j,N,k,w,E,_;const{posts:n,isLoading:D,fetchPosts:u}=z(),{events:i,isLoading:T,fetchEvents:d}=B(),[a,o]=r.useState(null),[l,L]=r.useState("feed"),[F,g]=r.useState(n),[q,m]=r.useState(i);r.useEffect(()=>{g(n)},[n]),r.useEffect(()=>{m(i)},[i]),r.useEffect(()=>{u(),d()},[u,d]);const[I]=r.useState([]),y=[...F.map(e=>({type:"post",date:new Date(e.createdAt),post:e})),...q.filter(e=>e.date&&!isNaN(new Date(e.date).getTime())).map(e=>({type:"event",date:new Date(e.date),event:e})),...I.map(e=>({type:"birthday",date:new Date(e.date),birthday:e}))],v=l==="feed"?y.slice().sort((e,s)=>e.type==="post"&&s.type==="post"&&"post"in e&&"post"in s?s.post.likes.length-e.post.likes.length:e.type==="post"?-1:s.type==="post"?1:s.date.getTime()-e.date.getTime()):y.slice().sort((e,s)=>s.date.getTime()-e.date.getTime());return t.jsxs("div",{className:"space-y-4",children:[t.jsx(R,{}),t.jsx(A,{onSuccess:()=>{setTimeout(()=>{const e=document.querySelector(".feed-item");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100)}}),a&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-lg relative",children:[t.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",onClick:()=>o(null),children:"✕"}),t.jsx("h2",{className:"text-lg font-bold mb-4",children:"Editar evento"}),t.jsx(O,{date:new Date(a.date),onSuccess:()=>{o(null),d()},onCancel:()=>o(null),initialData:{id:a.id,title:a.title,description:a.description,event_type:a.type,date:a.date.split("T")[0],location:a.location,target_audience:["Infantil","Adultos","Todo Público"].includes(((x=a.metadata)==null?void 0:x.target_audience)??"")?(h=a.metadata)==null?void 0:h.target_audience:void 0,cost:{type:"free"},responsible_person:((b=a.metadata)==null?void 0:b.responsible_person)||{name:"",phone:""},technical_requirements:((f=a.metadata)==null?void 0:f.technical_requirements)||[],image_url:a.imagen_url,tags:((j=a.metadata)==null?void 0:j.tags)||[],recurrence:(N=a.metadata)!=null&&N.recurrence&&typeof((k=a.metadata)==null?void 0:k.recurrence.type)=="string"&&["custom","none","daily","weekly","monthly"].includes((w=a.metadata)==null?void 0:w.recurrence.type)?{...(E=a.metadata)==null?void 0:E.recurrence,type:(_=a.metadata)==null?void 0:_.recurrence.type}:{type:"none"}}})]})}),t.jsx("div",{className:"flex justify-center gap-4 my-4",children:$.map(e=>t.jsx("button",{className:`px-4 py-2 rounded-full font-semibold transition-colors duration-150 ${l===e.value?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"}`,onClick:()=>L(e.value),"aria-pressed":l===e.value,children:e.label},e.value))}),D||T?t.jsx("div",{children:[...Array(3)].map((e,s)=>t.jsx(V,{type:"post"},s))}):v.length===0?t.jsxs("div",{className:"card py-8 text-center",children:[t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg font-semibold mb-2",children:"No hay novedades aún"}),t.jsx("p",{className:"text-sm text-gray-400",children:"¡Crea tu primera publicación, evento o cumpleaños para comenzar!"})]}):t.jsx("div",{className:"space-y-4",children:v.map(e=>{var s,C,P,S;return e.type==="post"&&"post"in e?t.jsx(M,{post:e.post,onDeleted:()=>g(c=>c.filter(p=>p.id!==e.post.id))},e.post.id):e.type==="event"&&"event"in e?t.jsx(H,{event:{id:e.event.id,titulo:e.event.title,descripcion:e.event.description,fecha_inicio:e.event.date,ubicacion:e.event.location||"",imagen_url:e.event.imagen_url,categoria:"",tipo:e.event.type,userId:e.event.userId,metadata:{target_audience:((s=e.event.metadata)==null?void 0:s.target_audience)||"",responsible_person:((C=e.event.metadata)==null?void 0:C.responsible_person)||{name:"",phone:""},technical_requirements:((P=e.event.metadata)==null?void 0:P.technical_requirements)||[],tags:((S=e.event.metadata)==null?void 0:S.tags)||[]}},onEdit:()=>o(e.event),onDeleted:()=>m(c=>c.filter(p=>p.id!==e.event.id))},e.event.id):e.type==="birthday"&&"birthday"in e?t.jsxs("div",{className:"card",children:["Cumpleaños: ",e.birthday.name]},e.birthday.id):null})})]})};export{de as default};
