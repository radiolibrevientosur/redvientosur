import{j as t,u as M,r,S as D}from"./index-CkCNI7dU.js";import{C as z}from"./CreatePostForm-VrD6TkLP.js";import{P as B}from"./PostCard-C88NOGZL.js";import{u as H}from"./postStore-f2sBwH6p.js";import{E as O}from"./EventoCulturalCard-DDm6Kyta.js";import{C as R}from"./CreateEventForm-CQzINbcw.js";import V from"./StoriesPage-9YqsTCi2.js";import"./AudioRecorder-TSr-0UMB.js";import"./native-DGJ9haqb.js";import"./send-DtTyteps.js";import"./ellipsis-BNycaEhj.js";import"./share-2-D6YOoNpV.js";import"./endOfMonth-CxbF7xh5.js";import"./es-bYVKIrjc.js";import"./chevron-right-BVamHRHT.js";const $=({type:n="post"})=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-4 animate-pulse",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-full"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/4"})]})]}),t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-3"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-3"}),n==="event"&&t.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded mb-3"}),t.jsxs("div",{className:"flex space-x-4 mt-2",children:[t.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"}),t.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),G=[{label:"Para ti",value:"feed"},{label:"Lo último",value:"timeline"}],ie=()=>{var v,h,b,f,j,N,w,k,E,_;const{posts:n,isLoading:T,fetchPosts:p}=H(),{events:i,isLoading:F,fetchEvents:o}=M(),[a,d]=r.useState(null),[l,L]=r.useState("feed"),[q,u]=r.useState(n),[I,g]=r.useState(i);r.useEffect(()=>{u(n)},[n]),r.useEffect(()=>{g(i)},[i]),r.useEffect(()=>{p(),o()},[p,o]);const[A]=r.useState([]),x=[...q.map(e=>({type:"post",date:new Date(e.createdAt),post:e})),...I.filter(e=>e.date&&!isNaN(new Date(e.date).getTime())).map(e=>({type:"event",date:new Date(e.date),event:e})),...A.map(e=>({type:"birthday",date:new Date(e.date),birthday:e}))],y=l==="feed"?x.slice().sort((e,s)=>e.type==="post"&&s.type==="post"&&"post"in e&&"post"in s?s.post.likes.length-e.post.likes.length:e.type==="post"?-1:s.type==="post"?1:s.date.getTime()-e.date.getTime()):x.slice().sort((e,s)=>s.date.getTime()-e.date.getTime());return t.jsxs("div",{className:"space-y-4 max-w-full sm:max-w-2xl mx-auto px-1 sm:px-0 pb-24",children:[t.jsx("div",{className:"mb-2",children:t.jsx(V,{})}),t.jsx("div",{className:"rounded-lg bg-white dark:bg-gray-900 shadow-sm p-2 sm:p-4 mb-2",children:t.jsx(z,{onSuccess:()=>{setTimeout(()=>{const e=document.querySelector(".feed-item");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100)}})}),t.jsx("div",{className:"block sm:hidden mb-2",children:t.jsx(D,{})}),t.jsx("div",{className:"hidden sm:block",children:t.jsx(D,{})}),a&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-4 w-full max-w-lg relative animate-fade-in",children:[t.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",onClick:()=>d(null),children:"✕"}),t.jsx("h2",{className:"text-lg font-bold mb-4",children:"Editar evento"}),t.jsx(R,{date:new Date(a.date),onSuccess:()=>{d(null),o()},onCancel:()=>d(null),initialData:{id:a.id,title:a.title,description:a.description,event_type:a.type,date:a.date.split("T")[0],location:a.location,target_audience:["Infantil","Adultos","Todo Público"].includes(((v=a.metadata)==null?void 0:v.target_audience)??"")?(h=a.metadata)==null?void 0:h.target_audience:void 0,cost:{type:"free"},responsible_person:((b=a.metadata)==null?void 0:b.responsible_person)||{name:"",phone:""},technical_requirements:((f=a.metadata)==null?void 0:f.technical_requirements)||[],image_url:a.imagen_url,tags:((j=a.metadata)==null?void 0:j.tags)||[],recurrence:(N=a.metadata)!=null&&N.recurrence&&typeof((w=a.metadata)==null?void 0:w.recurrence.type)=="string"&&["custom","none","daily","weekly","monthly"].includes((k=a.metadata)==null?void 0:k.recurrence.type)?{...(E=a.metadata)==null?void 0:E.recurrence,type:(_=a.metadata)==null?void 0:_.recurrence.type}:{type:"none"}}})]})}),t.jsx("div",{className:"flex justify-center gap-2 my-2 sm:my-4",children:G.map(e=>t.jsx("button",{className:`px-3 py-1 sm:px-4 sm:py-2 rounded-full font-semibold transition-colors duration-150 text-xs sm:text-base ${l===e.value?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"}`,onClick:()=>L(e.value),"aria-pressed":l===e.value,children:e.label},e.value))}),T||F?t.jsx("div",{children:[...Array(3)].map((e,s)=>t.jsx($,{type:"post"},s))}):y.length===0?t.jsxs("div",{className:"card py-8 text-center",children:[t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg font-semibold mb-2",children:"No hay novedades aún"}),t.jsx("p",{className:"text-sm text-gray-400",children:"¡Crea tu primera publicación, evento o cumpleaños para comenzar!"})]}):t.jsx("div",{className:"space-y-2 sm:space-y-4",children:y.map(e=>{var s,S,C,P;return e.type==="post"&&"post"in e?t.jsx("div",{className:"feed-item",children:t.jsx(B,{post:e.post,onDeleted:()=>u(c=>c.filter(m=>m.id!==e.post.id))},e.post.id)}):e.type==="event"&&"event"in e?t.jsx("div",{className:"feed-item",children:t.jsx(O,{event:{id:e.event.id,titulo:e.event.title,descripcion:e.event.description,fecha_inicio:e.event.date,ubicacion:e.event.location||"",imagen_url:e.event.imagen_url,categoria:"",tipo:e.event.type,userId:e.event.userId,metadata:{target_audience:((s=e.event.metadata)==null?void 0:s.target_audience)||"",responsible_person:((S=e.event.metadata)==null?void 0:S.responsible_person)||{name:"",phone:""},technical_requirements:((C=e.event.metadata)==null?void 0:C.technical_requirements)||[],tags:((P=e.event.metadata)==null?void 0:P.tags)||[]}},onEdit:()=>d(e.event),onDeleted:()=>g(c=>c.filter(m=>m.id!==e.event.id))},e.event.id)}):e.type==="birthday"&&"birthday"in e?t.jsxs("div",{className:"card feed-item",children:["Cumpleaños: ",e.birthday.name]},e.birthday.id):null})})]})};export{ie as default};
