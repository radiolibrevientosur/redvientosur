import{j as t,G as I,u as A,r as o,s as M,a as B}from"./index-BGdIQiaM.js";import{C as G}from"./CreatePostForm-Dhgbh7Y-.js";import{P as V}from"./PostCard-QWzklQwN.js";import{u as H}from"./postStore-CwMn21os.js";import{E as O}from"./EventoCulturalCard-CLC3IEOR.js";import{C as R}from"./CreateEventForm-DBBxU2Rv.js";import U from"./StoriesPage--bxSA52O.js";import"./AudioRecorder-DfWx_NTv.js";import"./native-Cp8PlxG7.js";import"./send-BLMdmDM8.js";import"./ellipsis-B-xpudre.js";import"./share-2-D9WDayZo.js";import"./endOfMonth-Dpn14GlW.js";import"./es-CSKTTB5m.js";import"./chevron-right-Dpb_Fcqd.js";const $=({type:r="post"})=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-4 animate-pulse",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-full"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/4"})]})]}),t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-3"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-3"}),r==="event"&&t.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded mb-3"}),t.jsxs("div",{className:"flex space-x-4 mt-2",children:[t.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"}),t.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"})]})]});function J(r){return I({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(r)}const K=()=>{const{user:r}=A(),[u,g]=o.useState([]),[c,m]=o.useState(!1),[i,a]=o.useState([]);o.useEffect(()=>{async function s(){m(!0);const{data:l,error:p}=await M.from("usuarios").select("id, nombre_usuario, nombre_completo, avatar_url").neq("id",r==null?void 0:r.id).limit(5);!p&&l&&g(l),m(!1)}r!=null&&r.id&&s()},[r]);const d=async s=>{a(l=>[...l,s])};return c?t.jsx("div",{className:"p-4",children:"Cargando sugerencias..."}):u.length?t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow border border-gray-200 dark:border-gray-800 p-4 mb-6",children:[t.jsx("h2",{className:"font-bold text-base mb-3 text-gray-700 dark:text-gray-200",children:"Sugerencias para ti"}),t.jsx("div",{className:"flex gap-4 overflow-x-auto hide-scrollbar py-1",children:u.map(s=>t.jsxs("div",{className:"flex flex-col items-center w-32 min-w-[7rem] bg-gray-50 dark:bg-gray-800 rounded-lg p-3 shadow-sm border border-gray-100 dark:border-gray-800 mx-1",children:[t.jsx("img",{src:s.avatar_url||"/default-avatar.png",alt:s.nombre_completo||s.nombre_usuario,className:"w-14 h-14 rounded-full object-cover border-2 border-primary-400 mb-2"}),t.jsx("div",{className:"font-medium text-xs truncate text-center text-gray-800 dark:text-gray-100",children:s.nombre_completo||s.nombre_usuario}),t.jsxs("div",{className:"text-[11px] text-gray-500 truncate mb-2",children:["@",s.nombre_usuario]}),t.jsxs("button",{className:"flex items-center gap-1 px-3 py-1 rounded-full bg-primary-600 text-white hover:bg-primary-700 transition text-xs font-semibold disabled:opacity-60",onClick:()=>d(s.id),disabled:i.includes(s.id),children:[t.jsx(J,{className:"w-3 h-3"})," ",i.includes(s.id)?"Siguiendo":"Seguir"]})]},s.id))})]}):null},Q=[{label:"Para ti",value:"feed"},{label:"Lo último",value:"timeline"}],ue=()=>{var j,N,w,_,k,S,E,C,P,D;const{posts:r,isLoading:u,fetchPosts:g}=H(),{events:c,isLoading:m,fetchEvents:i}=B(),[a,d]=o.useState(null),[s,l]=o.useState("feed"),[p,h]=o.useState(r),[q,b]=o.useState(c);o.useEffect(()=>{h(r)},[r]),o.useEffect(()=>{b(c)},[c]),o.useEffect(()=>{g(),i()},[g,i]);const[z]=o.useState([]),v=[...p.map(e=>({type:"post",date:new Date(e.createdAt),post:e})),...q.filter(e=>e.date&&!isNaN(new Date(e.date).getTime())).map(e=>({type:"event",date:new Date(e.date),event:e})),...z.map(e=>({type:"birthday",date:new Date(e.date),birthday:e}))],f=s==="feed"?v.slice().sort((e,n)=>e.type==="post"&&n.type==="post"&&"post"in e&&"post"in n?n.post.likes.length-e.post.likes.length:e.type==="post"?-1:n.type==="post"?1:n.date.getTime()-e.date.getTime()):v.slice().sort((e,n)=>n.date.getTime()-e.date.getTime());return t.jsxs("div",{className:"space-y-4",children:[t.jsx(U,{}),t.jsx(G,{onSuccess:()=>{setTimeout(()=>{const e=document.querySelector(".feed-item");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100)}}),t.jsx(K,{}),a&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-lg relative",children:[t.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",onClick:()=>d(null),children:"✕"}),t.jsx("h2",{className:"text-lg font-bold mb-4",children:"Editar evento"}),t.jsx(R,{date:new Date(a.date),onSuccess:()=>{d(null),i()},onCancel:()=>d(null),initialData:{id:a.id,title:a.title,description:a.description,event_type:a.type,date:a.date.split("T")[0],location:a.location,target_audience:["Infantil","Adultos","Todo Público"].includes(((j=a.metadata)==null?void 0:j.target_audience)??"")?(N=a.metadata)==null?void 0:N.target_audience:void 0,cost:{type:"free"},responsible_person:((w=a.metadata)==null?void 0:w.responsible_person)||{name:"",phone:""},technical_requirements:((_=a.metadata)==null?void 0:_.technical_requirements)||[],image_url:a.imagen_url,tags:((k=a.metadata)==null?void 0:k.tags)||[],recurrence:(S=a.metadata)!=null&&S.recurrence&&typeof((E=a.metadata)==null?void 0:E.recurrence.type)=="string"&&["custom","none","daily","weekly","monthly"].includes((C=a.metadata)==null?void 0:C.recurrence.type)?{...(P=a.metadata)==null?void 0:P.recurrence,type:(D=a.metadata)==null?void 0:D.recurrence.type}:{type:"none"}}})]})}),t.jsx("div",{className:"flex justify-center gap-4 my-4",children:Q.map(e=>t.jsx("button",{className:`px-4 py-2 rounded-full font-semibold transition-colors duration-150 ${s===e.value?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"}`,onClick:()=>l(e.value),"aria-pressed":s===e.value,children:e.label},e.value))}),u||m?t.jsx("div",{children:[...Array(3)].map((e,n)=>t.jsx($,{type:"post"},n))}):f.length===0?t.jsxs("div",{className:"card py-8 text-center",children:[t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg font-semibold mb-2",children:"No hay novedades aún"}),t.jsx("p",{className:"text-sm text-gray-400",children:"¡Crea tu primera publicación, evento o cumpleaños para comenzar!"})]}):t.jsx("div",{className:"space-y-4",children:f.map(e=>{var n,F,T,L;return e.type==="post"&&"post"in e?t.jsx(V,{post:e.post,onDeleted:()=>h(x=>x.filter(y=>y.id!==e.post.id))},e.post.id):e.type==="event"&&"event"in e?t.jsx(O,{event:{id:e.event.id,titulo:e.event.title,descripcion:e.event.description,fecha_inicio:e.event.date,ubicacion:e.event.location||"",imagen_url:e.event.imagen_url,categoria:"",tipo:e.event.type,userId:e.event.userId,metadata:{target_audience:((n=e.event.metadata)==null?void 0:n.target_audience)||"",responsible_person:((F=e.event.metadata)==null?void 0:F.responsible_person)||{name:"",phone:""},technical_requirements:((T=e.event.metadata)==null?void 0:T.technical_requirements)||[],tags:((L=e.event.metadata)==null?void 0:L.tags)||[]}},onEdit:()=>d(e.event),onDeleted:()=>b(x=>x.filter(y=>y.id!==e.event.id))},e.event.id):e.type==="birthday"&&"birthday"in e?t.jsxs("div",{className:"card",children:["Cumpleaños: ",e.birthday.name]},e.birthday.id):null})})]})};export{ue as default};
