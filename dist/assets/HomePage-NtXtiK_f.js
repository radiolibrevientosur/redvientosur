import{j as t,r as n,s as v}from"./index-DZQ_1XEG.js";import{C as G}from"./CreatePostForm-1m3luYl0.js";import{P as M}from"./PostCard-CZCjaT-l.js";import{u as J}from"./postStore-WmoqTb66.js";import{u as K}from"./eventStore-Y1xPv6WW.js";import{E as I}from"./EventoCulturalCard-BJN7DY19.js";import{C as Q}from"./CreateEventForm-DzI1LCSO.js";import{C as z}from"./CumpleañosCard-q3lEWmhy.js";import"./native-BZDlRLbF.js";import"./more-horizontal-GKAtJbWV.js";import"./share-2-DXdZN_52.js";import"./endOfMonth-CHJGNAHY.js";import"./en-US-D3c9jfE3.js";import"./format-6SnhDrvL.js";import"./es-B8gmi2Zg.js";import"./CreateBirthdayForm-Cct7BZwD.js";const W=({type:d="post"})=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-4 animate-pulse",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-full"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/4"})]})]}),t.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-3"}),t.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-3"}),d==="event"&&t.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded mb-3"}),t.jsxs("div",{className:"flex space-x-4 mt-2",children:[t.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"}),t.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),X=[{label:"Para ti",value:"feed"},{label:"Lo último",value:"timeline"}],ge=()=>{var w,k,_,E,C,D,S,P,A,L;const{posts:d,isLoading:B,fetchPosts:h}=J(),{events:p,isLoading:H,fetchEvents:m}=K(),[a,c]=n.useState(null),[g,O]=n.useState("feed"),[R,f]=n.useState(d),[U,b]=n.useState(p),[s,l]=n.useState(null),[o,i]=n.useState(null),[V,u]=n.useState(!1);n.useEffect(()=>{f(d)},[d]),n.useEffect(()=>{b(p)},[p]),n.useEffect(()=>{h(),m()},[h,m]),n.useEffect(()=>{s&&(u(!0),s.type==="post"?v.from("posts").select("*").eq("id",s.id).single().then(({data:e})=>{i(e?{id:e.id,userId:e.autor_id,type:e.tipo,content:e.contenido,mediaUrl:Array.isArray(e.multimedia_url)?e.multimedia_url[0]:void 0,createdAt:e.creado_en,likes:Array.isArray(e.likes)?e.likes:[],comments:Array.isArray(e.comments)?e.comments:[],isFavorite:!!e.isFavorite}:null),u(!1)}):s.type==="event"?v.from("eventos").select("*").eq("id",s.id).single().then(({data:e})=>{i(e),u(!1)}):s.type==="birthday"&&v.from("cumpleanos").select("*").eq("id",s.id).single().then(({data:e})=>{i(e),u(!1)}))},[s]);const[$]=n.useState([]),j=[...R.map(e=>({type:"post",date:new Date(e.createdAt),post:e})),...U.filter(e=>e.date&&!isNaN(new Date(e.date).getTime())).map(e=>({type:"event",date:new Date(e.date),event:e})),...$.map(e=>({type:"birthday",date:new Date(e.date),birthday:e}))],N=g==="feed"?j.slice().sort((e,r)=>e.type==="post"&&r.type==="post"&&"post"in e&&"post"in r?r.post.likes.length-e.post.likes.length:e.type==="post"?-1:r.type==="post"?1:r.date.getTime()-e.date.getTime()):j.slice().sort((e,r)=>r.date.getTime()-e.date.getTime());return t.jsxs("div",{className:"space-y-4",children:[s&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl p-4 w-full max-w-2xl relative overflow-y-auto max-h-[90vh]",children:[t.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 text-2xl",onClick:()=>{l(null),i(null)},"aria-label":"Cerrar detalle",children:"✕"}),V?t.jsx("div",{className:"p-8 text-center",children:"Cargando..."}):s.type==="post"&&o?t.jsx("div",{className:"max-w-xl mx-auto p-4",children:t.jsx(M,{post:o,disableCardNavigation:!0,onDeleted:()=>{l(null),i(null)}})}):s.type==="event"&&o?t.jsx("div",{className:"max-w-xl mx-auto p-4",children:t.jsx(I,{event:o,disableCardNavigation:!0,onDeleted:()=>{l(null),i(null)}})}):s.type==="birthday"&&o?t.jsx("div",{className:"max-w-xl mx-auto p-4",children:t.jsx(z,{birthday:o,onDeleted:()=>{l(null),i(null)}})}):null]})}),t.jsx(G,{onSuccess:()=>{setTimeout(()=>{const e=document.querySelector(".feed-item");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100)}}),a&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-lg relative",children:[t.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",onClick:()=>c(null),children:"✕"}),t.jsx("h2",{className:"text-lg font-bold mb-4",children:"Editar evento"}),t.jsx(Q,{date:new Date(a.date),onSuccess:()=>{c(null),m()},onCancel:()=>c(null),initialData:{id:a.id,title:a.title,description:a.description,event_type:a.type,date:a.date.split("T")[0],location:a.location,target_audience:["Infantil","Adultos","Todo Público"].includes(((w=a.metadata)==null?void 0:w.target_audience)??"")?(k=a.metadata)==null?void 0:k.target_audience:void 0,cost:{type:"free"},responsible_person:((_=a.metadata)==null?void 0:_.responsible_person)||{name:"",phone:""},technical_requirements:((E=a.metadata)==null?void 0:E.technical_requirements)||[],image_url:a.imagen_url,tags:((C=a.metadata)==null?void 0:C.tags)||[],recurrence:(D=a.metadata)!=null&&D.recurrence&&typeof((S=a.metadata)==null?void 0:S.recurrence.type)=="string"&&["custom","none","daily","weekly","monthly"].includes((P=a.metadata)==null?void 0:P.recurrence.type)?{...(A=a.metadata)==null?void 0:A.recurrence,type:(L=a.metadata)==null?void 0:L.recurrence.type}:{type:"none"}}})]})}),t.jsx("div",{className:"flex justify-center gap-4 my-4",children:X.map(e=>t.jsx("button",{className:`px-4 py-2 rounded-full font-semibold transition-colors duration-150 ${g===e.value?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"}`,onClick:()=>O(e.value),"aria-pressed":g===e.value,children:e.label},e.value))}),B||H?t.jsx("div",{children:[...Array(3)].map((e,r)=>t.jsx(W,{type:"post"},r))}):N.length===0?t.jsxs("div",{className:"card py-8 text-center",children:[t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg font-semibold mb-2",children:"No hay novedades aún"}),t.jsx("p",{className:"text-sm text-gray-400",children:"¡Crea tu primera publicación, evento o cumpleaños para comenzar!"})]}):t.jsx("div",{className:"space-y-4",children:N.map(e=>{var r,q,F,T;return e.type==="post"&&"post"in e?t.jsx(M,{post:e.post,onDeleted:()=>f(y=>y.filter(x=>x.id!==e.post.id)),onShowDetail:()=>l({type:"post",id:e.post.id})},e.post.id):e.type==="event"&&"event"in e?t.jsx(I,{event:{id:e.event.id,titulo:e.event.title,descripcion:e.event.description,fecha_inicio:e.event.date,ubicacion:e.event.location||"",imagen_url:e.event.imagen_url,categoria:"",tipo:e.event.type,userId:e.event.userId,metadata:{target_audience:((r=e.event.metadata)==null?void 0:r.target_audience)||"",responsible_person:((q=e.event.metadata)==null?void 0:q.responsible_person)||{name:"",phone:""},technical_requirements:((F=e.event.metadata)==null?void 0:F.technical_requirements)||[],tags:((T=e.event.metadata)==null?void 0:T.tags)||[]}},onEdit:()=>c(e.event),onDeleted:()=>b(y=>y.filter(x=>x.id!==e.event.id)),onShowDetail:()=>l({type:"event",id:e.event.id})},e.event.id):e.type==="birthday"&&"birthday"in e?t.jsx(z,{birthday:e.birthday,onShowDetail:()=>l({type:"birthday",id:e.birthday.id})},e.birthday.id):null})})]})};export{ge as default};
