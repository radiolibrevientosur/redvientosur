import{c as H,j as e,r as h,u as q,R as F,H as z,M as A,s as b,a as E}from"./index-CbDr9Sw3.js";import{S as V,C as I}from"./CreatePostForm-BlNDnVmw.js";import{P as X}from"./PostCard-D254WWwH.js";import{g as W,u as R}from"./native-BdzBTjqu.js";import{u as L,f as $}from"./eventStore-D4hTLzv-.js";import{S as O}from"./share-2-CVriX9b-.js";import{b as D,a as w,c as N,d as Y}from"./en-US-C-COG8Us.js";import{C as Q}from"./CreateEventForm-CxCsxgIB.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=H("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=H("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),T=({type:t="post"})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-4 animate-pulse",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/4"})]})]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-3"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-3"}),t==="event"&&e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded mb-3"}),e.jsxs("div",{className:"flex space-x-4 mt-2",children:[e.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-5 w-12 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),G={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 día",other:"{{count}} días"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 año",other:"alrededor de {{count}} años"},xYears:{one:"1 año",other:"{{count}} años"},overXYears:{one:"más de 1 año",other:"más de {{count}} años"},almostXYears:{one:"casi 1 año",other:"casi {{count}} años"}},J=(t,m,n)=>{let d;const l=G[t];return typeof l=="string"?d=l:m===1?d=l.one:d=l.other.replace("{{count}}",m.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"en "+d:"hace "+d:d},K={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},U={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},ee={full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ae={date:D({formats:K,defaultWidth:"full"}),time:D({formats:U,defaultWidth:"full"}),dateTime:D({formats:ee,defaultWidth:"full"})},te={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'mañana a la' p",nextWeek:"eeee 'a la' p",other:"P"},re={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'mañana a las' p",nextWeek:"eeee 'a las' p",other:"P"},se=(t,m,n,d)=>m.getHours()!==1?re[t]:te[t],ie={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","después de cristo"]},oe={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1º trimestre","2º trimestre","3º trimestre","4º trimestre"]},ne={narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},de={narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","sá"],abbreviated:["dom","lun","mar","mié","jue","vie","sáb"],wide:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"]},le={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"}},ce={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},me=(t,m)=>Number(t)+"º",ue={ordinalNumber:me,era:w({values:ie,defaultWidth:"wide"}),quarter:w({values:oe,defaultWidth:"wide",argumentCallback:t=>Number(t)-1}),month:w({values:ne,defaultWidth:"wide"}),day:w({values:de,defaultWidth:"wide"}),dayPeriod:w({values:le,defaultWidth:"wide",formattingValues:ce,defaultFormattingWidth:"wide"})},he=/^(\d+)(º)?/i,ge=/\d+/i,xe={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[uú]n|despu[eé]s de cristo|era com[uú]n)/i},pe={any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[uú]n)/i,/^(despu[eé]s de cristo|era com[uú]n)/i]},fe={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},ye={any:[/1/i,/2/i,/3/i,/4/i]},be={narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},ve={narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},je={narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[áa])/i,abbreviated:/^(dom|lun|mar|mi[ée]|jue|vie|s[áa]b)/i,wide:/^(domingo|lunes|martes|mi[ée]rcoles|jueves|viernes|s[áa]bado)/i},we={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},Ne={narrow:/^(a|p|mn|md|(de la|a las) (mañana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (mañana|tarde|noche))/i},ke={any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/mañana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},Pe={ordinalNumber:Y({matchPattern:he,parsePattern:ge,valueCallback:function(t){return parseInt(t,10)}}),era:N({matchPatterns:xe,defaultMatchWidth:"wide",parsePatterns:pe,defaultParseWidth:"any"}),quarter:N({matchPatterns:fe,defaultMatchWidth:"wide",parsePatterns:ye,defaultParseWidth:"any",valueCallback:t=>t+1}),month:N({matchPatterns:be,defaultMatchWidth:"wide",parsePatterns:ve,defaultParseWidth:"any"}),day:N({matchPatterns:je,defaultMatchWidth:"wide",parsePatterns:we,defaultParseWidth:"any"}),dayPeriod:N({matchPatterns:Ne,defaultMatchWidth:"any",parsePatterns:ke,defaultParseWidth:"any"})},Me={code:"es",formatDistance:J,formatLong:ae,formatRelative:se,localize:ue,match:Pe,options:{weekStartsOn:1,firstWeekContainsDate:1}},_e=({event:t,onEdit:m})=>{const[n,d]=h.useState(""),[l,p]=h.useState([]),[o,x]=h.useState({}),[g,v]=h.useState([]),[f,S]=h.useState(!1),{user:i}=q(),k=i&&t.userId&&i.id===t.userId,y=i?g.includes(i.id):!1;L(s=>s.addComment),F.useEffect(()=>{const s=async()=>{const{data:r}=await b.from("comentarios_evento").select("*").eq("evento_id",t.id).order("creado_en",{ascending:!0});if(p(r||[]),r&&r.length>0){const c={};await Promise.all(Array.from(new Set(r.map(u=>u.autor_id))).map(async u=>{const j=await W(u);j&&(c[u]=j)})),x(c)}},a=async()=>{const{data:r}=await b.from("reacciones_evento").select("usuario_id").eq("evento_id",t.id);v(r?r.map(c=>c.usuario_id):[])};s(),a()},[t.id]);const P=async()=>{i&&(y?(await b.from("reacciones_evento").delete().eq("evento_id",t.id).eq("usuario_id",i.id),v(g.filter(s=>s!==i.id))):(await b.from("reacciones_evento").insert({evento_id:t.id,usuario_id:i.id}),v([...g,i.id])))},M=async s=>{if(s.preventDefault(),!(!n.trim()||!i))try{const{data:a,error:r}=await b.from("comentarios_evento").insert({evento_id:t.id,autor_id:i.id,contenido:n.trim()}).select().single();if(r)throw r;let c=o[i.id];c||(c=await W(i.id),x(u=>({...u,[i.id]:c}))),p([...l,a]),d("")}catch{E.error("Error al agregar el comentario")}},_=async()=>{if(window.confirm("¿Estás seguro de eliminar este evento?"))try{const{error:s}=await b.from("eventos").delete().eq("id",t.id);if(s)throw s;E.success("Evento eliminado exitosamente")}catch{E.error("Error al eliminar el evento")}},C=()=>{navigator.share?navigator.share({title:t.titulo,text:t.descripcion,url:window.location.origin+"/eventos/"+t.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/eventos/"+t.id),E.success("¡Enlace copiado!"))};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6",children:[e.jsx("div",{className:"relative h-48 w-full",children:e.jsx("img",{src:t.imagen_url||"https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80",alt:t.titulo,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.titulo}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:t.descripcion})]}),e.jsxs("div",{className:"flex space-x-2",children:[k&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:m,className:"p-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",children:e.jsx(B,{className:"h-5 w-5"})}),e.jsx("button",{onClick:_,className:"p-2 text-red-400 hover:text-red-600 dark:text-red-500 dark:hover:text-red-300",title:"Eliminar evento",children:e.jsx(Z,{className:"h-5 w-5"})})]}),e.jsx("button",{onClick:C,className:"p-2 text-gray-400 hover:text-primary-600 dark:hover:text-primary-400",title:"Compartir evento",children:e.jsx(O,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex items-center space-x-6 mb-4",children:[e.jsxs("button",{onClick:P,className:"flex items-center space-x-1 group",children:[e.jsx(z,{className:`h-5 w-5 ${y?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${y?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:g.length})]}),e.jsxs("button",{onClick:()=>S(!f),className:"flex items-center space-x-1 group",children:[e.jsx(A,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:l.length})]})]}),(l.length>0||f)&&e.jsxs("div",{className:"mb-4 space-y-3",children:[l.slice(0,f?void 0:2).map(s=>{const a=o[s.autor_id];return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:(a==null?void 0:a.avatar)||"/default-avatar.png",alt:(a==null?void 0:a.displayName)||"Usuario",className:"avatar-img"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-white",children:(a==null?void 0:a.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.contenido})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.creado_en?$(new Date(s.creado_en),"d MMM HH:mm",{locale:Me}):""})]})]},s.id)}),l.length>2&&!f&&e.jsx("button",{onClick:()=>S(!0),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:"Ver todos los comentarios"})]}),e.jsx("div",{className:"border-t dark:border-gray-700 pt-4",children:i&&e.jsxs("form",{onSubmit:M,className:"flex gap-2 items-center",children:[e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:i.avatar,alt:i.displayName,className:"avatar-img"})}),e.jsx("input",{type:"text",placeholder:"Escribe un comentario...",value:n,onChange:s=>d(s.target.value),className:"flex-1 px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 text-sm"}),e.jsx("button",{type:"submit",disabled:!n.trim(),className:"p-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:e.jsx(V,{className:"h-5 w-5"})})]})})]})]})},Ce=[{label:"Para ti",value:"feed"},{label:"Lo último",value:"timeline"}],Fe=()=>{var k,y,P,M,_,C,s;const{posts:t,isLoading:m,fetchPosts:n}=R(),{events:d,isLoading:l,fetchEvents:p}=L(),[o,x]=h.useState(null),[g,v]=h.useState("feed"),[f,S]=h.useState("feed");h.useEffect(()=>{n(),p()},[n,p]);const i=(a,r)=>{a==="post"?window.location.href=`/posts/${r}`:a==="event"&&(window.location.href=`/eventos/${r}`)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{onSuccess:()=>{setTimeout(()=>{const a=document.querySelector(".feed-item");a&&a.scrollIntoView({behavior:"smooth",block:"center"})},100)}}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-lg p-6 w-full max-w-lg relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",onClick:()=>x(null),children:"✕"}),e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Editar evento"}),e.jsx(Q,{date:new Date(o.date),onSuccess:()=>{x(null),p()},onCancel:()=>x(null),initialData:{id:o.id,title:o.title,description:o.description,event_type:o.type,date:o.date.split("T")[0],location:o.location,target_audience:((k=o.metadata)==null?void 0:k.target_audience)||void 0,cost:{type:"free"},responsible_person:((y=o.metadata)==null?void 0:y.responsible_person)||{name:"",phone:""},technical_requirements:((P=o.metadata)==null?void 0:P.technical_requirements)||[],image_url:o.imagen_url,tags:((M=o.metadata)==null?void 0:M.tags)||[],recurrence:(_=o.metadata)!=null&&_.recurrence&&typeof((C=o.metadata)==null?void 0:C.recurrence.type)=="string"?(s=o.metadata)==null?void 0:s.recurrence:{type:"none"}}})]})}),e.jsx("div",{className:"flex justify-center gap-4 my-4",children:Ce.map(a=>e.jsx("button",{className:`px-4 py-2 rounded-full font-semibold transition-colors duration-150 ${g===a.value?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"}`,onClick:()=>v(a.value),"aria-pressed":g===a.value,children:a.label},a.value))}),e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mt-4",children:"Eventos culturales"}),l?e.jsx("div",{children:[...Array(2)].map((a,r)=>e.jsx(T,{type:"event"},r))}):d.length===0?e.jsxs("div",{className:"card py-8 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg font-semibold mb-2",children:"No hay eventos culturales aún"}),e.jsx("p",{className:"text-sm text-gray-400",children:"¡Sé el primero en crear un evento!"})]}):e.jsx("div",{className:"space-y-4",children:(f==="feed"?d.slice():d.slice().sort((a,r)=>new Date(r.date).getTime()-new Date(a.date).getTime())).map(a=>{var r,c,u,j;return e.jsx("div",{className:"cursor-pointer",onClick:()=>i("event",a.id),children:e.jsx(_e,{event:{id:a.id,titulo:a.title,descripcion:a.description,fecha_inicio:a.date,ubicacion:a.location||"",imagen_url:a.imagen_url,categoria:"",tipo:a.type,userId:a.userId,metadata:{target_audience:((r=a.metadata)==null?void 0:r.target_audience)||"",responsible_person:((c=a.metadata)==null?void 0:c.responsible_person)||{name:"",phone:""},technical_requirements:((u=a.metadata)==null?void 0:u.technical_requirements)||[],tags:((j=a.metadata)==null?void 0:j.tags)||[]}},onEdit:()=>x(a)})},a.id)})}),e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mt-8",children:"Publicaciones"}),m?e.jsx("div",{children:[...Array(3)].map((a,r)=>e.jsx(T,{type:"post"},r))}):t.length===0?e.jsxs("div",{className:"card py-8 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg font-semibold mb-2",children:"No hay publicaciones aún"}),e.jsx("p",{className:"text-sm text-gray-400",children:"¡Crea tu primera publicación para comenzar!"})]}):e.jsx("div",{className:"space-y-4",children:(g==="feed"?t.slice().sort((a,r)=>r.likes.length-a.likes.length):t.slice().sort((a,r)=>new Date(r.createdAt).getTime()-new Date(a.createdAt).getTime())).map(a=>e.jsx("div",{className:"cursor-pointer",onClick:()=>i("post",a.id),children:e.jsx(X,{post:a})},a.id))})]})};export{Fe as default};
