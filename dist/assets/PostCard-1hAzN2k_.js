import{c as P,r as n,b as q,R as G,j as e,g as C,H as J,o as K,a as O}from"./index-BrRfBUNT.js";import{u as Q,g as y,f as E}from"./postStore-CI7NDm86.js";import{$ as X,d as Y}from"./native-Cgrkzqac.js";import{S as Z}from"./share-2-2ppTR6CC.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=P("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=P("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),I=/(https?:\/\/[\w\-\.\/?#&=;%+~]+)|(www\.[\w\-\.\/?#&=;%+~]+)/gi,le=({post:a})=>{var S;const[o,f]=n.useState(!1),[m,x]=n.useState(""),[r,$]=n.useState(null),[L,v]=n.useState({}),[j,N]=n.useState(!0),[p,b]=n.useState(!0),[R,k]=n.useState(!1),{user:i}=q(),{toggleLike:V,addComment:A,toggleFavorite:H,deletePost:M}=Q(),h=G.useRef(null);n.useEffect(()=>{let s=!0;return N(!0),(async()=>{const t=await y(a.userId);s&&($(t),N(!1))})(),()=>{s=!1}},[a.userId]),n.useEffect(()=>{let s=!0;return b(!0),(async()=>{const t=Array.from(new Set(a.comments.map(l=>l.userId))),c={};await Promise.all(t.map(async l=>{const d=await y(l);d&&(c[l]=d)})),s&&(v(c),b(!1))})(),()=>{s=!1}},[a.comments]);const w=i?a.likes.includes(i.id):!1,z=()=>{i&&V(a.id,i.id)},B=async s=>{if(s.preventDefault(),i&&m.trim()){await A(a.id,i.id,m),x("");const t=Array.from(new Set([...a.comments.map(l=>l.userId),i.id])),c={};await Promise.all(t.map(async l=>{const d=await y(l);d&&(c[l]=d)})),v(c)}},T=()=>{H(a.id)},D=()=>{var s;navigator.share?navigator.share({title:((s=a.content)==null?void 0:s.slice(0,60))||"Post de Red Viento Sur",text:a.content,url:window.location.origin+"/posts/"+a.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/posts/"+a.id),O.success("Â¡Enlace copiado!"))},F=async()=>{!i||i.id!==a.userId||window.confirm("Â¿EstÃ¡s seguro de eliminar este post?")&&await M(a.id)},U=s=>{var t,c,l,d;if(h.current){const u=h.current,g=u.selectionStart||0,W=u.selectionEnd||0,_=m.slice(0,g)+(s.native||((c=(t=s.skins)==null?void 0:t[0])==null?void 0:c.native)||"")+m.slice(W);x(_),setTimeout(()=>{u.focus(),u.setSelectionRange(g+2,g+2)},0)}else x(m+(s.native||((d=(l=s.skins)==null?void 0:l[0])==null?void 0:d.native)||""));k(!1)};return!a||!r?null:e.jsxs("article",{className:"feed-item",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[r!=null&&r.username?e.jsx(C,{to:`/profile/${r.username}`,className:"avatar","aria-label":`Ver perfil de ${r.displayName||"Usuario"}`,children:j?e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full animate-pulse"}):e.jsx("img",{src:(r==null?void 0:r.avatar)||"/default-avatar.png",alt:(r==null?void 0:r.displayName)||"Usuario",className:"avatar-img"})}):e.jsx("div",{className:"avatar",children:e.jsx("img",{src:(r==null?void 0:r.avatar)||"/default-avatar.png",alt:(r==null?void 0:r.displayName)||"Usuario",className:"avatar-img opacity-50"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:j?e.jsx("span",{className:"bg-gray-200 rounded w-20 h-4 inline-block animate-pulse"}):r!=null&&r.username?e.jsx(C,{to:`/profile/${r.username}`,className:"hover:underline","aria-label":`Ver perfil de ${r.displayName||"Usuario"}`,children:(r==null?void 0:r.displayName)||"Usuario"}):e.jsx("span",{className:"text-gray-400",children:(r==null?void 0:r.displayName)||"Usuario"})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:E(a.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:e.jsx(ae,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),i&&i.id===a.userId&&e.jsx("button",{onClick:F,className:"p-2 rounded-full hover:bg-red-100 dark:hover:bg-red-900",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3m5 0H6"})})})]})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsx("p",{className:"mb-3 text-gray-900 dark:text-white",children:a.content})}),a.content&&a.content.match(I)&&e.jsx("div",{className:"mb-3",children:(S=a.content.match(I))==null?void 0:S.map((s,t)=>e.jsx("div",{className:"mb-2",children:e.jsx("a",{href:s.startsWith("http")?s:`https://${s}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 underline break-all",children:s})},t))}),a.mediaUrl&&a.type==="image"&&e.jsx("div",{className:"relative pb-3",children:e.jsx("img",{src:a.mediaUrl,alt:"Post media",className:"w-full object-cover max-h-[500px]"})}),a.mediaUrl&&a.type==="video"&&e.jsx("div",{className:"relative pb-3",children:e.jsx("video",{src:a.mediaUrl,controls:!0,className:"w-full max-h-[500px] rounded-lg"})}),a.mediaUrl&&a.type==="audio"&&e.jsx("div",{className:"relative pb-3",children:e.jsx("audio",{src:a.mediaUrl,controls:!0,className:"w-full"})}),a.mediaUrl&&a.type==="document"&&e.jsx("div",{className:"relative pb-3",children:e.jsx("a",{href:a.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 underline",children:"Ver documento"})}),e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between border-t border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("button",{onClick:z,className:"flex items-center space-x-1 group",children:[e.jsx(J,{className:`h-5 w-5 ${w?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${w?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:a.likes.length})]}),e.jsxs("button",{onClick:()=>f(!o),className:"flex items-center space-x-1 group",children:[e.jsx(K,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:a.comments.length})]}),e.jsx("button",{onClick:D,className:"flex items-center group",title:"Compartir",children:e.jsx(Z,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"})})]}),e.jsx("button",{onClick:T,className:"flex items-center group",children:e.jsx(ee,{className:`h-5 w-5 ${a.isFavorite?"text-primary-500 fill-primary-500":"text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}`})})]}),(a.comments.length>0||o)&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-800/50 rounded-b-xl",children:[a.comments.length>0&&e.jsxs("div",{className:"mb-3 space-y-3",children:[a.comments.slice(0,o?void 0:2).map(s=>{const t=L[s.userId];return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"avatar w-8 h-8",children:p?e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full animate-pulse"}):e.jsx("img",{src:(t==null?void 0:t.avatar)||"/default-avatar.png",alt:(t==null?void 0:t.displayName)||"Usuario",className:"avatar-img"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-white",children:p?e.jsx("span",{className:"bg-gray-200 rounded w-16 h-3 inline-block animate-pulse"}):(t==null?void 0:t.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.content})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:E(s.createdAt)})]})]},s.id)}),a.comments.length>2&&!o&&e.jsxs("button",{onClick:()=>f(!0),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:["View all ",a.comments.length," comments"]})]}),i&&e.jsxs("form",{onSubmit:B,className:"flex items-center space-x-2 relative",children:[e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:i.avatar,alt:i.displayName,className:"avatar-img"})}),e.jsx("input",{ref:h,type:"text",placeholder:"AÃ±ade un comentario...",className:"flex-1 bg-white dark:bg-gray-900 rounded-full px-4 py-2 text-sm border border-gray-200 dark:border-gray-700 focus:ring-1 focus:ring-primary-500 focus:border-primary-500",value:m,onChange:s=>x(s.target.value)}),e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>k(s=>!s),"aria-label":"Insertar emoji",tabIndex:-1,children:e.jsx("span",{role:"img","aria-label":"emoji",children:"ðŸ˜Š"})}),e.jsx("button",{type:"submit",disabled:!m.trim(),className:"text-sm font-medium text-primary-600 dark:text-primary-400 disabled:opacity-50",children:"Publicar"}),R&&e.jsx("div",{className:"absolute z-50 bottom-12 right-0",children:e.jsx(X,{data:Y,onEmojiSelect:U,theme:"auto"})})]})]})]})};export{ee as B,le as P};
