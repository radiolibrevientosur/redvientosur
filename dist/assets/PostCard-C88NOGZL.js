import{c as te,r as n,e as se,R as N,j as e,q as k,B as le,d as h,H as ie,M as ne,s as oe}from"./index-CkCNI7dU.js";import{u as ce,g as C,f as S}from"./postStore-f2sBwH6p.js";import{$ as de,d as me}from"./native-DGJ9haqb.js";import{E as xe}from"./ellipsis-BNycaEhj.js";import{S as ue}from"./share-2-D6YOoNpV.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],he=te("bookmark",ge),F=/(https?:\/\/[\w\-\.\/?#&=;%+~]+)|(www\.[\w\-\.\/?#&=;%+~]+)/gi,ve=({post:r,disableCardNavigation:T,onDeleted:P})=>{var B;const[x,E]=n.useState(!1),[d,u]=n.useState(""),[s,_]=n.useState(null),[z,I]=n.useState({}),[$,R]=n.useState(!0),[A,U]=n.useState(!0),[D,L]=n.useState(!1),[O,b]=n.useState(!1),[f,y]=n.useState(0),[q,m]=n.useState(!1),[p,H]=n.useState(null),{user:i}=se(),{toggleLike:G,addComment:W,toggleFavorite:X}=ce(),j=N.useRef(null),v=N.useRef(null);n.useEffect(()=>{let a=!0;return R(!0),(async()=>{const t=await C(r.userId);a&&(_(t),R(!1))})(),()=>{a=!1}},[r.userId]),n.useEffect(()=>{let a=!0;return U(!0),(async()=>{const t=Array.from(new Set(r.comments.map(l=>l.userId))),o={};await Promise.all(t.map(async l=>{const c=await C(l);c&&(o[l]=c)})),a&&(I(o),U(!1))})(),()=>{a=!1}},[r.comments]);const M=i?r.likes.includes(i.id):!1,Y=()=>{i&&G(r.id,i.id)},J=async a=>{if(a.preventDefault(),i&&d.trim()){await W(r.id,i.id,d),u("");const t=Array.from(new Set([...r.comments.map(l=>l.userId),i.id])),o={};await Promise.all(t.map(async l=>{const c=await C(l);c&&(o[l]=c)})),I(o)}},K=()=>{X(r.id)},V=()=>{var a;navigator.share?navigator.share({title:((a=r.content)==null?void 0:a.slice(0,60))||"Post de Red Viento Sur",text:r.content,url:window.location.origin+"/posts/"+r.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/posts/"+r.id),h.success("¡Enlace copiado!"))},Q=async()=>{if(!(!i||i.id!==r.userId)&&window.confirm("¿Estás seguro de eliminar este post?"))try{const{error:a}=await oe.from("posts").delete().eq("id",r.id);if(a)throw a;h.success("Post eliminado exitosamente"),typeof P=="function"&&P()}catch{h.error("Error al eliminar el post")}},Z=a=>{var t,o,l,c;if(j.current){const g=j.current,w=g.selectionStart||0,ae=g.selectionEnd||0,re=d.slice(0,w)+(a.native||((o=(t=a.skins)==null?void 0:t[0])==null?void 0:o.native)||"")+d.slice(ae);u(re),setTimeout(()=>{g.focus(),g.setSelectionRange(w+2,w+2)},0)}else u(d+(a.native||((c=(l=a.skins)==null?void 0:l[0])==null?void 0:c.native)||""));L(!1)},ee=a=>{a.stopPropagation(),m(t=>{const o=!t;if(o&&v.current){const l=v.current.getBoundingClientRect();H({top:l.bottom+window.scrollY,left:l.left+window.scrollX})}return o})};return!r||!s?null:e.jsxs("article",{className:"feed-item rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-md hover:shadow-lg transition-shadow duration-200 mb-6 overflow-visible relative",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[s!=null&&s.username?e.jsx(k,{to:`/profile/${s.username}`,className:"avatar","aria-label":`Ver perfil de ${s.displayName||"Usuario"}`,children:$?e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full animate-pulse"}):e.jsx("img",{src:(s==null?void 0:s.avatar)||"/default-avatar.png",alt:(s==null?void 0:s.displayName)||"Usuario",className:"avatar-img"})}):e.jsx("div",{className:"avatar",children:e.jsx("img",{src:(s==null?void 0:s.avatar)||"/default-avatar.png",alt:(s==null?void 0:s.displayName)||"Usuario",className:"avatar-img opacity-50"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:$?e.jsx("span",{className:"bg-gray-200 rounded w-20 h-4 inline-block animate-pulse"}):s!=null&&s.username?e.jsx(k,{to:`/profile/${s.username}`,className:"hover:underline","aria-label":`Ver perfil de ${s.displayName||"Usuario"}`,children:(s==null?void 0:s.displayName)||"Usuario"}):e.jsx("span",{className:"text-gray-400",children:(s==null?void 0:s.displayName)||"Usuario"})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:T?e.jsx("span",{children:S(r.createdAt)}):e.jsx(k,{to:`/posts/${r.id}`,className:"hover:underline",onClick:a=>{a.target.closest('[data-menu="post-menu"]')&&a.preventDefault()},children:e.jsx("span",{children:S(r.createdAt)})})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 relative",children:[e.jsx("button",{ref:v,type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:ee,"aria-label":"Abrir menú","data-menu":"post-menu",children:e.jsx(xe,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),q&&p&&le.createPortal(e.jsx("div",{className:"z-[9999] bg-white dark:bg-gray-900 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 min-w-[180px] animate-fade-in",style:{position:"absolute",top:p.top,left:p.left,overflow:"visible"},children:e.jsxs("ul",{className:"py-2",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{navigator.clipboard.writeText(window.location.origin+"/posts/"+r.id),m(!1),h.success("¡Enlace copiado!")},children:"Guardar enlace"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:V,children:"Compartir publicación"})}),i&&i.id===r.userId&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{m(!1)},children:"Editar publicación"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-800",onClick:async()=>{await Q(),m(!1)},children:"Eliminar publicación"})})]}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:a=>{a.stopPropagation(),m(!1)},children:"Cancelar"})})]})}),document.body)]})]}),e.jsx("div",{className:"px-4 pb-3 pt-2",children:e.jsx("p",{className:"mb-3 text-gray-900 dark:text-white text-base leading-relaxed whitespace-pre-line break-words",children:r.content})}),r.content&&r.content.match(F)&&e.jsx("div",{className:"mb-3",children:(B=r.content.match(F))==null?void 0:B.map((a,t)=>e.jsx("div",{className:"mb-2",children:e.jsx("a",{href:a.startsWith("http")?a:`https://${a}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 underline break-all",children:a})},t))}),Array.isArray(r.mediaUrls)&&r.mediaUrls.length>0?e.jsxs("div",{className:"relative pb-3 flex flex-wrap gap-2 justify-center",children:[r.mediaUrls.map((a,t)=>e.jsxs(N.Fragment,{children:[a.type==="image"&&e.jsx("img",{src:a.url,alt:`Imagen ${t+1}`,className:"rounded-xl border border-gray-200 dark:border-gray-800 w-auto max-w-[180px] max-h-[220px] object-contain shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer",onClick:()=>{y(t),b(!0)}}),a.type==="video"&&e.jsx("video",{src:a.url,controls:!0,className:"rounded-xl border border-gray-200 dark:border-gray-800 w-auto max-w-[220px] max-h-[220px] object-contain shadow-sm"}),a.type==="audio"&&e.jsx("audio",{src:a.url,controls:!0,className:"w-full"}),a.type==="document"&&e.jsx("div",{className:"flex items-center",children:e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 underline",children:["Ver documento ",a.name||""]})})]},a.url)),O&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80",onClick:()=>b(!1),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white text-3xl font-bold bg-black/40 rounded-full p-2 hover:bg-black/70",onClick:a=>{a.stopPropagation(),b(!1)},"aria-label":"Cerrar",children:"×"}),e.jsx("button",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white text-3xl font-bold bg-black/40 rounded-full p-2 hover:bg-black/70",onClick:a=>{a.stopPropagation(),y(t=>(t-1+r.mediaUrls.length)%r.mediaUrls.length)},"aria-label":"Anterior",children:"‹"}),e.jsx("img",{src:r.mediaUrls[f].url,alt:`Imagen ampliada ${f+1}`,className:"max-h-[80vh] max-w-[90vw] rounded-xl shadow-2xl border-4 border-white object-contain",onClick:a=>a.stopPropagation()}),e.jsx("button",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-white text-3xl font-bold bg-black/40 rounded-full p-2 hover:bg-black/70",onClick:a=>{a.stopPropagation(),y(t=>(t+1)%r.mediaUrls.length)},"aria-label":"Siguiente",children:"›"}),e.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 text-white text-sm bg-black/40 rounded px-3 py-1",children:[f+1," / ",r.mediaUrls.length]})]})]}):e.jsxs(e.Fragment,{children:[r.mediaUrl&&r.type==="image"&&e.jsx("div",{className:"relative pb-3 flex justify-center",children:e.jsx("img",{src:r.mediaUrl,alt:"Post media",className:"rounded-xl border border-gray-200 dark:border-gray-800 w-auto max-w-full max-h-[350px] object-contain shadow-sm hover:shadow-md transition-shadow duration-200"})}),r.mediaUrl&&r.type==="video"&&e.jsx("div",{className:"relative pb-3 flex justify-center",children:e.jsx("video",{src:r.mediaUrl,controls:!0,className:"rounded-xl border border-gray-200 dark:border-gray-800 w-auto max-w-full max-h-[350px] object-contain shadow-sm"})}),r.mediaUrl&&r.type==="audio"&&e.jsx("div",{className:"relative pb-3 flex items-center",children:e.jsx("audio",{src:r.mediaUrl,controls:!0,className:"w-full"})}),r.mediaUrl&&r.type==="document"&&e.jsx("div",{className:"relative pb-3 flex items-center",children:e.jsx("a",{href:r.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 underline",children:"Ver documento"})})]}),e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between border-t border-gray-100 dark:border-gray-800 bg-gray-50 dark:bg-gray-800/40 rounded-b-2xl",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("button",{onClick:Y,className:"flex items-center space-x-1 group",children:[e.jsx(ie,{className:`h-5 w-5 ${M?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${M?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:r.likes.length})]}),e.jsxs("button",{onClick:()=>E(!x),className:"flex items-center space-x-1 group",children:[e.jsx(ne,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:r.comments.length})]}),e.jsx("button",{onClick:V,className:"flex items-center group",title:"Compartir",children:e.jsx(ue,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"})})]}),e.jsx("button",{onClick:K,className:"flex items-center group",children:e.jsx(he,{className:`h-5 w-5 ${r.isFavorite?"text-primary-500 fill-primary-500":"text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}`})})]}),(r.comments.length>0||x)&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-800/50 rounded-b-xl",children:[r.comments.length>0&&e.jsxs("div",{className:"mb-3 space-y-3",children:[r.comments.slice(0,x?void 0:2).map(a=>{const t=z[a.userId];return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"avatar w-8 h-8",children:A?e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full animate-pulse"}):e.jsx("img",{src:(t==null?void 0:t.avatar)||"/default-avatar.png",alt:(t==null?void 0:t.displayName)||"Usuario",className:"avatar-img"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-white",children:A?e.jsx("span",{className:"bg-gray-200 rounded w-16 h-3 inline-block animate-pulse"}):(t==null?void 0:t.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:a.content})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:S(a.createdAt)})]})]},a.id)}),r.comments.length>2&&!x&&e.jsxs("button",{onClick:()=>E(!0),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:["View all ",r.comments.length," comments"]})]}),i&&e.jsxs("form",{onSubmit:J,className:"flex items-center space-x-2 relative",children:[e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:i.avatar,alt:i.displayName,className:"avatar-img"})}),e.jsx("input",{ref:j,type:"text",placeholder:"Añade un comentario...",className:"flex-1 bg-white dark:bg-gray-900 rounded-full px-4 py-2 text-sm border border-gray-200 dark:border-gray-700 focus:ring-1 focus:ring-primary-500 focus:border-primary-500",value:d,onChange:a=>u(a.target.value)}),e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>L(a=>!a),"aria-label":"Insertar emoji",tabIndex:-1,children:e.jsx("span",{role:"img","aria-label":"emoji",children:"😊"})}),e.jsx("button",{type:"submit",disabled:!d.trim(),className:"text-sm font-medium text-primary-600 dark:text-primary-400 disabled:opacity-50",children:"Publicar"}),D&&e.jsx("div",{className:"absolute z-50 bottom-12 right-0",children:e.jsx(de,{data:me,onEmojiSelect:Z,theme:"auto"})})]})]})]})};export{he as B,ve as P};
