import{c as L,r as n,u as q,R as G,j as e,b as E,H as J,M as K,s as O,a as y}from"./index-CbDr9Sw3.js";import{u as Q,g as f,f as I,$ as X,d as Y}from"./native-BdzBTjqu.js";import{S as Z}from"./share-2-CVriX9b-.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=L("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=L("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),P=/(https?:\/\/[\w\-\.\/?#&=;%+~]+)|(www\.[\w\-\.\/?#&=;%+~]+)/gi,ie=({post:a})=>{var C;const[o,v]=n.useState(!1),[m,x]=n.useState(""),[t,$]=n.useState(null),[R,j]=n.useState({}),[p,b]=n.useState(!0),[N,k]=n.useState(!0),[A,w]=n.useState(!1),{user:i}=q(),{toggleLike:M,addComment:H,toggleFavorite:V}=Q(),h=G.useRef(null);n.useEffect(()=>{let r=!0;return b(!0),(async()=>{const s=await f(a.userId);r&&($(s),b(!1))})(),()=>{r=!1}},[a.userId]),n.useEffect(()=>{let r=!0;return k(!0),(async()=>{const s=Array.from(new Set(a.comments.map(l=>l.userId))),c={};await Promise.all(s.map(async l=>{const d=await f(l);d&&(c[l]=d)})),r&&(j(c),k(!1))})(),()=>{r=!1}},[a.comments]);const S=i?a.likes.includes(i.id):!1,z=()=>{i&&M(a.id,i.id)},B=async r=>{if(r.preventDefault(),i&&m.trim()){await H(a.id,i.id,m),x("");const s=Array.from(new Set([...a.comments.map(l=>l.userId),i.id])),c={};await Promise.all(s.map(async l=>{const d=await f(l);d&&(c[l]=d)})),j(c)}},T=()=>{V(a.id)},U=()=>{var r;navigator.share?navigator.share({title:((r=a.content)==null?void 0:r.slice(0,60))||"Post de Red Viento Sur",text:a.content,url:window.location.origin+"/posts/"+a.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/posts/"+a.id),y.success("Â¡Enlace copiado!"))},D=async()=>{if(!(!i||i.id!==a.userId)&&window.confirm("Â¿EstÃ¡s seguro de eliminar este post?"))try{const{error:r}=await O.from("posts").delete().eq("id",a.id);if(r)throw r;y.success("Post eliminado exitosamente")}catch{y.error("Error al eliminar el post")}},F=r=>{var s,c,l,d;if(h.current){const u=h.current,g=u.selectionStart||0,W=u.selectionEnd||0,_=m.slice(0,g)+(r.native||((c=(s=r.skins)==null?void 0:s[0])==null?void 0:c.native)||"")+m.slice(W);x(_),setTimeout(()=>{u.focus(),u.setSelectionRange(g+2,g+2)},0)}else x(m+(r.native||((d=(l=r.skins)==null?void 0:l[0])==null?void 0:d.native)||""));w(!1)};return!a||!t?null:e.jsxs("article",{className:"feed-item",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(E,{to:t!=null&&t.username?`/profile/${t.username}`:"#",className:"avatar",children:p?e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full animate-pulse"}):e.jsx("img",{src:(t==null?void 0:t.avatar)||"/default-avatar.png",alt:(t==null?void 0:t.displayName)||"Usuario",className:"avatar-img"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:p?e.jsx("span",{className:"bg-gray-200 rounded w-20 h-4 inline-block animate-pulse"}):e.jsx(E,{to:t!=null&&t.username?`/profile/${t.username}`:"#",className:"hover:underline",children:(t==null?void 0:t.displayName)||"Usuario"})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:I(a.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",children:e.jsx(ae,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),i&&i.id===a.userId&&e.jsx("button",{onClick:D,className:"p-2 rounded-full hover:bg-red-100 dark:hover:bg-red-900",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3m5 0H6"})})})]})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsx("p",{className:"mb-3 text-gray-900 dark:text-white",children:a.content})}),a.content&&a.content.match(P)&&e.jsx("div",{className:"mb-3",children:(C=a.content.match(P))==null?void 0:C.map((r,s)=>e.jsx("div",{className:"mb-2",children:e.jsx("a",{href:r.startsWith("http")?r:`https://${r}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 underline break-all",children:r})},s))}),a.mediaUrl&&a.type==="image"&&e.jsx("div",{className:"relative pb-3",children:e.jsx("img",{src:a.mediaUrl,alt:"Post media",className:"w-full object-cover max-h-[500px]"})}),a.mediaUrl&&a.type==="video"&&e.jsx("div",{className:"relative pb-3",children:e.jsx("video",{src:a.mediaUrl,controls:!0,className:"w-full max-h-[500px] rounded-lg"})}),a.mediaUrl&&a.type==="audio"&&e.jsx("div",{className:"relative pb-3",children:e.jsx("audio",{src:a.mediaUrl,controls:!0,className:"w-full"})}),a.mediaUrl&&a.type==="document"&&e.jsx("div",{className:"relative pb-3",children:e.jsx("a",{href:a.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 underline",children:"Ver documento"})}),e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between border-t border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("button",{onClick:z,className:"flex items-center space-x-1 group",children:[e.jsx(J,{className:`h-5 w-5 ${S?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${S?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:a.likes.length})]}),e.jsxs("button",{onClick:()=>v(!o),className:"flex items-center space-x-1 group",children:[e.jsx(K,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:a.comments.length})]}),e.jsx("button",{onClick:U,className:"flex items-center group",title:"Compartir",children:e.jsx(Z,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"})})]}),e.jsx("button",{onClick:T,className:"flex items-center group",children:e.jsx(ee,{className:`h-5 w-5 ${a.isFavorite?"text-primary-500 fill-primary-500":"text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}`})})]}),(a.comments.length>0||o)&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-800/50 rounded-b-xl",children:[a.comments.length>0&&e.jsxs("div",{className:"mb-3 space-y-3",children:[a.comments.slice(0,o?void 0:2).map(r=>{const s=R[r.userId];return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"avatar w-8 h-8",children:N?e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full animate-pulse"}):e.jsx("img",{src:(s==null?void 0:s.avatar)||"/default-avatar.png",alt:(s==null?void 0:s.displayName)||"Usuario",className:"avatar-img"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-white",children:N?e.jsx("span",{className:"bg-gray-200 rounded w-16 h-3 inline-block animate-pulse"}):(s==null?void 0:s.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:r.content})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:I(r.createdAt)})]})]},r.id)}),a.comments.length>2&&!o&&e.jsxs("button",{onClick:()=>v(!0),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:["View all ",a.comments.length," comments"]})]}),i&&e.jsxs("form",{onSubmit:B,className:"flex items-center space-x-2 relative",children:[e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:i.avatar,alt:i.displayName,className:"avatar-img"})}),e.jsx("input",{ref:h,type:"text",placeholder:"AÃ±ade un comentario...",className:"flex-1 bg-white dark:bg-gray-900 rounded-full px-4 py-2 text-sm border border-gray-200 dark:border-gray-700 focus:ring-1 focus:ring-primary-500 focus:border-primary-500",value:m,onChange:r=>x(r.target.value)}),e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>w(r=>!r),"aria-label":"Insertar emoji",tabIndex:-1,children:e.jsx("span",{role:"img","aria-label":"emoji",children:"ðŸ˜Š"})}),e.jsx("button",{type:"submit",disabled:!m.trim(),className:"text-sm font-medium text-primary-600 dark:text-primary-400 disabled:opacity-50",children:"Publicar"}),A&&e.jsx("div",{className:"absolute z-50 bottom-12 right-0",children:e.jsx(X,{data:Y,onEmojiSelect:F,theme:"auto"})})]})]})]})};export{ee as B,ie as P};
