import{c as K,r as n,u as O,R as Q,j as e,p as b,d as h,H as X,M as Y,s as Z}from"./index-BGdIQiaM.js";import{u as ee,g as p,f as v}from"./postStore-CwMn21os.js";import{$ as ae,d as re}from"./native-Cp8PlxG7.js";import{E as te}from"./ellipsis-B-xpudre.js";import{S as se}from"./share-2-D9WDayZo.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],le=K("bookmark",ie),R=/(https?:\/\/[\w\-\.\/?#&=;%+~]+)|(www\.[\w\-\.\/?#&=;%+~]+)/gi,xe=({post:a,disableCardNavigation:L,onDeleted:j})=>{var A;const[x,N]=n.useState(!1),[o,u]=n.useState(""),[t,V]=n.useState(null),[M,w]=n.useState({}),[k,C]=n.useState(!0),[S,E]=n.useState(!0),[T,P]=n.useState(!1),{user:i}=O(),{toggleLike:F,addComment:_,toggleFavorite:z}=ee(),[B,m]=n.useState(!1),y=Q.useRef(null);n.useEffect(()=>{let r=!0;return C(!0),(async()=>{const s=await p(a.userId);r&&(V(s),C(!1))})(),()=>{r=!1}},[a.userId]),n.useEffect(()=>{let r=!0;return E(!0),(async()=>{const s=Array.from(new Set(a.comments.map(l=>l.userId))),d={};await Promise.all(s.map(async l=>{const c=await p(l);c&&(d[l]=c)})),r&&(w(d),E(!1))})(),()=>{r=!1}},[a.comments]);const I=i?a.likes.includes(i.id):!1,D=()=>{i&&F(a.id,i.id)},H=async r=>{if(r.preventDefault(),i&&o.trim()){await _(a.id,i.id,o),u("");const s=Array.from(new Set([...a.comments.map(l=>l.userId),i.id])),d={};await Promise.all(s.map(async l=>{const c=await p(l);c&&(d[l]=c)})),w(d)}},U=()=>{z(a.id)},$=()=>{var r;navigator.share?navigator.share({title:((r=a.content)==null?void 0:r.slice(0,60))||"Post de Red Viento Sur",text:a.content,url:window.location.origin+"/posts/"+a.id}).catch(()=>{}):(navigator.clipboard.writeText(window.location.origin+"/posts/"+a.id),h.success("¡Enlace copiado!"))},q=async()=>{if(!(!i||i.id!==a.userId)&&window.confirm("¿Estás seguro de eliminar este post?"))try{const{error:r}=await Z.from("posts").delete().eq("id",a.id);if(r)throw r;h.success("Post eliminado exitosamente"),typeof j=="function"&&j()}catch{h.error("Error al eliminar el post")}},G=r=>{var s,d,l,c;if(y.current){const g=y.current,f=g.selectionStart||0,W=g.selectionEnd||0,J=o.slice(0,f)+(r.native||((d=(s=r.skins)==null?void 0:s[0])==null?void 0:d.native)||"")+o.slice(W);u(J),setTimeout(()=>{g.focus(),g.setSelectionRange(f+2,f+2)},0)}else u(o+(r.native||((c=(l=r.skins)==null?void 0:l[0])==null?void 0:c.native)||""));P(!1)};return!a||!t?null:e.jsxs("article",{className:"feed-item rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-md hover:shadow-lg transition-shadow duration-200 mb-6 overflow-visible",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[t!=null&&t.username?e.jsx(b,{to:`/profile/${t.username}`,className:"avatar","aria-label":`Ver perfil de ${t.displayName||"Usuario"}`,children:k?e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full animate-pulse"}):e.jsx("img",{src:(t==null?void 0:t.avatar)||"/default-avatar.png",alt:(t==null?void 0:t.displayName)||"Usuario",className:"avatar-img"})}):e.jsx("div",{className:"avatar",children:e.jsx("img",{src:(t==null?void 0:t.avatar)||"/default-avatar.png",alt:(t==null?void 0:t.displayName)||"Usuario",className:"avatar-img opacity-50"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:k?e.jsx("span",{className:"bg-gray-200 rounded w-20 h-4 inline-block animate-pulse"}):t!=null&&t.username?e.jsx(b,{to:`/profile/${t.username}`,className:"hover:underline","aria-label":`Ver perfil de ${t.displayName||"Usuario"}`,children:(t==null?void 0:t.displayName)||"Usuario"}):e.jsx("span",{className:"text-gray-400",children:(t==null?void 0:t.displayName)||"Usuario"})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:L?e.jsx("span",{children:v(a.createdAt)}):e.jsx(b,{to:`/posts/${a.id}`,className:"hover:underline",onClick:r=>{r.target.closest('[data-menu="post-menu"]')&&r.preventDefault()},children:e.jsx("span",{children:v(a.createdAt)})})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 relative",children:[e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:r=>{r.stopPropagation(),m(s=>!s)},"aria-label":"Abrir menú","data-menu":"post-menu",children:e.jsx(te,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}),B&&e.jsx("div",{className:"absolute right-0 top-full mt-2 z-50 bg-white dark:bg-gray-900 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 min-w-[180px] animate-fade-in",style:{overflow:"visible"},children:e.jsxs("ul",{className:"py-2",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{navigator.clipboard.writeText(window.location.origin+"/posts/"+a.id),m(!1),h.success("¡Enlace copiado!")},children:"Guardar enlace"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:$,children:"Compartir publicación"})}),i&&i.id===a.userId&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>{m(!1)},children:"Editar publicación"})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-gray-800",onClick:async()=>{await q(),m(!1)},children:"Eliminar publicación"})})]}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:r=>{r.stopPropagation(),m(!1)},children:"Cancelar"})})]})})]})]}),e.jsx("div",{className:"px-4 pb-3 pt-2",children:e.jsx("p",{className:"mb-3 text-gray-900 dark:text-white text-base leading-relaxed whitespace-pre-line break-words",children:a.content})}),a.content&&a.content.match(R)&&e.jsx("div",{className:"mb-3",children:(A=a.content.match(R))==null?void 0:A.map((r,s)=>e.jsx("div",{className:"mb-2",children:e.jsx("a",{href:r.startsWith("http")?r:`https://${r}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 underline break-all",children:r})},s))}),a.mediaUrl&&a.type==="image"&&e.jsx("div",{className:"relative pb-3 flex justify-center",children:e.jsx("img",{src:a.mediaUrl,alt:"Post media",className:"rounded-xl border border-gray-200 dark:border-gray-800 w-auto max-w-full max-h-[350px] object-contain shadow-sm hover:shadow-md transition-shadow duration-200"})}),a.mediaUrl&&a.type==="video"&&e.jsx("div",{className:"relative pb-3 flex justify-center",children:e.jsx("video",{src:a.mediaUrl,controls:!0,className:"rounded-xl border border-gray-200 dark:border-gray-800 w-auto max-w-full max-h-[350px] object-contain shadow-sm"})}),a.mediaUrl&&a.type==="audio"&&e.jsx("div",{className:"relative pb-3 flex items-center",children:e.jsx("audio",{src:a.mediaUrl,controls:!0,className:"w-full"})}),a.mediaUrl&&a.type==="document"&&e.jsx("div",{className:"relative pb-3 flex items-center",children:e.jsx("a",{href:a.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 underline",children:"Ver documento"})}),e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between border-t border-gray-100 dark:border-gray-800 bg-gray-50 dark:bg-gray-800/40 rounded-b-2xl",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("button",{onClick:D,className:"flex items-center space-x-1 group",children:[e.jsx(X,{className:`h-5 w-5 ${I?"text-red-500 fill-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`}),e.jsx("span",{className:`text-sm ${I?"text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500"}`,children:a.likes.length})]}),e.jsxs("button",{onClick:()=>N(!x),className:"flex items-center space-x-1 group",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-500",children:a.comments.length})]}),e.jsx("button",{onClick:$,className:"flex items-center group",title:"Compartir",children:e.jsx(se,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-primary-500"})})]}),e.jsx("button",{onClick:U,className:"flex items-center group",children:e.jsx(le,{className:`h-5 w-5 ${a.isFavorite?"text-primary-500 fill-primary-500":"text-gray-600 dark:text-gray-400 group-hover:text-primary-500"}`})})]}),(a.comments.length>0||x)&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-800/50 rounded-b-xl",children:[a.comments.length>0&&e.jsxs("div",{className:"mb-3 space-y-3",children:[a.comments.slice(0,x?void 0:2).map(r=>{const s=M[r.userId];return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"avatar w-8 h-8",children:S?e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full animate-pulse"}):e.jsx("img",{src:(s==null?void 0:s.avatar)||"/default-avatar.png",alt:(s==null?void 0:s.displayName)||"Usuario",className:"avatar-img"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-2 rounded-lg",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-white",children:S?e.jsx("span",{className:"bg-gray-200 rounded w-16 h-3 inline-block animate-pulse"}):(s==null?void 0:s.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:r.content})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:v(r.createdAt)})]})]},r.id)}),a.comments.length>2&&!x&&e.jsxs("button",{onClick:()=>N(!0),className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:["View all ",a.comments.length," comments"]})]}),i&&e.jsxs("form",{onSubmit:H,className:"flex items-center space-x-2 relative",children:[e.jsx("div",{className:"avatar w-8 h-8",children:e.jsx("img",{src:i.avatar,alt:i.displayName,className:"avatar-img"})}),e.jsx("input",{ref:y,type:"text",placeholder:"Añade un comentario...",className:"flex-1 bg-white dark:bg-gray-900 rounded-full px-4 py-2 text-sm border border-gray-200 dark:border-gray-700 focus:ring-1 focus:ring-primary-500 focus:border-primary-500",value:o,onChange:r=>u(r.target.value)}),e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>P(r=>!r),"aria-label":"Insertar emoji",tabIndex:-1,children:e.jsx("span",{role:"img","aria-label":"emoji",children:"😊"})}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"text-sm font-medium text-primary-600 dark:text-primary-400 disabled:opacity-50",children:"Publicar"}),T&&e.jsx("div",{className:"absolute z-50 bottom-12 right-0",children:e.jsx(ae,{data:re,onEmojiSelect:G,theme:"auto"})})]})]})]})};export{le as B,xe as P};
