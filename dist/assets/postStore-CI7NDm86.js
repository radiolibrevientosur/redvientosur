import{d as S,s as l,a as h}from"./index-BrRfBUNT.js";import{e as L,c as x}from"./endOfMonth-CHJGNAHY.js";import{t as u,e as F,d as y,f as v,h as D,g as P}from"./en-US-D3c9jfE3.js";function M(r,i){const e=u(r),a=u(i),t=e.getTime()-a.getTime();return t<0?-1:t>0?1:t}function X(r,i){const e=u(r),a=u(i),t=e.getFullYear()-a.getFullYear(),n=e.getMonth()-a.getMonth();return t*12+n}function E(r){return i=>{const a=(r?Math[r]:Math.trunc)(i);return a===0?0:a}}function O(r,i){return+u(r)-+u(i)}function T(r){const i=u(r);return i.setHours(23,59,59,999),i}function b(r){const i=u(r);return+T(i)==+L(i)}function k(r,i){const e=u(r),a=u(i),t=M(e,a),n=Math.abs(X(e,a));let s;if(n<1)s=0;else{e.getMonth()===1&&e.getDate()>27&&e.setDate(30),e.setMonth(e.getMonth()-t*n);let o=M(e,a)===-t;b(u(r))&&n===1&&M(r,a)===1&&(o=!1),s=t*(n-Number(o))}return s===0?0:s}function q(r,i,e){const a=O(r,i)/1e3;return E(e==null?void 0:e.roundingMethod)(a)}function A(r,i,e){const a=P(),t=(e==null?void 0:e.locale)??a.locale??F,n=2520,s=M(r,i);if(isNaN(s))throw new RangeError("Invalid time value");const o=Object.assign({},e,{addSuffix:e==null?void 0:e.addSuffix,comparison:s});let c,d;s>0?(c=u(i),d=u(r)):(c=u(r),d=u(i));const g=q(d,c),p=(y(d)-y(c))/1e3,f=Math.round((g-p)/60);let _;if(f<2)return e!=null&&e.includeSeconds?g<5?t.formatDistance("lessThanXSeconds",5,o):g<10?t.formatDistance("lessThanXSeconds",10,o):g<20?t.formatDistance("lessThanXSeconds",20,o):g<40?t.formatDistance("halfAMinute",0,o):g<60?t.formatDistance("lessThanXMinutes",1,o):t.formatDistance("xMinutes",1,o):f===0?t.formatDistance("lessThanXMinutes",1,o):t.formatDistance("xMinutes",f,o);if(f<45)return t.formatDistance("xMinutes",f,o);if(f<90)return t.formatDistance("aboutXHours",1,o);if(f<v){const m=Math.round(f/60);return t.formatDistance("aboutXHours",m,o)}else{if(f<n)return t.formatDistance("xDays",1,o);if(f<D){const m=Math.round(f/v);return t.formatDistance("xDays",m,o)}else if(f<D*2)return _=Math.round(f/D),t.formatDistance("aboutXMonths",_,o)}if(_=k(d,c),_<12){const m=Math.round(f/D);return t.formatDistance("xMonths",m,o)}else{const m=_%12,w=Math.trunc(_/12);return m<3?t.formatDistance("aboutXYears",w,o):m<9?t.formatDistance("overXYears",w,o):t.formatDistance("almostXYears",w+1,o)}}function N(r,i){return A(r,x(r),i)}const z=S((r,i)=>({deletePost:async e=>{try{const{error:a}=await l.from("posts").delete().eq("id",e);if(a)throw a;r(t=>({posts:t.posts.filter(n=>n.id!==e)})),h.success("Post eliminado exitosamente")}catch{h.error("Error al eliminar el post")}},posts:[],isLoading:!1,error:null,fetchPosts:async()=>{r({isLoading:!0,error:null});try{const{data:e,error:a}=await l.from("posts").select(`
          *,
          autor:usuarios(*),
          comentarios:comentarios_post(*),
          reacciones:reacciones_post(*)
        `).order("creado_en",{ascending:!1});if(a)throw a;const t=await Promise.all(e.map(async n=>{var o;const{data:s}=await l.from("favoritos_post").select("*").eq("post_id",n.id).single();return{id:n.id,userId:n.autor_id,type:n.tipo,content:n.contenido,mediaUrl:(o=n.multimedia_url)==null?void 0:o[0],createdAt:n.creado_en,likes:n.reacciones.map(c=>c.usuario_id),comments:n.comentarios.map(c=>({id:c.id,userId:c.autor_id,content:c.contenido,createdAt:c.creado_en})),isFavorite:!!s}}));r({posts:t,isLoading:!1})}catch(e){r({error:e instanceof Error?e.message:"Error al cargar posts",isLoading:!1})}},addPost:async e=>{var a;r({isLoading:!0,error:null});try{const t=new Date().toISOString(),n={autor_id:e.userId,tipo:e.type,contenido:e.content,multimedia_url:e.mediaUrl?[e.mediaUrl]:[],creado_en:t,actualizado_en:t},{data:s,error:o}=await l.from("posts").insert(n).select().single();if(o)throw o;const c={id:s.id,userId:s.autor_id,type:s.tipo,content:s.contenido,mediaUrl:(a=s.multimedia_url)==null?void 0:a[0],createdAt:s.creado_en,likes:[],comments:[],isFavorite:!1};r(d=>({posts:[c,...d.posts],isLoading:!1})),h.success("¡Publicación creada exitosamente!")}catch(t){r({error:t instanceof Error?t.message:"Error al crear post",isLoading:!1}),h.error("Error al crear post")}},toggleLike:async(e,a)=>{try{const t=i().posts.find(s=>s.id===e);if(!t)return;const n=t.likes.includes(a);if(n){const{error:s}=await l.from("reacciones_post").delete().eq("post_id",e).eq("usuario_id",a);if(s)throw s}else{const{error:s}=await l.from("reacciones_post").insert({post_id:e,usuario_id:a,tipo:"like"});if(s)throw s}r(s=>({posts:s.posts.map(o=>o.id===e?{...o,likes:n?o.likes.filter(c=>c!==a):[...o.likes,a]}:o)}))}catch{h.error("Error al actualizar reacción")}},addComment:async(e,a,t)=>{try{const{data:n,error:s}=await l.from("comentarios_post").insert({post_id:e,autor_id:a,contenido:t}).select().single();if(s)throw s;const o={id:n.id,userId:n.autor_id,content:n.contenido,createdAt:n.creado_en};r(c=>({posts:c.posts.map(d=>d.id===e?{...d,comments:[...d.comments,o]}:d)})),h.success("Comentario agregado")}catch{h.error("Error al agregar comentario")}},toggleFavorite:async e=>{var a;try{const t=i().posts.find(s=>s.id===e);if(!t)return;const{data:n}=await l.auth.getSession();if(!((a=n==null?void 0:n.session)!=null&&a.user))return;if(t.isFavorite){const{error:s}=await l.from("favoritos_post").delete().eq("post_id",e).eq("usuario_id",n.session.user.id);if(s)throw s}else{const{error:s}=await l.from("favoritos_post").insert({post_id:e,usuario_id:n.session.user.id});if(s)throw s}r(s=>({posts:s.posts.map(o=>o.id===e?{...o,isFavorite:!o.isFavorite}:o)}))}catch{h.error("Error al actualizar favoritos")}},getFavoritePosts:()=>i().posts.filter(e=>e.isFavorite)})),I=async r=>{const{data:i,error:e}=await l.from("usuarios").select("*").eq("id",r).single();return e?null:{id:i.id,username:i.nombre_usuario,displayName:i.nombre_completo,avatar:i.avatar_url}},C=r=>N(new Date(r),{addSuffix:!0});export{C as f,I as g,z as u};
