import{d as S,s as d,a as _}from"./index-D_1SqTAH.js";import{t as u,e as L,f as x,g as y,m as b,h as M,i as F,j as X}from"./en-US-EYaBdrUG.js";function D(a,o){const e=u(a),n=u(o),r=e.getTime()-n.getTime();return r<0?-1:r>0?1:r}function T(a,o){const e=u(a),n=u(o),r=e.getFullYear()-n.getFullYear(),t=e.getMonth()-n.getMonth();return r*12+t}function k(a){return o=>{const n=(a?Math[a]:Math.trunc)(o);return n===0?0:n}}function E(a,o){return+u(a)-+u(o)}function O(a){const o=u(a);return o.setHours(23,59,59,999),o}function P(a){const o=u(a);return+O(o)==+L(o)}function A(a,o){const e=u(a),n=u(o),r=D(e,n),t=Math.abs(T(e,n));let s;if(t<1)s=0;else{e.getMonth()===1&&e.getDate()>27&&e.setDate(30),e.setMonth(e.getMonth()-r*t);let i=D(e,n)===-r;P(u(a))&&t===1&&D(a,n)===1&&(i=!1),s=r*(t-Number(i))}return s===0?0:s}function N(a,o,e){const n=E(a,o)/1e3;return k(e==null?void 0:e.roundingMethod)(n)}function q(a,o,e){const n=F(),r=(e==null?void 0:e.locale)??n.locale??x,t=2520,s=D(a,o);if(isNaN(s))throw new RangeError("Invalid time value");const i=Object.assign({},e,{addSuffix:e==null?void 0:e.addSuffix,comparison:s});let c,l;s>0?(c=u(o),l=u(a)):(c=u(a),l=u(o));const h=N(l,c),v=(y(l)-y(c))/1e3,f=Math.round((h-v)/60);let g;if(f<2)return e!=null&&e.includeSeconds?h<5?r.formatDistance("lessThanXSeconds",5,i):h<10?r.formatDistance("lessThanXSeconds",10,i):h<20?r.formatDistance("lessThanXSeconds",20,i):h<40?r.formatDistance("halfAMinute",0,i):h<60?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",1,i):f===0?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",f,i);if(f<45)return r.formatDistance("xMinutes",f,i);if(f<90)return r.formatDistance("aboutXHours",1,i);if(f<b){const m=Math.round(f/60);return r.formatDistance("aboutXHours",m,i)}else{if(f<t)return r.formatDistance("xDays",1,i);if(f<M){const m=Math.round(f/b);return r.formatDistance("xDays",m,i)}else if(f<M*2)return g=Math.round(f/M),r.formatDistance("aboutXMonths",g,i)}if(g=A(l,c),g<12){const m=Math.round(f/M);return r.formatDistance("xMonths",m,i)}else{const m=g%12,w=Math.trunc(g/12);return m<3?r.formatDistance("aboutXYears",w,i):m<9?r.formatDistance("overXYears",w,i):r.formatDistance("almostXYears",w+1,i)}}function R(a,o){return q(a,X(a),o)}const I=S((a,o)=>({posts:[],isLoading:!1,error:null,fetchPosts:async()=>{a({isLoading:!0,error:null});try{const{data:e,error:n}=await d.from("publicaciones").select(`
          *,
          autor:usuarios(*),
          comentarios(*),
          reacciones(*)
        `).order("creado_en",{ascending:!1});if(n)throw n;const r=await Promise.all(e.map(async t=>{var i;const{data:s}=await d.from("favoritos").select("*").eq("publicacion_id",t.id).single();return{id:t.id,userId:t.autor_id,type:t.tipo,content:t.contenido,mediaUrl:(i=t.multimedia_url)==null?void 0:i[0],createdAt:t.creado_en,likes:t.reacciones.map(c=>c.usuario_id),comments:t.comentarios.map(c=>({id:c.id,userId:c.autor_id,content:c.contenido,createdAt:c.creado_en})),isFavorite:!!s}}));a({posts:r,isLoading:!1})}catch(e){a({error:e instanceof Error?e.message:"Error al cargar publicaciones",isLoading:!1})}},addPost:async e=>{var n;a({isLoading:!0,error:null});try{const{data:r,error:t}=await d.from("publicaciones").insert({autor_id:e.userId,tipo:e.type,contenido:e.content,multimedia_url:e.mediaUrl?[e.mediaUrl]:[]}).select().single();if(t)throw t;const s={id:r.id,userId:r.autor_id,type:r.tipo,content:r.contenido,mediaUrl:(n=r.multimedia_url)==null?void 0:n[0],createdAt:r.creado_en,likes:[],comments:[],isFavorite:!1};a(i=>({posts:[s,...i.posts],isLoading:!1})),_.success("¡Publicación creada exitosamente!")}catch(r){a({error:r instanceof Error?r.message:"Error al crear publicación",isLoading:!1}),_.error("Error al crear publicación")}},toggleLike:async(e,n)=>{try{const r=o().posts.find(s=>s.id===e);if(!r)return;const t=r.likes.includes(n);if(t){const{error:s}=await d.from("reacciones").delete().eq("publicacion_id",e).eq("usuario_id",n);if(s)throw s}else{const{error:s}=await d.from("reacciones").insert({publicacion_id:e,usuario_id:n,tipo:"like"});if(s)throw s}a(s=>({posts:s.posts.map(i=>i.id===e?{...i,likes:t?i.likes.filter(c=>c!==n):[...i.likes,n]}:i)}))}catch{_.error("Error al actualizar reacción")}},addComment:async(e,n,r)=>{try{const{data:t,error:s}=await d.from("comentarios").insert({publicacion_id:e,autor_id:n,contenido:r}).select().single();if(s)throw s;const i={id:t.id,userId:t.autor_id,content:t.contenido,createdAt:t.creado_en};a(c=>({posts:c.posts.map(l=>l.id===e?{...l,comments:[...l.comments,i]}:l)})),_.success("Comentario agregado")}catch{_.error("Error al agregar comentario")}},toggleFavorite:async e=>{try{const n=o().posts.find(t=>t.id===e);if(!n)return;const{data:r}=await d.auth.getSession();if(!(r!=null&&r.user))return;if(n.isFavorite){const{error:t}=await d.from("favoritos").delete().eq("publicacion_id",e).eq("usuario_id",r.user.id);if(t)throw t}else{const{error:t}=await d.from("favoritos").insert({publicacion_id:e,usuario_id:r.user.id});if(t)throw t}a(t=>({posts:t.posts.map(s=>s.id===e?{...s,isFavorite:!s.isFavorite}:s)}))}catch{_.error("Error al actualizar favoritos")}},getFavoritePosts:()=>o().posts.filter(e=>e.isFavorite)})),p=async a=>{const{data:o,error:e}=await d.from("usuarios").select("*").eq("id",a).single();return e?null:{id:o.id,username:o.nombre_usuario,displayName:o.nombre_completo,avatar:o.avatar_url}},z=a=>R(new Date(a),{addSuffix:!0});export{z as f,p as g,I as u};
