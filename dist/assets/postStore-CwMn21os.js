import{t as u,K as L,N as y,O as v,Q as D,h as p,T as x,s as l,d as _}from"./index-BGdIQiaM.js";import{e as F,c as O}from"./endOfMonth-Dpn14GlW.js";function M(a,i){const e=u(a),o=u(i),t=e.getTime()-o.getTime();return t<0?-1:t>0?1:t}function T(a,i){const e=u(a),o=u(i),t=e.getFullYear()-o.getFullYear(),n=e.getMonth()-o.getMonth();return t*12+n}function X(a){return i=>{const o=(a?Math[a]:Math.trunc)(i);return o===0?0:o}}function b(a,i){return+u(a)-+u(i)}function k(a){const i=u(a);return i.setHours(23,59,59,999),i}function E(a){const i=u(a);return+k(i)==+F(i)}function P(a,i){const e=u(a),o=u(i),t=M(e,o),n=Math.abs(T(e,o));let r;if(n<1)r=0;else{e.getMonth()===1&&e.getDate()>27&&e.setDate(30),e.setMonth(e.getMonth()-t*n);let s=M(e,o)===-t;E(u(a))&&n===1&&M(a,o)===1&&(s=!1),r=t*(n-Number(s))}return r===0?0:r}function N(a,i,e){const o=b(a,i)/1e3;return X(e==null?void 0:e.roundingMethod)(o)}function A(a,i,e){const o=p(),t=(e==null?void 0:e.locale)??o.locale??L,n=2520,r=M(a,i);if(isNaN(r))throw new RangeError("Invalid time value");const s=Object.assign({},e,{addSuffix:e==null?void 0:e.addSuffix,comparison:r});let c,d;r>0?(c=u(i),d=u(a)):(c=u(a),d=u(i));const h=N(d,c),S=(y(d)-y(c))/1e3,f=Math.round((h-S)/60);let g;if(f<2)return e!=null&&e.includeSeconds?h<5?t.formatDistance("lessThanXSeconds",5,s):h<10?t.formatDistance("lessThanXSeconds",10,s):h<20?t.formatDistance("lessThanXSeconds",20,s):h<40?t.formatDistance("halfAMinute",0,s):h<60?t.formatDistance("lessThanXMinutes",1,s):t.formatDistance("xMinutes",1,s):f===0?t.formatDistance("lessThanXMinutes",1,s):t.formatDistance("xMinutes",f,s);if(f<45)return t.formatDistance("xMinutes",f,s);if(f<90)return t.formatDistance("aboutXHours",1,s);if(f<v){const m=Math.round(f/60);return t.formatDistance("aboutXHours",m,s)}else{if(f<n)return t.formatDistance("xDays",1,s);if(f<D){const m=Math.round(f/v);return t.formatDistance("xDays",m,s)}else if(f<D*2)return g=Math.round(f/D),t.formatDistance("aboutXMonths",g,s)}if(g=P(d,c),g<12){const m=Math.round(f/D);return t.formatDistance("xMonths",m,s)}else{const m=g%12,w=Math.trunc(g/12);return m<3?t.formatDistance("aboutXYears",w,s):m<9?t.formatDistance("overXYears",w,s):t.formatDistance("almostXYears",w+1,s)}}function q(a,i){return A(a,O(a),i)}const U=x((a,i)=>({posts:[],isLoading:!1,error:null,fetchPosts:async()=>{a({isLoading:!0,error:null});try{const{data:e,error:o}=await l.from("posts").select(`
          *,
          autor:usuarios(*),
          comentarios:comentarios_post(*),
          reacciones:reacciones_post(*)
        `).order("creado_en",{ascending:!1});if(o)throw o;const t=await Promise.all(e.map(async n=>{var s;const{data:r}=await l.from("favoritos_post").select("*").eq("post_id",n.id).single();return{id:n.id,userId:n.autor_id,type:n.tipo,content:n.contenido,mediaUrl:(s=n.multimedia_url)==null?void 0:s[0],createdAt:n.creado_en,likes:n.reacciones.map(c=>c.usuario_id),comments:n.comentarios.map(c=>({id:c.id,userId:c.autor_id,content:c.contenido,createdAt:c.creado_en})),isFavorite:!!r}}));a({posts:t,isLoading:!1})}catch(e){a({error:e instanceof Error?e.message:"Error al cargar posts",isLoading:!1})}},addPost:async e=>{var o;a({isLoading:!0,error:null});try{const t=new Date().toISOString(),n={autor_id:e.userId,tipo:e.type,contenido:e.content,multimedia_url:e.mediaUrl?[e.mediaUrl]:[],creado_en:t,actualizado_en:t},{data:r,error:s}=await l.from("posts").insert(n).select().single();if(s)throw s;const c={id:r.id,userId:r.autor_id,type:r.tipo,content:r.contenido,mediaUrl:(o=r.multimedia_url)==null?void 0:o[0],createdAt:r.creado_en,likes:[],comments:[],isFavorite:!1};a(d=>({posts:[c,...d.posts],isLoading:!1})),_.success("¡Publicación creada exitosamente!")}catch(t){a({error:t instanceof Error?t.message:"Error al crear post",isLoading:!1}),_.error("Error al crear post")}},toggleLike:async(e,o)=>{try{const t=i().posts.find(r=>r.id===e);if(!t)return;const n=t.likes.includes(o);if(n){const{error:r}=await l.from("reacciones_post").delete().eq("post_id",e).eq("usuario_id",o);if(r)throw r}else{const{error:r}=await l.from("reacciones_post").insert({post_id:e,usuario_id:o,tipo:"like"});if(r)throw r}a(r=>({posts:r.posts.map(s=>s.id===e?{...s,likes:n?s.likes.filter(c=>c!==o):[...s.likes,o]}:s)}))}catch{_.error("Error al actualizar reacción")}},addComment:async(e,o,t)=>{try{const{data:n,error:r}=await l.from("comentarios_post").insert({post_id:e,autor_id:o,contenido:t}).select().single();if(r)throw r;const s={id:n.id,userId:n.autor_id,content:n.contenido,createdAt:n.creado_en};a(c=>({posts:c.posts.map(d=>d.id===e?{...d,comments:[...d.comments,s]}:d)})),_.success("Comentario agregado")}catch{_.error("Error al agregar comentario")}},toggleFavorite:async e=>{var o;try{const t=i().posts.find(r=>r.id===e);if(!t)return;const{data:n}=await l.auth.getSession();if(!((o=n==null?void 0:n.session)!=null&&o.user))return;if(t.isFavorite){const{error:r}=await l.from("favoritos_post").delete().eq("post_id",e).eq("usuario_id",n.session.user.id);if(r)throw r}else{const{error:r}=await l.from("favoritos_post").insert({post_id:e,usuario_id:n.session.user.id});if(r)throw r}a(r=>({posts:r.posts.map(s=>s.id===e?{...s,isFavorite:!s.isFavorite}:s)}))}catch{_.error("Error al actualizar favoritos")}},getFavoritePosts:()=>i().posts.filter(e=>e.isFavorite)})),Y=async a=>{const{data:i,error:e}=await l.from("usuarios").select("*").eq("id",a).single();return e?null:{id:i.id,username:i.nombre_usuario,displayName:i.nombre_completo,avatar:i.avatar_url}},z=a=>q(new Date(a),{addSuffix:!0});export{z as f,Y as g,U as u};
