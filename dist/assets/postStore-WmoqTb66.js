import{e as p,s as l,a as _}from"./index-DZQ_1XEG.js";import{e as L,c as x}from"./endOfMonth-CHJGNAHY.js";import{t as u,e as F,d as y,f as v,h as D,g as X}from"./en-US-D3c9jfE3.js";function M(a,i){const e=u(a),n=u(i),t=e.getTime()-n.getTime();return t<0?-1:t>0?1:t}function O(a,i){const e=u(a),n=u(i),t=e.getFullYear()-n.getFullYear(),o=e.getMonth()-n.getMonth();return t*12+o}function T(a){return i=>{const n=(a?Math[a]:Math.trunc)(i);return n===0?0:n}}function b(a,i){return+u(a)-+u(i)}function k(a){const i=u(a);return i.setHours(23,59,59,999),i}function E(a){const i=u(a);return+k(i)==+L(i)}function P(a,i){const e=u(a),n=u(i),t=M(e,n),o=Math.abs(O(e,n));let r;if(o<1)r=0;else{e.getMonth()===1&&e.getDate()>27&&e.setDate(30),e.setMonth(e.getMonth()-t*o);let s=M(e,n)===-t;E(u(a))&&o===1&&M(a,n)===1&&(s=!1),r=t*(o-Number(s))}return r===0?0:r}function A(a,i,e){const n=b(a,i)/1e3;return T(e==null?void 0:e.roundingMethod)(n)}function N(a,i,e){const n=X(),t=(e==null?void 0:e.locale)??n.locale??F,o=2520,r=M(a,i);if(isNaN(r))throw new RangeError("Invalid time value");const s=Object.assign({},e,{addSuffix:e==null?void 0:e.addSuffix,comparison:r});let c,d;r>0?(c=u(i),d=u(a)):(c=u(a),d=u(i));const h=A(d,c),S=(y(d)-y(c))/1e3,f=Math.round((h-S)/60);let g;if(f<2)return e!=null&&e.includeSeconds?h<5?t.formatDistance("lessThanXSeconds",5,s):h<10?t.formatDistance("lessThanXSeconds",10,s):h<20?t.formatDistance("lessThanXSeconds",20,s):h<40?t.formatDistance("halfAMinute",0,s):h<60?t.formatDistance("lessThanXMinutes",1,s):t.formatDistance("xMinutes",1,s):f===0?t.formatDistance("lessThanXMinutes",1,s):t.formatDistance("xMinutes",f,s);if(f<45)return t.formatDistance("xMinutes",f,s);if(f<90)return t.formatDistance("aboutXHours",1,s);if(f<v){const m=Math.round(f/60);return t.formatDistance("aboutXHours",m,s)}else{if(f<o)return t.formatDistance("xDays",1,s);if(f<D){const m=Math.round(f/v);return t.formatDistance("xDays",m,s)}else if(f<D*2)return g=Math.round(f/D),t.formatDistance("aboutXMonths",g,s)}if(g=P(d,c),g<12){const m=Math.round(f/D);return t.formatDistance("xMonths",m,s)}else{const m=g%12,w=Math.trunc(g/12);return m<3?t.formatDistance("aboutXYears",w,s):m<9?t.formatDistance("overXYears",w,s):t.formatDistance("almostXYears",w+1,s)}}function q(a,i){return N(a,x(a),i)}const Y=p((a,i)=>({posts:[],isLoading:!1,error:null,fetchPosts:async()=>{a({isLoading:!0,error:null});try{const{data:e,error:n}=await l.from("posts").select(`
          *,
          autor:usuarios(*),
          comentarios:comentarios_post(*),
          reacciones:reacciones_post(*)
        `).order("creado_en",{ascending:!1});if(n)throw n;const t=await Promise.all(e.map(async o=>{var s;const{data:r}=await l.from("favoritos_post").select("*").eq("post_id",o.id).single();return{id:o.id,userId:o.autor_id,type:o.tipo,content:o.contenido,mediaUrl:(s=o.multimedia_url)==null?void 0:s[0],createdAt:o.creado_en,likes:o.reacciones.map(c=>c.usuario_id),comments:o.comentarios.map(c=>({id:c.id,userId:c.autor_id,content:c.contenido,createdAt:c.creado_en})),isFavorite:!!r}}));a({posts:t,isLoading:!1})}catch(e){a({error:e instanceof Error?e.message:"Error al cargar posts",isLoading:!1})}},addPost:async e=>{var n;a({isLoading:!0,error:null});try{const t=new Date().toISOString(),o={autor_id:e.userId,tipo:e.type,contenido:e.content,multimedia_url:e.mediaUrl?[e.mediaUrl]:[],creado_en:t,actualizado_en:t},{data:r,error:s}=await l.from("posts").insert(o).select().single();if(s)throw s;const c={id:r.id,userId:r.autor_id,type:r.tipo,content:r.contenido,mediaUrl:(n=r.multimedia_url)==null?void 0:n[0],createdAt:r.creado_en,likes:[],comments:[],isFavorite:!1};a(d=>({posts:[c,...d.posts],isLoading:!1})),_.success("¡Publicación creada exitosamente!")}catch(t){a({error:t instanceof Error?t.message:"Error al crear post",isLoading:!1}),_.error("Error al crear post")}},toggleLike:async(e,n)=>{try{const t=i().posts.find(r=>r.id===e);if(!t)return;const o=t.likes.includes(n);if(o){const{error:r}=await l.from("reacciones_post").delete().eq("post_id",e).eq("usuario_id",n);if(r)throw r}else{const{error:r}=await l.from("reacciones_post").insert({post_id:e,usuario_id:n,tipo:"like"});if(r)throw r}a(r=>({posts:r.posts.map(s=>s.id===e?{...s,likes:o?s.likes.filter(c=>c!==n):[...s.likes,n]}:s)}))}catch{_.error("Error al actualizar reacción")}},addComment:async(e,n,t)=>{try{const{data:o,error:r}=await l.from("comentarios_post").insert({post_id:e,autor_id:n,contenido:t}).select().single();if(r)throw r;const s={id:o.id,userId:o.autor_id,content:o.contenido,createdAt:o.creado_en};a(c=>({posts:c.posts.map(d=>d.id===e?{...d,comments:[...d.comments,s]}:d)})),_.success("Comentario agregado")}catch{_.error("Error al agregar comentario")}},toggleFavorite:async e=>{var n;try{const t=i().posts.find(r=>r.id===e);if(!t)return;const{data:o}=await l.auth.getSession();if(!((n=o==null?void 0:o.session)!=null&&n.user))return;if(t.isFavorite){const{error:r}=await l.from("favoritos_post").delete().eq("post_id",e).eq("usuario_id",o.session.user.id);if(r)throw r}else{const{error:r}=await l.from("favoritos_post").insert({post_id:e,usuario_id:o.session.user.id});if(r)throw r}a(r=>({posts:r.posts.map(s=>s.id===e?{...s,isFavorite:!s.isFavorite}:s)}))}catch{_.error("Error al actualizar favoritos")}},getFavoritePosts:()=>i().posts.filter(e=>e.isFavorite)})),z=async a=>{const{data:i,error:e}=await l.from("usuarios").select("*").eq("id",a).single();return e?null:{id:i.id,username:i.nombre_usuario,displayName:i.nombre_completo,avatar:i.avatar_url}},C=a=>q(new Date(a),{addSuffix:!0});export{C as f,z as g,Y as u};
